import{b as Ai}from"./chunk-ETLF7AXS.js";import{a as et}from"./chunk-RWLWNASV.js";import{e as Si}from"./chunk-Q63SNJNY.js";import{b as Ii}from"./chunk-SQSNDEOZ.js";import{a as W,b as Pi}from"./chunk-UTC2IVAK.js";import{b as Mi,c as Ei,g as Oi,h as Fi}from"./chunk-6BR4RKUN.js";import{d as kt}from"./chunk-4OHCZ47J.js";import{c as Ti,d as Ri,e as Di}from"./chunk-YNRI7ONC.js";import{e as xi}from"./chunk-R3ERDSFW.js";import{a as P,b as ue,c as vi,d as V,e as wi}from"./chunk-4PQ7QBTL.js";import{a as He,b as bt,c as $e,e as di,f as Ct,h as pi}from"./chunk-MPB4WSS5.js";import{a as Ze}from"./chunk-3ZNKIO6H.js";import{a as ie,b as re,c as ne,d as oe,e as ae,f as le,g as se,h as me,i as ce,j as de,k as Ie,l as hi,m as pe,n as We,o as yi,p as Ue,q as Ye,r as Fe,s as Ke,t as Xe,u as Je,v as St}from"./chunk-NPMEEAYW.js";import{a as q,b as Pe,d as Qe,f as L,g as yt,h as fe,i as Mt,k as z,l as Et}from"./chunk-ZR4OZC73.js";import{A as Me,B as Ee,E as Se,F as Oe,G as fi,H as xt,O as _i,S as gi,da as Gt,ga as bi,ha as Q,ia as Ci,ja as G,ka as ki,p as we,r as E,t as ke,u as xe,y as ye}from"./chunk-LQ6MDXSH.js";import{a as ui,b as wt}from"./chunk-DEA6IKFQ.js";import{$ as M,$a as f,D as O,Db as jt,Ea as Lt,Fa as d,Fb as je,Ga as ft,Gb as Bt,Ha as c,I as Yt,Ja as _t,Kb as Be,Lb as te,Mb as I,N as Kt,Nc as li,Qa as n,Ra as r,Rb as ri,Sa as _,Sb as gt,T as ve,Ta as w,Tb as be,U as Ve,Ua as k,Uc as Ge,V as nt,W as ge,Wa as S,X as Xt,Za as g,_ as Z,a as pt,aa as Ne,ab as Vt,bb as Nt,bd as si,cd as mi,da as v,db as T,dc as ht,ea as b,eb as R,ec as ni,fb as D,fc as Ce,gb as B,gc as ze,gd as J,hb as a,hc as oi,ia as Jt,ib as x,ic as ai,jb as C,jd as zt,kb as H,la as ot,lb as ei,ld as ci,ma as qt,mb as Y,md as A,nb as K,ob as X,od as $,pa as Zt,pd as vt,q as At,qb as at,r as F,rb as ee,sb as lt,ta as l,ua as u,vb as Ae,x as ut,xb as ti,yb as st,zb as ii}from"./chunk-KODBDAN5.js";var tr=["input"],ir=["formField"],rr=["*"],nr=0,Ht=class{constructor(s,e){this.source=s,this.value=e}};var or=new nt("MatRadioGroup"),ar=new nt("mat-radio-default-options",{providedIn:"root",factory:lr});function lr(){return{color:"accent"}}var sr=(()=>{class t{get checked(){return this._checked}set checked(e){this._checked!==e&&(this._checked=e,e&&this.radioGroup&&this.radioGroup.value!==this.value?this.radioGroup.selected=this:!e&&this.radioGroup&&this.radioGroup.value===this.value&&(this.radioGroup.selected=null),e&&this._radioDispatcher.notify(this.id,this.name),this._changeDetector.markForCheck())}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,this.radioGroup!==null&&(this.checked||(this.checked=this.radioGroup.value===e),this.checked&&(this.radioGroup.selected=this)))}get labelPosition(){return this._labelPosition||this.radioGroup&&this.radioGroup.labelPosition||"after"}set labelPosition(e){this._labelPosition=e}get disabled(){return this._disabled||this.radioGroup!==null&&this.radioGroup.disabled}set disabled(e){this._setDisabled(e)}get required(){return this._required||this.radioGroup&&this.radioGroup.required}set required(e){this._required=e}get color(){return this._color||this.radioGroup&&this.radioGroup.color||this._providerOverride&&this._providerOverride.color||"accent"}set color(e){this._color=e}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(e,i,o,m,p,h,U,he){this._elementRef=i,this._changeDetector=o,this._focusMonitor=m,this._radioDispatcher=p,this._providerOverride=U,this._uniqueId=`mat-radio-${++nr}`,this.id=this._uniqueId,this.disableRipple=!1,this.tabIndex=0,this.change=new qt,this._checked=!1,this._value=null,this._removeUniqueSelectionListener=()=>{},this.radioGroup=e,this._noopAnimations=h==="NoopAnimations",he&&(this.tabIndex=Bt(he,0))}focus(e,i){i?this._focusMonitor.focusVia(this._inputElement,i,e):this._inputElement.nativeElement.focus(e)}_markForCheck(){this._changeDetector.markForCheck()}ngOnInit(){this.radioGroup&&(this.checked=this.radioGroup.value===this._value,this.checked&&(this.radioGroup.selected=this),this.name=this.radioGroup.name),this._removeUniqueSelectionListener=this._radioDispatcher.listen((e,i)=>{e!==this.id&&i===this.name&&(this.checked=!1)})}ngDoCheck(){this._updateTabIndex()}ngAfterViewInit(){this._updateTabIndex(),this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{!e&&this.radioGroup&&this.radioGroup._touch()})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._removeUniqueSelectionListener()}_emitChangeEvent(){this.change.emit(new Ht(this,this._value))}_isRippleDisabled(){return this.disableRipple||this.disabled}_onInputClick(e){e.stopPropagation()}_onInputInteraction(e){if(e.stopPropagation(),!this.checked&&!this.disabled){let i=this.radioGroup&&this.value!==this.radioGroup.value;this.checked=!0,this._emitChangeEvent(),this.radioGroup&&(this.radioGroup._controlValueAccessorChangeFn(this.value),i&&this.radioGroup._emitChangeEvent())}}_onTouchTargetClick(e){this._onInputInteraction(e),this.disabled||this._inputElement.nativeElement.focus()}_setDisabled(e){this._disabled!==e&&(this._disabled=e,this._changeDetector.markForCheck())}_updateTabIndex(){let e=this.radioGroup,i;if(!e||!e.selected||this.disabled?i=this.tabIndex:i=e.selected===this?this.tabIndex:-1,i!==this._previousTabIndex){let o=this._inputElement?.nativeElement;o&&(o.setAttribute("tabindex",i+""),this._previousTabIndex=i)}}static{this.\u0275fac=function(i){return new(i||t)(u(or,8),u(ot),u(jt),u(li),u(_i),u(Zt,8),u(ar,8),Jt("tabindex"))}}static{this.\u0275cmp=M({type:t,selectors:[["mat-radio-button"]],viewQuery:function(i,o){if(i&1&&(T(tr,5),T(ir,7,ot)),i&2){let m;R(m=D())&&(o._inputElement=m.first),R(m=D())&&(o._rippleTrigger=m.first)}},hostAttrs:[1,"mat-mdc-radio-button"],hostVars:15,hostBindings:function(i,o){i&1&&g("focus",function(){return o._inputElement.nativeElement.focus()}),i&2&&(ft("id",o.id)("tabindex",null)("aria-label",null)("aria-labelledby",null)("aria-describedby",null),_t("mat-primary",o.color==="primary")("mat-accent",o.color==="accent")("mat-warn",o.color==="warn")("mat-mdc-radio-checked",o.checked)("_mat-animation-noopable",o._noopAnimations))},inputs:{id:"id",name:"name",ariaLabel:[Z.None,"aria-label","ariaLabel"],ariaLabelledby:[Z.None,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[Z.None,"aria-describedby","ariaDescribedby"],disableRipple:[Z.HasDecoratorInputTransform,"disableRipple","disableRipple",je],tabIndex:[Z.HasDecoratorInputTransform,"tabIndex","tabIndex",e=>e==null?0:Bt(e)],checked:[Z.HasDecoratorInputTransform,"checked","checked",je],value:"value",labelPosition:"labelPosition",disabled:[Z.HasDecoratorInputTransform,"disabled","disabled",je],required:[Z.HasDecoratorInputTransform,"required","required",je],color:"color"},outputs:{change:"change"},exportAs:["matRadioButton"],standalone:!0,features:[Lt,at],ngContentSelectors:rr,decls:13,vars:16,consts:[["formField",""],["input",""],["mat-internal-form-field","",3,"labelPosition"],[1,"mdc-radio"],[1,"mat-mdc-radio-touch-target",3,"click"],["type","radio",1,"mdc-radio__native-control",3,"change","id","checked","disabled","required"],[1,"mdc-radio__background"],[1,"mdc-radio__outer-circle"],[1,"mdc-radio__inner-circle"],["mat-ripple","",1,"mat-radio-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mat-ripple-element","mat-radio-persistent-ripple"],[1,"mdc-label",3,"for"]],template:function(i,o){if(i&1){let m=S();Vt(),n(0,"div",2,0)(2,"div",3)(3,"div",4),g("click",function(h){return v(m),b(o._onTouchTargetClick(h))}),r(),n(4,"input",5,1),g("change",function(h){return v(m),b(o._onInputInteraction(h))}),r(),n(6,"div",6),_(7,"div",7)(8,"div",8),r(),n(9,"div",9),_(10,"div",10),r()(),n(11,"label",11),Nt(12),r()()}i&2&&(c("labelPosition",o.labelPosition),l(2),_t("mdc-radio--disabled",o.disabled),l(2),c("id",o.inputId)("checked",o.checked)("disabled",o.disabled)("required",o.required),ft("name",o.name)("value",o.value)("aria-label",o.ariaLabel)("aria-labelledby",o.ariaLabelledby)("aria-describedby",o.ariaDescribedby),l(5),c("matRippleTrigger",o._rippleTrigger.nativeElement)("matRippleDisabled",o._isRippleDisabled())("matRippleCentered",!0),l(2),c("for",o.inputId))},dependencies:[si,ci],styles:['.mdc-radio{display:inline-block;position:relative;flex:0 0 auto;box-sizing:content-box;width:20px;height:20px;cursor:pointer;will-change:opacity,transform,border-color,color}.mdc-radio[hidden]{display:none}.mdc-radio__background{display:inline-block;position:relative;box-sizing:border-box;width:20px;height:20px}.mdc-radio__background::before{position:absolute;transform:scale(0, 0);border-radius:50%;opacity:0;pointer-events:none;content:"";transition:opacity 120ms 0ms cubic-bezier(0.4, 0, 0.6, 1),transform 120ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-radio__outer-circle{position:absolute;top:0;left:0;box-sizing:border-box;width:100%;height:100%;border-width:2px;border-style:solid;border-radius:50%;transition:border-color 120ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-radio__inner-circle{position:absolute;top:0;left:0;box-sizing:border-box;width:100%;height:100%;transform:scale(0, 0);border-width:10px;border-style:solid;border-radius:50%;transition:transform 120ms 0ms cubic-bezier(0.4, 0, 0.6, 1),border-color 120ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-radio__native-control{position:absolute;margin:0;padding:0;opacity:0;cursor:inherit;z-index:1}.mdc-radio--touch{margin-top:4px;margin-bottom:4px;margin-right:4px;margin-left:4px}.mdc-radio--touch .mdc-radio__native-control{top:calc((40px - 48px) / 2);right:calc((40px - 48px) / 2);left:calc((40px - 48px) / 2);width:48px;height:48px}.mdc-radio.mdc-ripple-upgraded--background-focused .mdc-radio__focus-ring,.mdc-radio:not(.mdc-ripple-upgraded):focus .mdc-radio__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:100%;width:100%}@media screen and (forced-colors: active){.mdc-radio.mdc-ripple-upgraded--background-focused .mdc-radio__focus-ring,.mdc-radio:not(.mdc-ripple-upgraded):focus .mdc-radio__focus-ring{border-color:CanvasText}}.mdc-radio.mdc-ripple-upgraded--background-focused .mdc-radio__focus-ring::after,.mdc-radio:not(.mdc-ripple-upgraded):focus .mdc-radio__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-radio.mdc-ripple-upgraded--background-focused .mdc-radio__focus-ring::after,.mdc-radio:not(.mdc-ripple-upgraded):focus .mdc-radio__focus-ring::after{border-color:CanvasText}}.mdc-radio__native-control:checked+.mdc-radio__background,.mdc-radio__native-control:disabled+.mdc-radio__background{transition:opacity 120ms 0ms cubic-bezier(0, 0, 0.2, 1),transform 120ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-radio__native-control:checked+.mdc-radio__background .mdc-radio__outer-circle,.mdc-radio__native-control:disabled+.mdc-radio__background .mdc-radio__outer-circle{transition:border-color 120ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-radio__native-control:checked+.mdc-radio__background .mdc-radio__inner-circle,.mdc-radio__native-control:disabled+.mdc-radio__background .mdc-radio__inner-circle{transition:transform 120ms 0ms cubic-bezier(0, 0, 0.2, 1),border-color 120ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-radio--disabled{cursor:default;pointer-events:none}.mdc-radio__native-control:checked+.mdc-radio__background .mdc-radio__inner-circle{transform:scale(0.5);transition:transform 120ms 0ms cubic-bezier(0, 0, 0.2, 1),border-color 120ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-radio__native-control:disabled+.mdc-radio__background,[aria-disabled=true] .mdc-radio__native-control+.mdc-radio__background{cursor:default}.mdc-radio__native-control:focus+.mdc-radio__background::before{transform:scale(1);opacity:.12;transition:opacity 120ms 0ms cubic-bezier(0, 0, 0.2, 1),transform 120ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-radio-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-radio-button .mdc-radio{padding:calc((var(--mdc-radio-state-layer-size) - 20px) / 2)}.mat-mdc-radio-button .mdc-radio [aria-disabled=true] .mdc-radio__native-control:checked+.mdc-radio__background .mdc-radio__outer-circle,.mat-mdc-radio-button .mdc-radio .mdc-radio__native-control:disabled:checked+.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-disabled-selected-icon-color)}.mat-mdc-radio-button .mdc-radio [aria-disabled=true] .mdc-radio__native-control+.mdc-radio__background .mdc-radio__inner-circle,.mat-mdc-radio-button .mdc-radio .mdc-radio__native-control:disabled+.mdc-radio__background .mdc-radio__inner-circle{border-color:var(--mdc-radio-disabled-selected-icon-color)}.mat-mdc-radio-button .mdc-radio [aria-disabled=true] .mdc-radio__native-control:checked+.mdc-radio__background .mdc-radio__outer-circle,.mat-mdc-radio-button .mdc-radio .mdc-radio__native-control:disabled:checked+.mdc-radio__background .mdc-radio__outer-circle{opacity:var(--mdc-radio-disabled-selected-icon-opacity)}.mat-mdc-radio-button .mdc-radio [aria-disabled=true] .mdc-radio__native-control+.mdc-radio__background .mdc-radio__inner-circle,.mat-mdc-radio-button .mdc-radio .mdc-radio__native-control:disabled+.mdc-radio__background .mdc-radio__inner-circle{opacity:var(--mdc-radio-disabled-selected-icon-opacity)}.mat-mdc-radio-button .mdc-radio [aria-disabled=true] .mdc-radio__native-control:not(:checked)+.mdc-radio__background .mdc-radio__outer-circle,.mat-mdc-radio-button .mdc-radio .mdc-radio__native-control:disabled:not(:checked)+.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-disabled-unselected-icon-color)}.mat-mdc-radio-button .mdc-radio [aria-disabled=true] .mdc-radio__native-control:not(:checked)+.mdc-radio__background .mdc-radio__outer-circle,.mat-mdc-radio-button .mdc-radio .mdc-radio__native-control:disabled:not(:checked)+.mdc-radio__background .mdc-radio__outer-circle{opacity:var(--mdc-radio-disabled-unselected-icon-opacity)}.mat-mdc-radio-button .mdc-radio.mdc-ripple-upgraded--background-focused .mdc-radio__native-control:enabled:checked+.mdc-radio__background .mdc-radio__outer-circle,.mat-mdc-radio-button .mdc-radio:not(.mdc-ripple-upgraded):focus .mdc-radio__native-control:enabled:checked+.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-selected-focus-icon-color)}.mat-mdc-radio-button .mdc-radio.mdc-ripple-upgraded--background-focused .mdc-radio__native-control:enabled+.mdc-radio__background .mdc-radio__inner-circle,.mat-mdc-radio-button .mdc-radio:not(.mdc-ripple-upgraded):focus .mdc-radio__native-control:enabled+.mdc-radio__background .mdc-radio__inner-circle{border-color:var(--mdc-radio-selected-focus-icon-color)}.mat-mdc-radio-button .mdc-radio:hover .mdc-radio__native-control:enabled:checked+.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-selected-hover-icon-color)}.mat-mdc-radio-button .mdc-radio:hover .mdc-radio__native-control:enabled+.mdc-radio__background .mdc-radio__inner-circle{border-color:var(--mdc-radio-selected-hover-icon-color)}.mat-mdc-radio-button .mdc-radio .mdc-radio__native-control:enabled:checked+.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-selected-icon-color)}.mat-mdc-radio-button .mdc-radio .mdc-radio__native-control:enabled+.mdc-radio__background .mdc-radio__inner-circle{border-color:var(--mdc-radio-selected-icon-color)}.mat-mdc-radio-button .mdc-radio:not(:disabled):active .mdc-radio__native-control:enabled:checked+.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-selected-pressed-icon-color)}.mat-mdc-radio-button .mdc-radio:not(:disabled):active .mdc-radio__native-control:enabled+.mdc-radio__background .mdc-radio__inner-circle{border-color:var(--mdc-radio-selected-pressed-icon-color)}.mat-mdc-radio-button .mdc-radio:hover .mdc-radio__native-control:enabled:not(:checked)+.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-unselected-hover-icon-color)}.mat-mdc-radio-button .mdc-radio .mdc-radio__native-control:enabled:not(:checked)+.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-unselected-icon-color)}.mat-mdc-radio-button .mdc-radio:not(:disabled):active .mdc-radio__native-control:enabled:not(:checked)+.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-unselected-pressed-icon-color)}.mat-mdc-radio-button .mdc-radio .mdc-radio__background::before{top:calc(-1 * (var(--mdc-radio-state-layer-size) - 20px) / 2);left:calc(-1 * (var(--mdc-radio-state-layer-size) - 20px) / 2);width:var(--mdc-radio-state-layer-size);height:var(--mdc-radio-state-layer-size)}.mat-mdc-radio-button .mdc-radio .mdc-radio__native-control{top:calc((var(--mdc-radio-state-layer-size) - var(--mdc-radio-state-layer-size)) / 2);right:calc((var(--mdc-radio-state-layer-size) - var(--mdc-radio-state-layer-size)) / 2);left:calc((var(--mdc-radio-state-layer-size) - var(--mdc-radio-state-layer-size)) / 2);width:var(--mdc-radio-state-layer-size);height:var(--mdc-radio-state-layer-size)}.mat-mdc-radio-button .mdc-radio .mdc-radio__background::before{background-color:var(--mat-radio-ripple-color)}.mat-mdc-radio-button .mdc-radio:hover .mdc-radio__native-control:not([disabled]):not(:focus)~.mdc-radio__background::before{opacity:.04;transform:scale(1)}.mat-mdc-radio-button.mat-mdc-radio-checked .mdc-radio__background::before{background-color:var(--mat-radio-checked-ripple-color)}.mat-mdc-radio-button.mat-mdc-radio-checked .mat-ripple-element{background-color:var(--mat-radio-checked-ripple-color)}.mat-mdc-radio-button .mdc-radio--disabled+label{color:var(--mat-radio-disabled-label-color)}.mat-mdc-radio-button .mat-radio-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:50%}.mat-mdc-radio-button .mat-radio-ripple .mat-ripple-element{opacity:.14}.mat-mdc-radio-button .mat-radio-ripple::before{border-radius:50%}.mat-mdc-radio-button._mat-animation-noopable .mdc-radio__background::before,.mat-mdc-radio-button._mat-animation-noopable .mdc-radio__outer-circle,.mat-mdc-radio-button._mat-animation-noopable .mdc-radio__inner-circle{transition:none !important}.mat-mdc-radio-button .mdc-radio .mdc-radio__native-control:focus:enabled:not(:checked)~.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-unselected-focus-icon-color, black)}.mat-mdc-radio-button.cdk-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-radio-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%);display:var(--mat-radio-touch-target-display)}[dir=rtl] .mat-mdc-radio-touch-target{left:0;right:50%;transform:translate(50%, -50%)}'],encapsulation:2,changeDetection:0})}}return t})(),qi=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Ne({type:t})}static{this.\u0275inj=Ve({imports:[Ge,be,mi,sr,Ge]})}}return t})();var mr=new nt("mat-autocomplete-scroll-strategy",{providedIn:"root",factory:()=>{let t=Xt(Gt);return()=>t.scrollStrategies.reposition()}});function cr(t){return()=>t.scrollStrategies.reposition()}var dr={provide:mr,deps:[Gt],useFactory:cr};var Li=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Ne({type:t})}static{this.\u0275inj=Ve({providers:[dr],imports:[bi,zt,Ge,be,gi,zt,Ge]})}}return t})();var Vi=(()=>{class t{constructor(e,i){this.keycloakService=e,this.router=i}canActivate(e,i){return this.keycloakService.isLoggedIn()&&this.keycloakService.hasRole("admin")?(console.log("AdminGuard: Acc\xE8s autoris\xE9 - r\xF4le admin d\xE9tect\xE9"),!0):(console.log("AdminGuard: Acc\xE8s refus\xE9 - r\xF4le admin requis"),this.router.createUrlTree(["/compliance/frameworks"]))}static{this.\u0275fac=function(i){return new(i||t)(ge(kt),ge(Ce))}}static{this.\u0275prov=ve({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Ni=(()=>{class t{constructor(){}ngOnInit(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=M({type:t,selectors:[["app-compliance"]],decls:29,vars:4,consts:[["rlFrameworks","routerLinkActive"],["rlRequirements","routerLinkActive"],["rlMapping","routerLinkActive"],["rlGap","routerLinkActive"],[1,"compliance-container"],[1,"page-header"],[1,"subtitle"],["mat-tab-nav-bar","",1,"compliance-nav"],["mat-tab-link","","routerLink","frameworks","routerLinkActive","",3,"active"],["mat-tab-link","","routerLink","requirements","routerLinkActive","",3,"active"],["mat-tab-link","","routerLink","mappings","routerLinkActive","",3,"active"],["mat-tab-link","","routerLink","gap-analysis","routerLinkActive","",3,"active"],[1,"compliance-content"]],template:function(i,o){if(i&1&&(n(0,"div",4)(1,"div",5)(2,"h1"),a(3,"Gestion de la Conformit\xE9"),r(),n(4,"p",6),a(5,"G\xE9rez les r\xE9f\xE9rentiels normatifs et les mappings avec les risques"),r()(),n(6,"nav",7)(7,"a",8,0)(9,"mat-icon"),a(10,"library_books"),r(),a(11," R\xE9f\xE9rentiels Normatifs "),r(),n(12,"a",9,1)(14,"mat-icon"),a(15,"assignment"),r(),a(16," Exigences "),r(),n(17,"a",10,2)(19,"mat-icon"),a(20,"link"),r(),a(21," Mappings Risques-Conformit\xE9 "),r(),n(22,"a",11,3)(24,"mat-icon"),a(25,"analytics"),r(),a(26," Analyse d'\xC9carts "),r()(),n(27,"div",12),_(28,"router-outlet"),r()()),i&2){let m=B(8),p=B(13),h=B(18),U=B(23);l(7),c("active",m.isActive),l(5),c("active",p.isActive),l(5),c("active",h.isActive),l(5),c("active",U.isActive)}},dependencies:[ni,ze,oi,G,Ti,Ri],styles:[".compliance-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;padding:20px}.page-header[_ngcontent-%COMP%]{margin-bottom:20px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px;font-weight:500;margin-bottom:8px;color:#333}.page-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#666;font-size:14px;margin:0}.compliance-nav[_ngcontent-%COMP%]{margin-bottom:20px;background-color:#f5f5f5;border-radius:4px}.compliance-nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 16px;color:#555;text-decoration:none}.compliance-nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.compliance-nav[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{color:#3f51b5;font-weight:500}.compliance-content[_ngcontent-%COMP%]{flex:1;overflow:auto;background-color:#fff;border-radius:4px;box-shadow:0 2px 4px #0000001a;padding:20px}"]})}}return t})();function ur(t,s){t&1&&(n(0,"mat-error"),a(1," Le nom est obligatoire "),r())}function fr(t,s){t&1&&(n(0,"mat-error"),a(1," Le nom ne doit pas d\xE9passer 100 caract\xE8res "),r())}function _r(t,s){t&1&&(n(0,"mat-error"),a(1," La version est obligatoire "),r())}function gr(t,s){t&1&&(n(0,"mat-error"),a(1," La version ne doit pas d\xE9passer 20 caract\xE8res "),r())}function hr(t,s){t&1&&(n(0,"mat-error"),a(1," La description ne doit pas d\xE9passer 500 caract\xE8res "),r())}var Ot=(()=>{class t{constructor(e,i,o){this.fb=e,this.dialogRef=i,this.data=o,this.isEditMode=!1,this.dialogTitle="Cr\xE9er un R\xE9f\xE9rentiel Normatif"}ngOnInit(){this.isEditMode=!!this.data.id,this.isEditMode&&(this.dialogTitle="Modifier le R\xE9f\xE9rentiel Normatif"),this.initForm()}initForm(){this.frameworkForm=this.fb.group({id:[this.data.id],name:[this.data.name||"",[E.required,E.maxLength(100)]],version:[this.data.version||"",[E.required,E.maxLength(20)]],description:[this.data.description||"",E.maxLength(500)]})}onSubmit(){this.frameworkForm.valid&&this.dialogRef.close(this.frameworkForm.value)}onCancel(){this.dialogRef.close()}static{this.\u0275fac=function(i){return new(i||t)(u(Oe),u(Ue),u(Ye))}}static{this.\u0275cmp=M({type:t,selectors:[["app-framework-form-dialog"]],decls:28,vars:9,consts:[["mat-dialog-title",""],[3,"ngSubmit","formGroup"],[1,"form-fields"],["type","hidden","formControlName","id"],["appearance","outline",1,"full-width"],["matInput","","formControlName","name","placeholder","Ex. ISO 27001","required",""],[4,"ngIf"],["matInput","","formControlName","version","placeholder","Ex. 2022","required",""],["matInput","","formControlName","description","placeholder","Description du r\xE9f\xE9rentiel normatif","rows","4"],["align","end"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(i,o){if(i&1&&(n(0,"h2",0),a(1),r(),n(2,"form",1),g("ngSubmit",function(){return o.onSubmit()}),n(3,"mat-dialog-content")(4,"div",2),_(5,"input",3),n(6,"mat-form-field",4)(7,"mat-label"),a(8,"Nom"),r(),_(9,"input",5),d(10,ur,2,0,"mat-error",6)(11,fr,2,0,"mat-error",6),r(),n(12,"mat-form-field",4)(13,"mat-label"),a(14,"Version"),r(),_(15,"input",7),d(16,_r,2,0,"mat-error",6)(17,gr,2,0,"mat-error",6),r(),n(18,"mat-form-field",4)(19,"mat-label"),a(20,"Description"),r(),_(21,"textarea",8),d(22,hr,2,0,"mat-error",6),r()()(),n(23,"mat-dialog-actions",9)(24,"button",10),g("click",function(){return o.onCancel()}),a(25,"Annuler"),r(),n(26,"button",11),a(27),r()()()),i&2){let m,p,h,U,he;l(),x(o.dialogTitle),l(),c("formGroup",o.frameworkForm),l(8),c("ngIf",(m=o.frameworkForm.get("name"))==null?null:m.hasError("required")),l(),c("ngIf",(p=o.frameworkForm.get("name"))==null?null:p.hasError("maxlength")),l(5),c("ngIf",(h=o.frameworkForm.get("version"))==null?null:h.hasError("required")),l(),c("ngIf",(U=o.frameworkForm.get("version"))==null?null:U.hasError("maxlength")),l(5),c("ngIf",(he=o.frameworkForm.get("description"))==null?null:he.hasError("maxlength")),l(4),c("disabled",o.frameworkForm.invalid),l(),C(" ",o.isEditMode?"Mettre \xE0 jour":"Cr\xE9er"," ")}},dependencies:[I,ye,we,ke,xe,Se,Me,Ee,A,Ke,Je,Xe,L,q,Pe,z],styles:[".form-fields[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;padding:8px 0}.full-width[_ngcontent-%COMP%]{width:100%}mat-dialog-content[_ngcontent-%COMP%]{min-width:400px}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 0 8px}"]})}}return t})();var j=(()=>{class t{constructor(e){this.apiService=e,this.basePath="/compliance-frameworks"}getFrameworks(){return this.apiService.get(this.basePath).pipe(O(e=>(console.error("Erreur lors de la r\xE9cup\xE9ration des frameworks de conformit\xE9",e),F(()=>new Error("Impossible de r\xE9cup\xE9rer la liste des frameworks de conformit\xE9. Veuillez r\xE9essayer.")))))}getFramework(e){return this.apiService.get(`${this.basePath}/${e}`).pipe(O(i=>(console.error(`Erreur lors de la r\xE9cup\xE9ration du framework ${e}`,i),F(()=>new Error("Impossible de r\xE9cup\xE9rer les d\xE9tails du framework. Veuillez r\xE9essayer.")))))}createFramework(e){return this.apiService.post(this.basePath,e).pipe(O(i=>{console.error("Erreur lors de la cr\xE9ation du framework",i);let o=this.getErrorMessage(i)||"Impossible de cr\xE9er le framework. Veuillez r\xE9essayer.";return F(()=>new Error(o))}))}updateFramework(e,i){return this.apiService.put(`${this.basePath}/${e}`,i).pipe(O(o=>{console.error(`Erreur lors de la mise \xE0 jour du framework ${e}`,o);let m=this.getErrorMessage(o)||"Impossible de mettre \xE0 jour le framework. Veuillez r\xE9essayer.";return F(()=>new Error(m))}))}deleteFramework(e){return this.apiService.delete(`${this.basePath}/${e}`).pipe(O(i=>(console.error(`Erreur lors de la suppression du framework ${e}`,i),F(()=>new Error("Impossible de supprimer le framework. Veuillez r\xE9essayer.")))))}getErrorMessage(e){if(e.error){if(typeof e.error=="string")return e.error;if(e.error.message)return e.error.message;if(typeof e.error=="object"){let i=Object.entries(e.error).map(([o,m])=>`${o}: ${m}`).join(", ");if(i)return`Erreurs de validation: ${i}`}}return e.statusText||"Une erreur est survenue"}static{this.\u0275fac=function(i){return new(i||t)(ge(Ze))}}static{this.\u0275prov=ve({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var vr=()=>[5,10,25,100],br=t=>["/compliance/frameworks",t];function Cr(t,s){t&1&&_(0,"mat-progress-bar",24)}function wr(t,s){if(t&1&&(n(0,"div",25)(1,"mat-icon"),a(2,"error"),r(),n(3,"span"),a(4),r()()),t&2){let e=f(2);l(4),x(e.error)}}function kr(t,s){if(t&1&&(n(0,"div",21),d(1,Cr,1,0,"mat-progress-bar",22)(2,wr,5,1,"div",23),r()),t&2){let e=f();l(),c("ngIf",e.isLoading),l(),c("ngIf",e.error)}}function xr(t,s){t&1&&(n(0,"th",26),a(1," Nom "),r())}function yr(t,s){if(t&1&&(n(0,"td",27),a(1),r()),t&2){let e=s.$implicit;l(),C(" ",e.name," ")}}function Mr(t,s){t&1&&(n(0,"th",26),a(1," Version "),r())}function Er(t,s){if(t&1&&(n(0,"td",27),a(1),r()),t&2){let e=s.$implicit;l(),C(" ",e.version," ")}}function Sr(t,s){t&1&&(n(0,"th",28),a(1," Description "),r())}function Or(t,s){if(t&1&&(n(0,"td",27),a(1),r()),t&2){let e=s.$implicit;l(),C(" ",e.description," ")}}function Ir(t,s){t&1&&(n(0,"th",28),a(1," Actions "),r())}function Pr(t,s){if(t&1){let e=S();n(0,"td",27)(1,"button",29)(2,"mat-icon"),a(3,"visibility"),r()(),n(4,"button",30),g("click",function(){let o=v(e).$implicit,m=f();return b(m.openFrameworkDialog(o))}),n(5,"mat-icon"),a(6,"edit"),r()(),n(7,"button",31),g("click",function(){let o=v(e).$implicit,m=f();return b(m.deleteFramework(o.id))}),n(8,"mat-icon"),a(9,"delete"),r()()()}if(t&2){let e=s.$implicit;l(),c("routerLink",lt(1,br,e.id))}}function Fr(t,s){t&1&&_(0,"tr",32)}function Tr(t,s){t&1&&_(0,"tr",33)}function Rr(t,s){if(t&1&&(n(0,"span"),a(1),r()),t&2){f(2);let e=B(12);l(),C('Aucun r\xE9f\xE9rentiel trouv\xE9 pour "',e.value,'"')}}function Dr(t,s){t&1&&(n(0,"span"),a(1,"Aucun r\xE9f\xE9rentiel disponible"),r())}function Ar(t,s){if(t&1&&(n(0,"tr",34)(1,"td",35)(2,"div",36)(3,"mat-icon"),a(4,"info"),r(),d(5,Rr,2,1,"span",37)(6,Dr,2,0,"span",37),r()()()),t&2){let e=f(),i=B(12);l(5),c("ngIf",i.value),l(),c("ngIf",!i.value&&!e.isLoading&&!e.error)}}var Bi=(()=>{class t{constructor(e,i){this.frameworkService=e,this.dialog=i,this.displayedColumns=["name","version","description","actions"],this.dataSource=new pe([]),this.isLoading=!0,this.error=null}ngOnInit(){this.loadFrameworks()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}applyFilter(e){let i=e.target.value;this.dataSource.filter=i.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}loadFrameworks(){this.isLoading=!0,this.error=null,this.frameworkService.getFrameworks().subscribe({next:e=>{this.dataSource.data=e,this.isLoading=!1},error:e=>{console.error("Erreur lors du chargement des frameworks",e),this.error="Impossible de charger les frameworks. Veuillez r\xE9essayer.",this.isLoading=!1}})}openFrameworkDialog(e){this.dialog.open(Ot,{width:"500px",data:e||{}}).afterClosed().subscribe(o=>{o&&(o.id?this.updateFramework(o):this.createFramework(o))})}createFramework(e){this.frameworkService.createFramework(e).subscribe({next:i=>{this.dataSource.data=[...this.dataSource.data,i]},error:i=>{console.error("Erreur lors de la cr\xE9ation du framework",i)}})}updateFramework(e){this.frameworkService.updateFramework(e.id,e).subscribe({next:i=>{let o=this.dataSource.data.findIndex(m=>m.id===i.id);if(o!==-1){let m=[...this.dataSource.data];m[o]=i,this.dataSource.data=m}},error:i=>{console.error("Erreur lors de la mise \xE0 jour du framework",i)}})}deleteFramework(e){confirm("\xCAtes-vous s\xFBr de vouloir supprimer ce framework? Cette action est irr\xE9versible.")&&this.frameworkService.deleteFramework(e).subscribe({next:()=>{this.dataSource.data=this.dataSource.data.filter(i=>i.id!==e)},error:i=>{console.error("Erreur lors de la suppression du framework",i)}})}static{this.\u0275fac=function(i){return new(i||t)(u(j),u(Fe))}}static{this.\u0275cmp=M({type:t,selectors:[["app-frameworks"]],viewQuery:function(i,o){if(i&1&&(T(V,5),T(P,5)),i&2){let m;R(m=D())&&(o.paginator=m.first),R(m=D())&&(o.sort=m.first)}},decls:34,vars:6,consts:[["input",""],[1,"frameworks-container"],[1,"frameworks-header"],["mat-raised-button","","color","primary",3,"click"],["appearance","outline",1,"filter-field"],["matInput","","placeholder","Ex. ISO 27001",3,"keyup"],["matSuffix",""],["class","loading-error-container",4,"ngIf"],[1,"mat-elevation-z2","data-table-container"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","version"],["matColumnDef","description"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"pageSizeOptions"],[1,"loading-error-container"],["mode","indeterminate",4,"ngIf"],["class","error-message",4,"ngIf"],["mode","indeterminate"],[1,"error-message"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","color","primary","matTooltip","Voir les d\xE9tails",3,"routerLink"],["mat-icon-button","","color","accent","matTooltip","Modifier",3,"click"],["mat-icon-button","","color","warn","matTooltip","Supprimer",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell"],[1,"no-data-message"],[4,"ngIf"]],template:function(i,o){if(i&1){let m=S();n(0,"div",1)(1,"div",2)(2,"h2"),a(3,"R\xE9f\xE9rentiels Normatifs"),r(),n(4,"button",3),g("click",function(){return v(m),b(o.openFrameworkDialog())}),n(5,"mat-icon"),a(6,"add"),r(),a(7," Nouveau R\xE9f\xE9rentiel "),r()(),n(8,"mat-form-field",4)(9,"mat-label"),a(10,"Rechercher"),r(),n(11,"input",5,0),g("keyup",function(h){return v(m),b(o.applyFilter(h))}),r(),n(13,"mat-icon",6),a(14,"search"),r()(),d(15,kr,3,2,"div",7),n(16,"div",8)(17,"table",9),w(18,10),d(19,xr,2,0,"th",11)(20,yr,2,1,"td",12),k(),w(21,13),d(22,Mr,2,0,"th",11)(23,Er,2,1,"td",12),k(),w(24,14),d(25,Sr,2,0,"th",15)(26,Or,2,1,"td",12),k(),w(27,16),d(28,Ir,2,0,"th",15)(29,Pr,10,3,"td",12),k(),d(30,Fr,1,0,"tr",17)(31,Tr,1,0,"tr",18)(32,Ar,7,2,"tr",19),r(),_(33,"mat-paginator",20),r()()}i&2&&(l(15),c("ngIf",o.isLoading||o.error),l(2),c("dataSource",o.dataSource),l(13),c("matHeaderRowDef",o.displayedColumns),l(),c("matRowDefColumns",o.displayedColumns),l(2),c("pageSizeOptions",ee(5,vr)))},dependencies:[I,ze,A,$,L,q,Qe,G,z,V,W,P,ue,ie,ne,se,oe,re,me,ae,le,ce,de,Ie,Q],styles:[".frameworks-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.frameworks-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.frameworks-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:500}.filter-field[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}.loading-error-container[_ngcontent-%COMP%]{margin-bottom:16px}.loading-error-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{display:flex;align-items:center;color:#f44336;padding:8px;border-radius:4px;background-color:#f443361a}.loading-error-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.data-table-container[_ngcontent-%COMP%]{flex:1;overflow:auto;position:relative;border-radius:4px}.data-table-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%}.data-table-container[_ngcontent-%COMP%]   .mat-column-name[_ngcontent-%COMP%]{min-width:150px;max-width:250px}.data-table-container[_ngcontent-%COMP%]   .mat-column-version[_ngcontent-%COMP%]{min-width:100px;max-width:150px}.data-table-container[_ngcontent-%COMP%]   .mat-column-description[_ngcontent-%COMP%]{min-width:200px}.data-table-container[_ngcontent-%COMP%]   .mat-column-actions[_ngcontent-%COMP%]{min-width:120px;max-width:120px;text-align:center}.data-table-container[_ngcontent-%COMP%]   td.mat-cell[_ngcontent-%COMP%], .data-table-container[_ngcontent-%COMP%]   th.mat-header-cell[_ngcontent-%COMP%]{padding:0 16px}.data-table-container[_ngcontent-%COMP%]   .no-data-message[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:24px;color:#0000008a}.data-table-container[_ngcontent-%COMP%]   .no-data-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}"]})}}return t})();var _e=function(t){return t.PREVENTIVE="PREVENTIVE",t.DETECTIVE="DETECTIVE",t.CORRECTIVE="CORRECTIVE",t}(_e||{}),y=function(t){return t.COMPLIANT="COMPLIANT",t.NON_COMPLIANT="NON_COMPLIANT",t.PARTIALLY_COMPLIANT="PARTIALLY_COMPLIANT",t.NOT_APPLICABLE="NOT_APPLICABLE",t}(y||{});function qr(t,s){if(t&1&&(n(0,"mat-option",17),a(1),r()),t&2){let e=s.$implicit;c("value",e.id),l(),H(" ",e.name," (",e.version,") ")}}function Lr(t,s){t&1&&(n(0,"mat-error"),a(1," Le r\xE9f\xE9rentiel est obligatoire "),r())}function Vr(t,s){t&1&&(n(0,"mat-error"),a(1," Le code est obligatoire "),r())}function Nr(t,s){t&1&&(n(0,"mat-error"),a(1," Le code ne doit pas d\xE9passer 50 caract\xE8res "),r())}function jr(t,s){t&1&&(n(0,"mat-error"),a(1," Le type est obligatoire "),r())}function Br(t,s){t&1&&(n(0,"mat-error"),a(1," La description est obligatoire "),r())}function zr(t,s){t&1&&(n(0,"mat-error"),a(1," La description ne doit pas d\xE9passer 500 caract\xE8res "),r())}var Rt=(()=>{class t{constructor(e,i,o){this.fb=e,this.dialogRef=i,this.data=o,this.isEditMode=!1,this.dialogTitle="Cr\xE9er une Exigence",this.frameworks=[],this.frameworks=o.frameworks||[]}ngOnInit(){this.isEditMode=!!this.data.requirement?.id,this.isEditMode&&(this.dialogTitle="Modifier l'Exigence"),this.initForm()}initForm(){let e=this.data.requirement||{};this.requirementForm=this.fb.group({id:[e.id],code:[e.code||"",[E.required,E.maxLength(50)]],description:[e.description||"",[E.required,E.maxLength(500)]],type:[e.type||_e.PREVENTIVE,E.required],frameworkId:[e.frameworkId||"",E.required]}),console.log("Framework de l'exigence en \xE9dition :",e.framework),this.isEditMode&&e.framework&&(this.requirementForm.patchValue({frameworkId:e.framework.id}),console.log("Framework ID pr\xE9-rempli :",e.framework.id))}onSubmit(){if(this.requirementForm.valid){let e=this.requirementForm.value,i=pt({},e);this.dialogRef.close(i)}}onCancel(){this.dialogRef.close()}static{this.\u0275fac=function(i){return new(i||t)(u(Oe),u(Ue),u(Ye))}}static{this.\u0275cmp=M({type:t,selectors:[["app-requirement-form-dialog"]],decls:40,vars:11,consts:[["mat-dialog-title",""],[3,"ngSubmit","formGroup"],[1,"form-fields"],["type","hidden","formControlName","id"],["appearance","outline",1,"full-width"],["formControlName","frameworkId","required",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["matInput","","formControlName","code","placeholder","Ex. A.5.1","required",""],["formControlName","type","required",""],["value","PREVENTIVE"],["value","DETECTIVE"],["value","CORRECTIVE"],["matInput","","formControlName","description","placeholder","Description de l'exigence","rows","4","required",""],["align","end"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[3,"value"]],template:function(i,o){if(i&1&&(n(0,"h2",0),a(1),r(),n(2,"form",1),g("ngSubmit",function(){return o.onSubmit()}),n(3,"mat-dialog-content")(4,"div",2),_(5,"input",3),n(6,"mat-form-field",4)(7,"mat-label"),a(8,"R\xE9f\xE9rentiel"),r(),n(9,"mat-select",5),d(10,qr,2,3,"mat-option",6),r(),d(11,Lr,2,0,"mat-error",7),r(),n(12,"mat-form-field",4)(13,"mat-label"),a(14,"Code"),r(),_(15,"input",8),d(16,Vr,2,0,"mat-error",7)(17,Nr,2,0,"mat-error",7),r(),n(18,"mat-form-field",4)(19,"mat-label"),a(20,"Type"),r(),n(21,"mat-select",9)(22,"mat-option",10),a(23,"Pr\xE9ventif"),r(),n(24,"mat-option",11),a(25,"D\xE9tectif"),r(),n(26,"mat-option",12),a(27,"Correctif"),r()(),d(28,jr,2,0,"mat-error",7),r(),n(29,"mat-form-field",4)(30,"mat-label"),a(31,"Description"),r(),_(32,"textarea",13),d(33,Br,2,0,"mat-error",7)(34,zr,2,0,"mat-error",7),r()()(),n(35,"mat-dialog-actions",14)(36,"button",15),g("click",function(){return o.onCancel()}),a(37,"Annuler"),r(),n(38,"button",16),a(39),r()()()),i&2){let m,p,h,U,he,Ut;l(),x(o.dialogTitle),l(),c("formGroup",o.requirementForm),l(8),c("ngForOf",o.frameworks),l(),c("ngIf",(m=o.requirementForm.get("frameworkId"))==null?null:m.hasError("required")),l(5),c("ngIf",(p=o.requirementForm.get("code"))==null?null:p.hasError("required")),l(),c("ngIf",(h=o.requirementForm.get("code"))==null?null:h.hasError("maxlength")),l(11),c("ngIf",(U=o.requirementForm.get("type"))==null?null:U.hasError("required")),l(5),c("ngIf",(he=o.requirementForm.get("description"))==null?null:he.hasError("required")),l(),c("ngIf",(Ut=o.requirementForm.get("description"))==null?null:Ut.hasError("maxlength")),l(4),c("disabled",o.requirementForm.invalid),l(),C(" ",o.isEditMode?"Mettre \xE0 jour":"Cr\xE9er"," ")}},dependencies:[te,I,ye,we,ke,xe,Se,Me,Ee,A,Ke,Je,Xe,L,q,Pe,z,fe,J],styles:[".form-fields[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;padding:8px 0}.full-width[_ngcontent-%COMP%]{width:100%}mat-dialog-content[_ngcontent-%COMP%]{min-width:400px}mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 0 8px}"]})}}return t})();var De=(()=>{class t{constructor(e){this.apiService=e,this.basePath="/compliance-requirements"}getRequirements(){return this.apiService.get(this.basePath).pipe(O(e=>(console.error("Erreur lors de la r\xE9cup\xE9ration des exigences de conformit\xE9",e),F(()=>new Error("Impossible de r\xE9cup\xE9rer la liste des exigences de conformit\xE9. Veuillez r\xE9essayer.")))))}getRequirementsByFramework(e){return this.apiService.get(`${this.basePath}?frameworkId=${e}`).pipe(O(i=>(console.error(`Erreur lors de la r\xE9cup\xE9ration des exigences du framework ${e}`,i),F(()=>new Error("Impossible de r\xE9cup\xE9rer les exigences de ce framework. Veuillez r\xE9essayer.")))))}getRequirementsByType(e){return this.apiService.get(`${this.basePath}?type=${e}`).pipe(O(i=>(console.error(`Erreur lors de la r\xE9cup\xE9ration des exigences de type ${e}`,i),F(()=>new Error(`Impossible de r\xE9cup\xE9rer les exigences de type ${e}. Veuillez r\xE9essayer.`)))))}getRequirement(e){return this.apiService.get(`${this.basePath}/${e}`).pipe(O(i=>(console.error(`Erreur lors de la r\xE9cup\xE9ration de l'exigence ${e}`,i),F(()=>new Error("Impossible de r\xE9cup\xE9rer les d\xE9tails de l'exigence. Veuillez r\xE9essayer.")))))}createRequirement(e){return this.apiService.post(this.basePath,e).pipe(O(i=>{console.error("Erreur lors de la cr\xE9ation de l'exigence",i);let o=this.getErrorMessage(i)||"Impossible de cr\xE9er l'exigence. Veuillez r\xE9essayer.";return F(()=>new Error(o))}))}updateRequirement(e,i){return this.apiService.put(`${this.basePath}/${e}`,i).pipe(O(o=>{console.error(`Erreur lors de la mise \xE0 jour de l'exigence ${e}`,o);let m=this.getErrorMessage(o)||"Impossible de mettre \xE0 jour l'exigence. Veuillez r\xE9essayer.";return F(()=>new Error(m))}))}deleteRequirement(e){return this.apiService.delete(`${this.basePath}/${e}`).pipe(O(i=>(console.error(`Erreur lors de la suppression de l'exigence ${e}`,i),F(()=>new Error("Impossible de supprimer l'exigence. Veuillez r\xE9essayer.")))))}getErrorMessage(e){if(e.error){if(typeof e.error=="string")return e.error;if(e.error.message)return e.error.message;if(typeof e.error=="object"){let i=Object.entries(e.error).map(([o,m])=>`${o}: ${m}`).join(", ");if(i)return`Erreurs de validation: ${i}`}}return e.statusText||"Une erreur est survenue"}static{this.\u0275fac=function(i){return new(i||t)(ge(Ze))}}static{this.\u0275prov=ve({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Gr=()=>["admin"],Hr=t=>["/compliance/requirements",t],$r=t=>["/compliance/frameworks/edit",t];function Qr(t,s){t&1&&_(0,"mat-progress-bar",8)}function Wr(t,s){if(t&1&&(n(0,"div",9)(1,"mat-icon"),a(2,"error"),r(),n(3,"span"),a(4),r()()),t&2){let e=f(2);l(4),x(e.error)}}function Ur(t,s){if(t&1&&(n(0,"div",5),d(1,Qr,1,0,"mat-progress-bar",6)(2,Wr,5,1,"div",7),r()),t&2){let e=f();l(),c("ngIf",e.isLoading),l(),c("ngIf",e.error)}}function Yr(t,s){if(t&1&&(n(0,"p"),a(1),r()),t&2){let e=f(2);l(),x(e.framework.description)}}function Kr(t,s){t&1&&(n(0,"p")(1,"em"),a(2,"Aucune description fournie"),r()())}function Xr(t,s){t&1&&(n(0,"th",31),a(1," Code "),r())}function Jr(t,s){if(t&1&&(n(0,"td",32),a(1),r()),t&2){let e=s.$implicit;l(),C(" ",e.code," ")}}function Zr(t,s){t&1&&(n(0,"th",33),a(1," Description "),r())}function en(t,s){if(t&1&&(n(0,"td",32),a(1),r()),t&2){let e=s.$implicit;l(),C(" ",e.description," ")}}function tn(t,s){t&1&&(n(0,"th",31),a(1," Type "),r())}function rn(t,s){if(t&1&&(n(0,"td",32)(1,"span",34),a(2),r()()),t&2){let e=s.$implicit;l(),c("ngClass","type-badge "+e.type.toLowerCase()),l(),C(" ",e.type," ")}}function nn(t,s){t&1&&(n(0,"th",33),a(1," Actions "),r())}function on(t,s){if(t&1){let e=S();n(0,"td",32)(1,"button",35)(2,"mat-icon"),a(3,"visibility"),r()(),n(4,"button",36),g("click",function(){let o=v(e).$implicit,m=f(2);return b(m.openRequirementDialog(o))}),n(5,"mat-icon"),a(6,"edit"),r()(),n(7,"button",37),g("click",function(){let o=v(e).$implicit,m=f(2);return b(m.deleteRequirement(o.id))}),n(8,"mat-icon"),a(9,"delete"),r()()()}if(t&2){let e=s.$implicit;l(),c("routerLink",lt(1,Hr,e.id))}}function an(t,s){t&1&&_(0,"tr",38)}function ln(t,s){t&1&&_(0,"tr",39)}function sn(t,s){t&1&&(n(0,"tr",40)(1,"td",41)(2,"div",42)(3,"mat-icon"),a(4,"info"),r(),n(5,"span"),a(6,"Aucune exigence disponible pour ce r\xE9f\xE9rentiel"),r()()()())}function mn(t,s){if(t&1&&(n(0,"button",43)(1,"mat-icon"),a(2,"edit"),r(),a(3," Modifier le r\xE9f\xE9rentiel "),r()),t&2){let e=f(2);c("routerLink",lt(1,$r,e.framework.id))}}function cn(t,s){if(t&1){let e=S();n(0,"div",10)(1,"mat-card",11)(2,"mat-card-header")(3,"mat-card-title",12)(4,"span"),a(5),r(),n(6,"button",13),g("click",function(){v(e);let o=f();return b(o.openFrameworkDialog())}),n(7,"mat-icon"),a(8,"edit"),r()()()(),n(9,"mat-card-content"),d(10,Yr,2,1,"p",14)(11,Kr,3,0,"p",14),r()(),n(12,"div",15)(13,"div",16)(14,"h2"),a(15,"Exigences du r\xE9f\xE9rentiel"),r(),n(16,"button",17),g("click",function(){v(e);let o=f();return b(o.openRequirementDialog())}),n(17,"mat-icon"),a(18,"add"),r(),a(19," Nouvelle Exigence "),r()(),n(20,"div",18)(21,"table",19),w(22,20),d(23,Xr,2,0,"th",21)(24,Jr,2,1,"td",22),k(),w(25,23),d(26,Zr,2,0,"th",24)(27,en,2,1,"td",22),k(),w(28,25),d(29,tn,2,0,"th",21)(30,rn,3,2,"td",22),k(),w(31,26),d(32,nn,2,0,"th",24)(33,on,10,3,"td",22),k(),d(34,an,1,0,"tr",27)(35,ln,1,0,"tr",28)(36,sn,7,0,"tr",29),r()()(),d(37,mn,4,3,"button",30),r()}if(t&2){let e=f();l(5),H("",e.framework.name," ",e.framework.version,""),l(5),c("ngIf",e.framework.description),l(),c("ngIf",!e.framework.description),l(10),c("dataSource",e.requirementsDataSource),l(13),c("matHeaderRowDef",e.displayedColumns),l(),c("matRowDefColumns",e.displayedColumns),l(2),c("appHasRole",ee(8,Gr))}}var Gi=(()=>{class t{constructor(e,i,o,m,p){this.route=e,this.router=i,this.frameworkService=o,this.requirementService=m,this.dialog=p,this.framework=null,this.requirementsDataSource=new pe([]),this.displayedColumns=["code","description","type","actions"],this.isLoading=!0,this.error=null}ngOnInit(){this.route.paramMap.subscribe(e=>{let i=e.get("id");i?this.loadFramework(i):(this.error="Identifiant du framework manquant",this.isLoading=!1)})}loadFramework(e){this.isLoading=!0,this.error=null,this.frameworkService.getFramework(e).subscribe({next:i=>{this.framework=i,this.loadRequirements(e)},error:i=>{console.error(`Erreur lors du chargement du framework ${e}`,i),this.error="Impossible de charger les d\xE9tails du framework. Veuillez r\xE9essayer.",this.isLoading=!1}})}loadRequirements(e){this.requirementService.getRequirementsByFramework(e).subscribe({next:i=>{this.requirementsDataSource.data=i,this.isLoading=!1},error:i=>{console.error(`Erreur lors du chargement des exigences du framework ${e}`,i),this.error="Impossible de charger les exigences du framework. Veuillez r\xE9essayer.",this.isLoading=!1}})}openFrameworkDialog(){if(!this.framework)return;this.dialog.open(Ot,{width:"500px",data:this.framework}).afterClosed().subscribe(i=>{i&&this.updateFramework(i)})}updateFramework(e){this.framework&&this.frameworkService.updateFramework(e.id,e).subscribe({next:i=>{this.framework=i},error:i=>{console.error(`Erreur lors de la mise \xE0 jour du framework ${e.id}`,i)}})}openRequirementDialog(e){if(!this.framework)return;let i=e?pt({},e):{framework:this.framework};this.dialog.open(Rt,{width:"500px",data:i}).afterClosed().subscribe(m=>{m&&(m.id?this.updateRequirement(m):this.createRequirement(m))})}createRequirement(e){this.requirementService.createRequirement(e).subscribe({next:i=>{this.requirementsDataSource.data=[...this.requirementsDataSource.data,i]},error:i=>{console.error("Erreur lors de la cr\xE9ation de l'exigence",i)}})}updateRequirement(e){this.requirementService.updateRequirement(e.id,e).subscribe({next:i=>{let o=this.requirementsDataSource.data.findIndex(m=>m.id===i.id);if(o!==-1){let m=[...this.requirementsDataSource.data];m[o]=i,this.requirementsDataSource.data=m}},error:i=>{console.error(`Erreur lors de la mise \xE0 jour de l'exigence ${e.id}`,i)}})}deleteRequirement(e){confirm("\xCAtes-vous s\xFBr de vouloir supprimer cette exigence? Cette action est irr\xE9versible.")&&this.requirementService.deleteRequirement(e).subscribe({next:()=>{this.requirementsDataSource.data=this.requirementsDataSource.data.filter(i=>i.id!==e)},error:i=>{console.error(`Erreur lors de la suppression de l'exigence ${e}`,i)}})}goBack(){this.router.navigate(["/compliance/frameworks"])}static{this.\u0275fac=function(i){return new(i||t)(u(ht),u(Ce),u(j),u(De),u(Fe))}}static{this.\u0275cmp=M({type:t,selectors:[["app-framework-detail"]],decls:7,vars:2,consts:[[1,"framework-detail-container"],[1,"back-button"],["mat-icon-button","","color","primary","matTooltip","Retour \xE0 la liste",3,"click"],["class","loading-error-container",4,"ngIf"],["class","framework-detail-content",4,"ngIf"],[1,"loading-error-container"],["mode","indeterminate",4,"ngIf"],["class","error-message",4,"ngIf"],["mode","indeterminate"],[1,"error-message"],[1,"framework-detail-content"],[1,"framework-info-card"],[1,"card-title"],["mat-icon-button","","color","primary","matTooltip","Modifier",3,"click"],[4,"ngIf"],[1,"requirements-section"],[1,"section-header"],["mat-raised-button","","color","primary",3,"click"],[1,"mat-elevation-z2","data-table-container"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","type"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-raised-button","","color","primary",3,"routerLink",4,"appHasRole"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],[3,"ngClass"],["mat-icon-button","","color","primary","matTooltip","Voir les d\xE9tails",3,"routerLink"],["mat-icon-button","","color","accent","matTooltip","Modifier",3,"click"],["mat-icon-button","","color","warn","matTooltip","Supprimer",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell"],[1,"no-data-message"],["mat-raised-button","","color","primary",3,"routerLink"]],template:function(i,o){i&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return o.goBack()}),n(3,"mat-icon"),a(4,"arrow_back"),r()()(),d(5,Ur,3,2,"div",3)(6,cn,38,9,"div",4),r()),i&2&&(l(5),c("ngIf",o.isLoading||o.error),l(),c("ngIf",o.framework&&!o.isLoading))},dependencies:[Be,I,ze,Mi,A,$,He,$e,Ct,bt,G,W,P,ue,ie,ne,se,oe,re,me,ae,le,ce,de,Ie,Q],styles:[".framework-detail-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.back-button[_ngcontent-%COMP%], .loading-error-container[_ngcontent-%COMP%]{margin-bottom:16px}.loading-error-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{display:flex;align-items:center;color:#f44336;padding:8px;border-radius:4px;background-color:#f443361a}.loading-error-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.framework-detail-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.framework-info-card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.framework-info-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{margin-top:16px}.framework-info-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;line-height:1.5}.requirements-section[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.requirements-section[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:500}.data-table-container[_ngcontent-%COMP%]{overflow:auto;border-radius:4px}.data-table-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%}.data-table-container[_ngcontent-%COMP%]   .mat-column-code[_ngcontent-%COMP%]{min-width:120px;max-width:120px}.data-table-container[_ngcontent-%COMP%]   .mat-column-description[_ngcontent-%COMP%]{min-width:200px}.data-table-container[_ngcontent-%COMP%]   .mat-column-type[_ngcontent-%COMP%]{min-width:120px;max-width:150px}.data-table-container[_ngcontent-%COMP%]   .mat-column-actions[_ngcontent-%COMP%]{min-width:120px;max-width:120px;text-align:center}.data-table-container[_ngcontent-%COMP%]   td.mat-cell[_ngcontent-%COMP%], .data-table-container[_ngcontent-%COMP%]   th.mat-header-cell[_ngcontent-%COMP%]{padding:0 16px}.data-table-container[_ngcontent-%COMP%]   .no-data-message[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:24px;color:#0000008a}.data-table-container[_ngcontent-%COMP%]   .no-data-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.type-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:500;text-transform:uppercase}.type-badge.preventive[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2}.type-badge.detective[_ngcontent-%COMP%]{background-color:#fff8e1;color:#ff8f00}.type-badge.corrective[_ngcontent-%COMP%]{background-color:#ffebee;color:#d32f2f}"]})}}return t})();function dn(t,s){t&1&&_(0,"mat-progress-bar",9)}function pn(t,s){if(t&1&&(n(0,"div",10)(1,"mat-icon"),a(2,"error"),r(),n(3,"span"),a(4),r()()),t&2){let e=f(2);l(4),x(e.error)}}function un(t,s){if(t&1&&(n(0,"div",6),d(1,dn,1,0,"mat-progress-bar",7)(2,pn,5,1,"div",8),r()),t&2){let e=f();l(),c("ngIf",e.isLoading),l(),c("ngIf",e.error)}}function fn(t,s){t&1&&(n(0,"mat-error"),a(1," Le nom est obligatoire "),r())}function _n(t,s){t&1&&(n(0,"mat-error"),a(1," Le nom ne doit pas d\xE9passer 100 caract\xE8res "),r())}function gn(t,s){t&1&&(n(0,"mat-error"),a(1," La version est obligatoire "),r())}function hn(t,s){t&1&&(n(0,"mat-error"),a(1," La version ne doit pas d\xE9passer 20 caract\xE8res "),r())}function vn(t,s){t&1&&(n(0,"mat-error"),a(1," La description ne doit pas d\xE9passer 500 caract\xE8res "),r())}function bn(t,s){if(t&1){let e=S();n(0,"div",11)(1,"form",12),g("ngSubmit",function(){v(e);let o=f();return b(o.onSubmit())}),n(2,"mat-card")(3,"mat-card-content")(4,"mat-form-field",13)(5,"mat-label"),a(6,"Nom"),r(),_(7,"input",14),d(8,fn,2,0,"mat-error",15)(9,_n,2,0,"mat-error",15),r(),n(10,"mat-form-field",13)(11,"mat-label"),a(12,"Version"),r(),_(13,"input",16),d(14,gn,2,0,"mat-error",15)(15,hn,2,0,"mat-error",15),r(),n(16,"mat-form-field",13)(17,"mat-label"),a(18,"Description"),r(),_(19,"textarea",17),d(20,vn,2,0,"mat-error",15),r()(),n(21,"mat-card-actions",18)(22,"button",19),g("click",function(){v(e);let o=f();return b(o.goBack())}),a(23,"Annuler"),r(),n(24,"button",20),a(25," Enregistrer "),r()()()()()}if(t&2){let e,i,o,m,p,h=f();l(),c("formGroup",h.frameworkForm),l(7),c("ngIf",(e=h.frameworkForm.get("name"))==null?null:e.hasError("required")),l(),c("ngIf",(i=h.frameworkForm.get("name"))==null?null:i.hasError("maxlength")),l(5),c("ngIf",(o=h.frameworkForm.get("version"))==null?null:o.hasError("required")),l(),c("ngIf",(m=h.frameworkForm.get("version"))==null?null:m.hasError("maxlength")),l(5),c("ngIf",(p=h.frameworkForm.get("description"))==null?null:p.hasError("maxlength")),l(4),c("disabled",h.frameworkForm.invalid)}}function Cn(t,s){if(t&1){let e=S();n(0,"div",21)(1,"mat-icon",22),a(2,"block"),r(),n(3,"h3"),a(4,"Acc\xE8s non autoris\xE9"),r(),n(5,"p"),a(6,"Vous n'avez pas les droits n\xE9cessaires pour modifier un r\xE9f\xE9rentiel normatif."),r(),n(7,"button",23),g("click",function(){v(e);let o=f();return b(o.goBack())}),a(8,"Retour aux r\xE9f\xE9rentiels"),r()()}}var Hi=(()=>{class t{constructor(e,i,o,m,p){this.fb=e,this.route=i,this.router=o,this.frameworkService=m,this.keycloakService=p,this.isLoading=!0,this.error=null,this.isAdmin=!1}ngOnInit(){if(this.isAdmin=this.keycloakService.hasRole("admin"),!this.isAdmin){console.warn("Utilisateur non autoris\xE9 \xE0 \xE9diter les frameworks"),this.router.navigate(["/compliance/frameworks"]);return}this.initForm(),this.route.paramMap.subscribe(e=>{let i=e.get("id");i?(this.frameworkId=i,this.loadFramework(i)):(this.error="Identifiant du framework manquant",this.isLoading=!1)})}initForm(){this.frameworkForm=this.fb.group({id:[""],name:["",[E.required,E.maxLength(100)]],version:["",[E.required,E.maxLength(20)]],description:["",E.maxLength(500)]})}loadFramework(e){this.isLoading=!0,this.error=null,this.frameworkService.getFramework(e).subscribe({next:i=>{this.framework=i,this.frameworkForm.patchValue({id:i.id,name:i.name,version:i.version,description:i.description||""}),this.isLoading=!1},error:i=>{console.error(`Erreur lors du chargement du framework ${e}`,i),this.error="Impossible de charger les d\xE9tails du framework. Veuillez r\xE9essayer.",this.isLoading=!1}})}onSubmit(){if(this.frameworkForm.invalid)return;let e=this.frameworkForm.value;this.isLoading=!0,this.frameworkService.updateFramework(this.frameworkId,e).subscribe({next:()=>{this.isLoading=!1,this.router.navigate(["/compliance/frameworks",this.frameworkId])},error:i=>{console.error(`Erreur lors de la mise \xE0 jour du framework ${this.frameworkId}`,i),this.error="Impossible de mettre \xE0 jour le framework. Veuillez r\xE9essayer.",this.isLoading=!1}})}goBack(){this.router.navigate(["/compliance/frameworks",this.frameworkId])}static{this.\u0275fac=function(i){return new(i||t)(u(Oe),u(ht),u(Ce),u(j),u(kt))}}static{this.\u0275cmp=M({type:t,selectors:[["app-framework-edit"]],decls:10,vars:3,consts:[[1,"framework-edit-container"],[1,"back-button"],["mat-icon-button","","color","primary","matTooltip","Retour au framework",3,"click"],["class","loading-error-container",4,"ngIf"],["class","form-container",4,"ngIf"],["class","not-authorized",4,"ngIf"],[1,"loading-error-container"],["mode","indeterminate",4,"ngIf"],["class","error-message",4,"ngIf"],["mode","indeterminate"],[1,"error-message"],[1,"form-container"],[3,"ngSubmit","formGroup"],["appearance","outline",1,"form-field"],["matInput","","formControlName","name","placeholder","Ex: ISO 27001","required",""],[4,"ngIf"],["matInput","","formControlName","version","placeholder","Ex: 2022","required",""],["matInput","","formControlName","description","placeholder","Description du r\xE9f\xE9rentiel normatif","rows","4"],["align","end"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[1,"not-authorized"],["color","warn"],["mat-raised-button","","color","primary",3,"click"]],template:function(i,o){i&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return o.goBack()}),n(3,"mat-icon"),a(4,"arrow_back"),r()()(),n(5,"h2"),a(6,"Modifier le R\xE9f\xE9rentiel Normatif"),r(),d(7,un,3,2,"div",3)(8,bn,26,7,"div",4)(9,Cn,9,0,"div",5),r()),i&2&&(l(7),c("ngIf",o.isLoading||o.error),l(),c("ngIf",!o.isLoading&&!o.error&&o.isAdmin),l(),c("ngIf",!o.isLoading&&!o.error&&!o.isAdmin))},dependencies:[I,ye,we,ke,xe,Se,Me,Ee,A,$,He,di,$e,L,q,Pe,G,z,W,Q],styles:[".framework-edit-container[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:0 auto}.back-button[_ngcontent-%COMP%]{margin-bottom:16px}h2[_ngcontent-%COMP%]{margin-bottom:24px;color:#3f51b5}.loading-error-container[_ngcontent-%COMP%]{margin-bottom:16px}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;background-color:#ffebee;color:#d32f2f;padding:8px 16px;border-radius:4px;margin-top:8px}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.form-container[_ngcontent-%COMP%]{margin-top:16px}.form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}mat-card[_ngcontent-%COMP%]{margin-bottom:24px}mat-card-content[_ngcontent-%COMP%]{padding:16px}.not-authorized[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 16px;text-align:center;background-color:#f5f5f5;border-radius:8px;margin-top:24px}.not-authorized[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;height:48px;width:48px;margin-bottom:16px}.not-authorized[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:16px;color:#d32f2f}.not-authorized[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:16px}"]})}}return t})();var wn=()=>[5,10,25,100];function kn(t,s){if(t&1&&(n(0,"mat-option",11),a(1),r()),t&2){let e=s.$implicit;c("value",e.id),l(),H(" ",e.name," (",e.version,") ")}}function xn(t,s){t&1&&_(0,"mat-progress-bar",34)}function yn(t,s){if(t&1&&(n(0,"div",35)(1,"mat-icon"),a(2,"error"),r(),n(3,"span"),a(4),r()()),t&2){let e=f(2);l(4),x(e.error)}}function Mn(t,s){if(t&1&&(n(0,"div",31),d(1,xn,1,0,"mat-progress-bar",32)(2,yn,5,1,"div",33),r()),t&2){let e=f();l(),c("ngIf",e.isLoading),l(),c("ngIf",e.error)}}function En(t,s){t&1&&(n(0,"th",36),a(1," Code "),r())}function Sn(t,s){if(t&1&&(n(0,"td",37),a(1),r()),t&2){let e=s.$implicit;l(),C(" ",e.code," ")}}function On(t,s){t&1&&(n(0,"th",36),a(1," R\xE9f\xE9rentiel "),r())}function In(t,s){if(t&1&&(n(0,"span",42),a(1),r()),t&2){let e=f(2).$implicit;l(),C("(",e.framework==null?null:e.framework.version,")")}}function Pn(t,s){if(t&1&&(n(0,"div",39)(1,"span",40),a(2),r(),d(3,In,2,1,"span",41),r()),t&2){let e=f().$implicit;l(2),x(e.framework==null?null:e.framework.name),l(),c("ngIf",e.framework==null?null:e.framework.version)}}function Fn(t,s){t&1&&a(0,"-")}function Tn(t,s){if(t&1&&(n(0,"td",37),d(1,Pn,4,2,"div",38)(2,Fn,1,0,"ng-template",null,1,ii),r()),t&2){let e=s.$implicit,i=B(3);l(),c("ngIf",e.framework)("ngIfElse",i)}}function Rn(t,s){t&1&&(n(0,"th",43),a(1," Description "),r())}function Dn(t,s){if(t&1&&(n(0,"td",37),a(1),r()),t&2){let e=s.$implicit;l(),C(" ",e.description," ")}}function An(t,s){t&1&&(n(0,"th",36),a(1," Type "),r())}function qn(t,s){if(t&1&&(n(0,"td",37)(1,"span",44),a(2),r()()),t&2){let e=s.$implicit,i=f();l(),c("ngClass",i.getTypeClass(e.type)),l(),C(" ",i.getTypeLabel(e.type)," ")}}function Ln(t,s){t&1&&(n(0,"th",43),a(1," Actions "),r())}function Vn(t,s){if(t&1){let e=S();n(0,"td",37)(1,"button",45)(2,"mat-icon"),a(3,"visibility"),r()(),n(4,"button",46),g("click",function(){let o=v(e).$implicit,m=f();return b(m.openRequirementDialog(o))}),n(5,"mat-icon"),a(6,"edit"),r()(),n(7,"button",47),g("click",function(){let o=v(e).$implicit,m=f();return b(m.deleteRequirement(o.id))}),n(8,"mat-icon"),a(9,"delete"),r()()()}}function Nn(t,s){t&1&&_(0,"tr",48)}function jn(t,s){t&1&&_(0,"tr",49)}function Bn(t,s){if(t&1&&(n(0,"span"),a(1),r()),t&2){f(2);let e=B(12);l(),C('Aucune exigence trouv\xE9e pour "',e.value,'"')}}function zn(t,s){t&1&&(n(0,"span"),a(1,"Aucune exigence disponible"),r())}function Gn(t,s){if(t&1&&(n(0,"tr",50)(1,"td",51)(2,"div",52)(3,"mat-icon"),a(4,"info"),r(),d(5,Bn,2,1,"span",53)(6,zn,2,0,"span",53),r()()()),t&2){let e=f(),i=B(12);l(5),c("ngIf",i.value),l(),c("ngIf",!i.value&&!e.isLoading&&!e.error)}}var $i=(()=>{class t{constructor(e,i,o){this.requirementService=e,this.frameworkService=i,this.dialog=o,this.displayedColumns=["code","framework","description","type","actions"],this.dataSource=new pe([]),this.frameworks=[],this.selectedFramework="",this.selectedType="",this.isLoading=!0,this.error=null,this.originalData=[]}ngOnInit(){this.loadFrameworks(),this.loadRequirements()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}applyFilter(e){let i=e.target.value;this.dataSource.filter=i.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}loadFrameworks(){this.frameworkService.getFrameworks().subscribe({next:e=>{console.log("Frameworks charg\xE9s :",e),this.frameworks=e},error:e=>{console.error("Erreur lors du chargement des frameworks",e)}})}loadRequirements(e){this.isLoading=!0,this.error=null,e?this.requirementService.getRequirementsByFramework(e).subscribe({next:i=>{this.originalData=i,this.dataSource.data=i,this.selectedType&&this.filterByType(),this.isLoading=!1},error:i=>{console.error(`Erreur lors du chargement des exigences pour le framework ${e}`,i),this.error="Impossible de charger les exigences. Veuillez r\xE9essayer.",this.isLoading=!1}}):this.requirementService.getRequirements().subscribe({next:i=>{this.originalData=i,this.dataSource.data=i,this.selectedType&&this.filterByType(),this.isLoading=!1},error:i=>{console.error("Erreur lors du chargement des exigences",i),this.error="Impossible de charger les exigences. Veuillez r\xE9essayer.",this.isLoading=!1}})}filterByFramework(){this.selectedFramework?this.loadRequirements(this.selectedFramework):this.loadRequirements()}filterByType(){if(this.selectedType){let e=this.originalData.filter(i=>i.type===this.selectedType);this.dataSource.data=e}else this.dataSource.data=this.originalData;this.dataSource.paginator&&this.dataSource.paginator.firstPage()}getTypeLabel(e){switch(e){case _e.PREVENTIVE:return"Pr\xE9ventif";case _e.DETECTIVE:return"D\xE9tectif";case _e.CORRECTIVE:return"Correctif";default:return e}}getTypeClass(e){switch(e){case _e.PREVENTIVE:return"preventive-type";case _e.DETECTIVE:return"detective-type";case _e.CORRECTIVE:return"corrective-type";default:return""}}openRequirementDialog(e){this.dialog.open(Rt,{width:"600px",data:{requirement:e||{},frameworks:this.frameworks}}).afterClosed().subscribe(o=>{o&&(o.id?this.updateRequirement(o):this.createRequirement(o))})}createRequirement(e){this.requirementService.createRequirement(e).subscribe({next:i=>{this.originalData=[...this.originalData,i],this.filterByFramework(),this.filterByType()},error:i=>{console.error("Erreur lors de la cr\xE9ation de l'exigence",i)}})}updateRequirement(e){this.requirementService.updateRequirement(e.id,e).subscribe({next:i=>{let o=this.originalData.findIndex(m=>m.id===i.id);if(o!==-1){let m=[...this.originalData];m[o]=i,this.originalData=m,this.filterByFramework(),this.filterByType()}},error:i=>{console.error("Erreur lors de la mise \xE0 jour de l'exigence",i)}})}deleteRequirement(e){confirm("\xCAtes-vous s\xFBr de vouloir supprimer cette exigence? Cette action est irr\xE9versible.")&&this.requirementService.deleteRequirement(e).subscribe({next:()=>{this.originalData=this.originalData.filter(i=>i.id!==e),this.filterByFramework(),this.filterByType()},error:i=>{console.error("Erreur lors de la suppression de l'exigence",i)}})}static{this.\u0275fac=function(i){return new(i||t)(u(De),u(j),u(Fe))}}static{this.\u0275cmp=M({type:t,selectors:[["app-requirements"]],viewQuery:function(i,o){if(i&1&&(T(V,5),T(P,5)),i&2){let m;R(m=D())&&(o.paginator=m.first),R(m=D())&&(o.sort=m.first)}},decls:57,vars:11,consts:[["input",""],["noFramework",""],[1,"requirements-container"],[1,"requirements-header"],["mat-raised-button","","color","primary",3,"click"],["appearance","outline",1,"filter-field"],["matInput","","placeholder","Ex. SEC-01",3,"keyup"],["matSuffix",""],[1,"filters-container"],["appearance","outline"],[3,"valueChange","selectionChange","value"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["value","PREVENTIVE"],["value","DETECTIVE"],["value","CORRECTIVE"],["class","loading-error-container",4,"ngIf"],[1,"mat-elevation-z2","data-table-container"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","framework"],["matColumnDef","description"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","type"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"pageSizeOptions"],[1,"loading-error-container"],["mode","indeterminate",4,"ngIf"],["class","error-message",4,"ngIf"],["mode","indeterminate"],[1,"error-message"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["class","framework-info",4,"ngIf","ngIfElse"],[1,"framework-info"],[1,"framework-name"],["class","framework-version",4,"ngIf"],[1,"framework-version"],["mat-header-cell",""],[3,"ngClass"],["mat-icon-button","","color","primary","matTooltip","Voir les d\xE9tails"],["mat-icon-button","","color","accent","matTooltip","Modifier",3,"click"],["mat-icon-button","","color","warn","matTooltip","Supprimer",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","5",1,"mat-cell"],[1,"no-data-message"],[4,"ngIf"]],template:function(i,o){if(i&1){let m=S();n(0,"div",2)(1,"div",3)(2,"h2"),a(3,"Exigences de Conformit\xE9"),r(),n(4,"button",4),g("click",function(){return v(m),b(o.openRequirementDialog())}),n(5,"mat-icon"),a(6,"add"),r(),a(7," Nouvelle Exigence "),r()(),n(8,"mat-form-field",5)(9,"mat-label"),a(10,"Rechercher"),r(),n(11,"input",6,0),g("keyup",function(h){return v(m),b(o.applyFilter(h))}),r(),n(13,"mat-icon",7),a(14,"search"),r()(),n(15,"div",8)(16,"mat-form-field",9)(17,"mat-label"),a(18,"R\xE9f\xE9rentiel"),r(),n(19,"mat-select",10),X("valueChange",function(h){return v(m),K(o.selectedFramework,h)||(o.selectedFramework=h),b(h)}),g("selectionChange",function(){return v(m),b(o.filterByFramework())}),n(20,"mat-option",11),a(21,"Tous les r\xE9f\xE9rentiels"),r(),d(22,kn,2,3,"mat-option",12),r()(),n(23,"mat-form-field",9)(24,"mat-label"),a(25,"Type"),r(),n(26,"mat-select",10),X("valueChange",function(h){return v(m),K(o.selectedType,h)||(o.selectedType=h),b(h)}),g("selectionChange",function(){return v(m),b(o.filterByType())}),n(27,"mat-option",11),a(28,"Tous les types"),r(),n(29,"mat-option",13),a(30,"Pr\xE9ventif"),r(),n(31,"mat-option",14),a(32,"D\xE9tectif"),r(),n(33,"mat-option",15),a(34,"Correctif"),r()()()(),d(35,Mn,3,2,"div",16),n(36,"div",17)(37,"table",18),w(38,19),d(39,En,2,0,"th",20)(40,Sn,2,1,"td",21),k(),w(41,22),d(42,On,2,0,"th",20)(43,Tn,4,2,"td",21),k(),w(44,23),d(45,Rn,2,0,"th",24)(46,Dn,2,1,"td",21),k(),w(47,25),d(48,An,2,0,"th",20)(49,qn,3,2,"td",21),k(),w(50,26),d(51,Ln,2,0,"th",24)(52,Vn,10,0,"td",21),k(),d(53,Nn,1,0,"tr",27)(54,jn,1,0,"tr",28)(55,Gn,7,2,"tr",29),r(),_(56,"mat-paginator",30),r()()}i&2&&(l(19),Y("value",o.selectedFramework),l(),c("value",""),l(2),c("ngForOf",o.frameworks),l(4),Y("value",o.selectedType),l(),c("value",""),l(8),c("ngIf",o.isLoading||o.error),l(2),c("dataSource",o.dataSource),l(16),c("matHeaderRowDef",o.displayedColumns),l(),c("matRowDefColumns",o.displayedColumns),l(2),c("pageSizeOptions",ee(10,wn)))},dependencies:[Be,te,I,A,$,L,q,Qe,G,z,V,W,fe,J,P,ue,ie,ne,se,oe,re,me,ae,le,ce,de,Ie,Q],styles:[".requirements-container[_ngcontent-%COMP%]{padding:20px}.requirements-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.requirements-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:500;color:#333}.filter-field[_ngcontent-%COMP%]{width:100%;margin-bottom:15px}.filters-container[_ngcontent-%COMP%]{display:flex;gap:15px;margin-bottom:20px}.filters-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.loading-error-container[_ngcontent-%COMP%]{margin-bottom:15px}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;color:#f44336;padding:10px;border-radius:4px;background-color:#f443361a}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:10px}.data-table-container[_ngcontent-%COMP%]{overflow-x:auto;border-radius:4px}table[_ngcontent-%COMP%]{width:100%}.mat-column-code[_ngcontent-%COMP%]{width:120px}.mat-column-framework[_ngcontent-%COMP%]{width:200px}.mat-column-description[_ngcontent-%COMP%]{min-width:300px}.mat-column-type[_ngcontent-%COMP%]{width:120px}.mat-column-actions[_ngcontent-%COMP%]{width:150px;text-align:center}.no-data-message[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:20px;color:#666}.no-data-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:10px;color:#999}.preventive-type[_ngcontent-%COMP%], .detective-type[_ngcontent-%COMP%], .corrective-type[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;font-size:12px;display:inline-block}.preventive-type[_ngcontent-%COMP%]{background-color:#e8f5e9;color:#2e7d32}.detective-type[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1565c0}.corrective-type[_ngcontent-%COMP%]{background-color:#fff8e1;color:#ff8f00}.framework-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.framework-name[_ngcontent-%COMP%]{font-weight:500;color:#333}.framework-version[_ngcontent-%COMP%]{font-size:.8em;color:#777;margin-top:2px}"]})}}return t})();var Dt=(()=>{class t{constructor(e){this.apiService=e,this.basePath="/risks"}getRisks(){return this.apiService.get(this.basePath).pipe(O(e=>(console.error("Erreur lors de la r\xE9cup\xE9ration des risques",e),F(()=>new Error("Impossible de r\xE9cup\xE9rer la liste des risques. Veuillez r\xE9essayer.")))))}getRisk(e){return this.apiService.get(`${this.basePath}/${e}`).pipe(O(i=>(console.error(`Erreur lors de la r\xE9cup\xE9ration du risque ${e}`,i),F(()=>new Error("Impossible de r\xE9cup\xE9rer les d\xE9tails du risque. Veuillez r\xE9essayer.")))))}static{this.\u0275fac=function(i){return new(i||t)(ge(Ze))}}static{this.\u0275prov=ve({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Hn(t,s){if(t&1&&(n(0,"mat-option",9),a(1),r()),t&2){let e=s.$implicit;c("value",e.id),l(),C(" ",e.name," ")}}function $n(t,s){t&1&&(n(0,"mat-error"),a(1," Le risque est obligatoire "),r())}function Qn(t,s){if(t&1&&(n(0,"mat-option",9),a(1),r()),t&2){let e=s.$implicit;c("value",e.id),l(),H(" ",e.name," (",e.version,") ")}}function Wn(t,s){if(t&1&&(n(0,"mat-option",9),a(1),Ae(2,"slice"),r()),t&2){let e=s.$implicit;c("value",e.id),l(),ei(" ",e.code," - ",st(2,4,e.description,0,50),"",e.description.length>50?"...":""," ")}}function Un(t,s){t&1&&(n(0,"mat-error"),a(1," L'exigence est obligatoire "),r())}function Yn(t,s){t&1&&(n(0,"mat-error"),a(1," Le statut est obligatoire "),r())}function Kn(t,s){t&1&&_(0,"mat-spinner",22)}function Xn(t,s){if(t&1&&(n(0,"span"),a(1),r()),t&2){let e=f();l(),x(e.isEditMode?"Mettre \xE0 jour":"Cr\xE9er")}}var Ui=(()=>{class t{constructor(e,i,o,m,p,h,U){this.fb=e,this.dialogRef=i,this.data=o,this.riskService=m,this.frameworkService=p,this.requirementService=h,this.snackBar=U,this.isEditMode=!1,this.dialogTitle="Cr\xE9er un Mapping Risque-Conformit\xE9",this.isSubmitting=!1,this.risks=[],this.frameworks=[],this.requirements=[],this.filteredRequirements=[],this.selectedFramework=""}ngOnInit(){this.isEditMode=!!this.data?.mapping?.id,this.isEditMode&&(this.dialogTitle="Modifier le Mapping Risque-Conformit\xE9"),this.initForm(),this.loadData()}initForm(){let e=this.data?.mapping||{};this.mappingForm=this.fb.group({id:[e.id],riskId:[e.riskId||"",E.required],requirementId:[e.requirementId||"",E.required],status:[e.status||y.NON_COMPLIANT,E.required],comment:[e.comment||""],evidence:[e.evidence||""]}),this.isEditMode&&e.requirement?.framework&&(this.selectedFramework=e.requirement.framework.id)}loadData(){this.isSubmitting=!0,ut({risks:this.riskService.getRisks(),frameworks:this.frameworkService.getFrameworks()}).subscribe({next:e=>{if(this.risks=e.risks,this.frameworks=e.frameworks,this.isEditMode&&this.data?.mapping){let i=this.data.mapping;i.requirement?.framework?(this.selectedFramework=i.requirement.framework.id,this.loadRequirementsByFramework(this.selectedFramework)):this.loadAllRequirements(),this.mappingForm.patchValue({riskId:i.riskId,requirementId:i.requirementId,status:i.status})}else this.loadAllRequirements()},error:e=>{console.error("Erreur lors du chargement des donn\xE9es",e),this.snackBar.open("Erreur lors du chargement des donn\xE9es. Veuillez r\xE9essayer.","Fermer",{duration:5e3,panelClass:["error-snackbar"]}),this.isSubmitting=!1}})}loadAllRequirements(){this.requirementService.getRequirements().subscribe({next:e=>{this.requirements=e,this.filteredRequirements=e,this.isSubmitting=!1},error:e=>{console.error("Erreur lors du chargement des exigences",e),this.snackBar.open("Erreur lors du chargement des exigences. Veuillez r\xE9essayer.","Fermer",{duration:5e3,panelClass:["error-snackbar"]}),this.isSubmitting=!1}})}loadRequirementsByFramework(e){if(!e){this.loadAllRequirements();return}this.isSubmitting=!0,this.requirementService.getRequirementsByFramework(e).pipe(Yt(()=>this.isSubmitting=!1)).subscribe({next:i=>{this.requirements=i,this.filteredRequirements=i,this.validateRequirementSelection()},error:i=>{console.error(`Erreur lors du chargement des exigences du framework ${e}`,i),this.snackBar.open("Erreur lors du chargement des exigences. Veuillez r\xE9essayer.","Fermer",{duration:5e3,panelClass:["error-snackbar"]})}})}filterRequirements(){this.selectedFramework?this.loadRequirementsByFramework(this.selectedFramework):this.loadAllRequirements()}validateRequirementSelection(){let e=this.mappingForm.get("requirementId")?.value;e&&(this.filteredRequirements.some(o=>o.id===e)||this.mappingForm.patchValue({requirementId:""}))}onFrameworkChange(){this.filterRequirements()}onSubmit(){if(this.mappingForm.valid){this.isSubmitting=!0;let e=this.mappingForm.value;this.dialogRef.close(e)}}onCancel(){this.dialogRef.close()}static{this.\u0275fac=function(i){return new(i||t)(u(Oe),u(Ue),u(Ye),u(Dt),u(j),u(De),u(We))}}static{this.\u0275cmp=M({type:t,selectors:[["app-mapping-form-dialog"]],standalone:!0,features:[at],decls:52,vars:14,consts:[["mat-dialog-title",""],[3,"ngSubmit","formGroup"],[1,"form-fields"],["type","hidden","formControlName","id"],["appearance","outline",1,"full-width"],["formControlName","riskId","required",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"valueChange","selectionChange","value"],[3,"value"],["formControlName","requirementId","required",""],["formControlName","status","required",""],["value","COMPLIANT"],["value","NON_COMPLIANT"],["value","PARTIALLY_COMPLIANT"],["value","NOT_APPLICABLE"],["matInput","","formControlName","comment","placeholder","Commentaire sur le mapping","rows","2"],["matInput","","formControlName","evidence","placeholder","Justificatifs, preuves ou documents associ\xE9s","rows","3"],["align","end"],["mat-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20","class","spinner-button",4,"ngIf"],["diameter","20",1,"spinner-button"]],template:function(i,o){if(i&1&&(n(0,"h2",0),a(1),r(),n(2,"form",1),g("ngSubmit",function(){return o.onSubmit()}),n(3,"mat-dialog-content")(4,"div",2),_(5,"input",3),n(6,"mat-form-field",4)(7,"mat-label"),a(8,"Risque"),r(),n(9,"mat-select",5),d(10,Hn,2,2,"mat-option",6),r(),d(11,$n,2,0,"mat-error",7),r(),n(12,"mat-form-field",4)(13,"mat-label"),a(14,"R\xE9f\xE9rentiel"),r(),n(15,"mat-select",8),X("valueChange",function(p){return K(o.selectedFramework,p)||(o.selectedFramework=p),p}),g("selectionChange",function(){return o.onFrameworkChange()}),n(16,"mat-option",9),a(17,"Tous les r\xE9f\xE9rentiels"),r(),d(18,Qn,2,3,"mat-option",6),r()(),n(19,"mat-form-field",4)(20,"mat-label"),a(21,"Exigence"),r(),n(22,"mat-select",10),d(23,Wn,3,8,"mat-option",6),r(),d(24,Un,2,0,"mat-error",7),r(),n(25,"mat-form-field",4)(26,"mat-label"),a(27,"Statut de conformit\xE9"),r(),n(28,"mat-select",11)(29,"mat-option",12),a(30,"Conforme"),r(),n(31,"mat-option",13),a(32,"Non conforme"),r(),n(33,"mat-option",14),a(34,"Partiellement conforme"),r(),n(35,"mat-option",15),a(36,"Non applicable"),r()(),d(37,Yn,2,0,"mat-error",7),r(),n(38,"mat-form-field",4)(39,"mat-label"),a(40,"Commentaire"),r(),_(41,"textarea",16),r(),n(42,"mat-form-field",4)(43,"mat-label"),a(44,"Preuves/Evidences"),r(),_(45,"textarea",17),r()()(),n(46,"mat-dialog-actions",18)(47,"button",19),g("click",function(){return o.onCancel()}),a(48,"Annuler"),r(),n(49,"button",20),d(50,Kn,1,0,"mat-spinner",21)(51,Xn,2,1,"span",7),r()()()),i&2){let m,p,h;l(),x(o.dialogTitle),l(),c("formGroup",o.mappingForm),l(8),c("ngForOf",o.risks),l(),c("ngIf",(m=o.mappingForm.get("riskId"))==null?null:m.hasError("required")),l(4),Y("value",o.selectedFramework),l(),c("value",""),l(2),c("ngForOf",o.frameworks),l(5),c("ngForOf",o.filteredRequirements),l(),c("ngIf",(p=o.mappingForm.get("requirementId"))==null?null:p.hasError("required")),l(13),c("ngIf",(h=o.mappingForm.get("status"))==null?null:h.hasError("required")),l(10),c("disabled",o.isSubmitting),l(2),c("disabled",o.mappingForm.invalid||o.isSubmitting),l(),c("ngIf",o.isSubmitting),l(),c("ngIf",!o.isSubmitting)}},dependencies:[be,te,I,gt,xt,ye,we,ke,xe,Se,Me,Ee,St,Ke,Je,Xe,yt,L,q,Pe,Mt,fe,J,Et,z,vt,A,wt,ui],styles:[".form-fields[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;min-width:500px}.full-width[_ngcontent-%COMP%]{width:100%}.spinner-button[_ngcontent-%COMP%]{display:inline-block;margin-right:8px;vertical-align:middle}  .mat-mdc-progress-spinner circle{stroke:#fff!important}mat-dialog-content[_ngcontent-%COMP%]{max-height:70vh;min-height:300px}mat-form-field[_ngcontent-%COMP%]{margin-bottom:8px}"]})}}return t})();var Zn=()=>[5,10,25,100];function eo(t,s){if(t&1&&(n(0,"mat-option",11),a(1),r()),t&2){let e=s.$implicit;c("value",e.id),l(),C(" ",e.name," ")}}function to(t,s){t&1&&_(0,"mat-progress-bar",35)}function io(t,s){if(t&1&&(n(0,"div",36)(1,"mat-icon"),a(2,"error"),r(),n(3,"span"),a(4),r()()),t&2){let e=f(2);l(4),x(e.error)}}function ro(t,s){if(t&1&&(n(0,"div",32),d(1,to,1,0,"mat-progress-bar",33)(2,io,5,1,"div",34),r()),t&2){let e=f();l(),c("ngIf",e.isLoading),l(),c("ngIf",e.error)}}function no(t,s){t&1&&(n(0,"th",37),a(1," Exigence "),r())}function oo(t,s){if(t&1&&(n(0,"td",38)(1,"div",39)(2,"span",40),a(3),r(),n(4,"span",41),a(5),Ae(6,"slice"),r(),n(7,"span",42),a(8),r()()()),t&2){let e=s.$implicit;l(3),x((e.requirement==null?null:e.requirement.code)||"N/A"),l(2),H("",st(6,4,e.requirement==null?null:e.requirement.description,0,50),"",(e.requirement==null?null:e.requirement.description.length)>50?"...":"",""),l(3),x((e.requirement==null||e.requirement.framework==null?null:e.requirement.framework.name)||"")}}function ao(t,s){t&1&&(n(0,"th",37),a(1," Risque "),r())}function lo(t,s){if(t&1&&(n(0,"span",46),a(1),Ae(2,"slice"),r()),t&2){let e=f().$implicit;l(),H("",st(2,2,e.risk==null?null:e.risk.description,0,50),"",(e.risk==null?null:e.risk.description.length)>50?"...":"","")}}function so(t,s){if(t&1&&(n(0,"td",38)(1,"div",43)(2,"span",44),a(3),r(),d(4,lo,3,6,"span",45),r()()),t&2){let e=s.$implicit;l(3),x((e.risk==null?null:e.risk.name)||"N/A"),l(),c("ngIf",e.risk==null?null:e.risk.description)}}function mo(t,s){t&1&&(n(0,"th",37),a(1," Statut "),r())}function co(t,s){if(t&1&&(n(0,"td",38)(1,"span",47),a(2),r()()),t&2){let e=s.$implicit,i=f();l(),c("ngClass",i.getStatusClass(e.status)),l(),C(" ",i.getStatusLabel(e.status)," ")}}function po(t,s){t&1&&(n(0,"th",48),a(1," Commentaire "),r())}function uo(t,s){if(t&1&&(n(0,"td",38),a(1),r()),t&2){let e=s.$implicit;l(),C(" ",e.comment||"-"," ")}}function fo(t,s){t&1&&(n(0,"th",48),a(1," Actions "),r())}function _o(t,s){if(t&1){let e=S();n(0,"td",38)(1,"button",49),g("click",function(){let o=v(e).$implicit,m=f();return b(m.openMappingDialog(o))}),n(2,"mat-icon"),a(3,"edit"),r()(),n(4,"button",50),g("click",function(){let o=v(e).$implicit,m=f();return b(m.deleteMapping(o.id))}),n(5,"mat-icon"),a(6,"delete"),r()()()}}function go(t,s){t&1&&_(0,"tr",51)}function ho(t,s){t&1&&_(0,"tr",52)}function vo(t,s){if(t&1&&(n(0,"span"),a(1),r()),t&2){f(2);let e=B(13);l(),C('Aucun mapping trouv\xE9 pour "',e.value,'"')}}function bo(t,s){t&1&&(n(0,"span"),a(1,"Aucun mapping disponible"),r())}function Co(t,s){if(t&1&&(n(0,"tr",53)(1,"td",54)(2,"div",55)(3,"mat-icon"),a(4,"info"),r(),d(5,vo,2,1,"span",56)(6,bo,2,0,"span",56),r()()()),t&2){let e=f(),i=B(13);l(5),c("ngIf",i.value),l(),c("ngIf",!i.value&&!e.isLoading&&!e.error)}}var Yi=(()=>{class t{constructor(e,i,o,m){this.mappingService=e,this.frameworkService=i,this.dialog=o,this.snackBar=m,this.displayedColumns=["requirement","risk","status","comment","actions"],this.dataSource=new pe([]),this.frameworks=[],this.selectedFramework="",this.selectedStatus="",this.isLoading=!0,this.error=null,this.originalData=[]}ngOnInit(){this.loadFrameworks(),this.loadMappings()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}applyFilter(e){let i=e.target.value;this.dataSource.filter=i.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}loadFrameworks(){this.frameworkService.getFrameworks().subscribe({next:e=>{this.frameworks=e},error:e=>{console.error("Erreur lors du chargement des frameworks",e),this.showErrorSnackbar("Impossible de charger les r\xE9f\xE9rentiels")}})}loadMappings(){this.isLoading=!0,this.error=null,this.mappingService.getMappings().subscribe({next:e=>{console.log("Mappings re\xE7us du backend :",e),this.originalData=e,this.dataSource.data=e,this.isLoading=!1},error:e=>{console.error("Erreur lors du chargement des mappings",e),this.error="Impossible de charger les mappings. Veuillez r\xE9essayer.",this.isLoading=!1}})}filterData(){if(this.isLoading=!0,this.error=null,this.selectedFramework)this.mappingService.getMappingsByFramework(this.selectedFramework).subscribe({next:e=>{this.originalData=e;let i=[...e];this.selectedStatus&&(i=i.filter(o=>o.status===this.selectedStatus)),this.dataSource.data=i,this.isLoading=!1},error:e=>{console.error(`Erreur lors du filtrage par framework (${this.selectedFramework})`,e),this.error="Impossible de filtrer les mappings. Veuillez r\xE9essayer.",this.isLoading=!1}});else{if(this.selectedStatus){let e=this.originalData.filter(i=>i.status===this.selectedStatus);this.dataSource.data=e}else this.dataSource.data=this.originalData;this.isLoading=!1}this.dataSource.paginator&&this.dataSource.paginator.firstPage()}getStatusLabel(e){switch(e){case y.COMPLIANT:return"Conforme";case y.NON_COMPLIANT:return"Non conforme";case y.PARTIALLY_COMPLIANT:return"Partiellement conforme";case y.NOT_APPLICABLE:return"Non applicable";default:return e}}getStatusClass(e){switch(e){case y.COMPLIANT:return"status-compliant";case y.NON_COMPLIANT:return"status-non-compliant";case y.PARTIALLY_COMPLIANT:return"status-partially-compliant";case y.NOT_APPLICABLE:return"status-not-applicable";default:return""}}openMappingDialog(e){this.dialog.open(Ui,{width:"600px",data:{mapping:e||{}}}).afterClosed().subscribe(o=>{o&&(o.id?this.updateMapping(o):this.createMapping(o))})}createMapping(e){this.isLoading=!0,this.mappingService.createMapping(e).subscribe({next:i=>{this.originalData=[...this.originalData,i],this.filterData(),this.isLoading=!1,this.showSuccessSnackbar("Mapping cr\xE9\xE9 avec succ\xE8s")},error:i=>{console.error("Erreur lors de la cr\xE9ation du mapping",i),this.isLoading=!1,this.showErrorSnackbar("Impossible de cr\xE9er le mapping")}})}updateMapping(e){this.isLoading=!0,this.mappingService.updateMapping(e.id,e).subscribe({next:i=>{let o=this.originalData.findIndex(m=>m.id===i.id);if(o!==-1){let m=[...this.originalData];m[o]=i,this.originalData=m,this.filterData()}this.isLoading=!1,this.showSuccessSnackbar("Mapping mis \xE0 jour avec succ\xE8s")},error:i=>{console.error("Erreur lors de la mise \xE0 jour du mapping",i),this.isLoading=!1,this.showErrorSnackbar("Impossible de mettre \xE0 jour le mapping")}})}deleteMapping(e){confirm("\xCAtes-vous s\xFBr de vouloir supprimer ce mapping? Cette action est irr\xE9versible.")&&(this.isLoading=!0,this.mappingService.deleteMapping(e).subscribe({next:()=>{this.originalData=this.originalData.filter(i=>i.id!==e),this.filterData(),this.isLoading=!1,this.showSuccessSnackbar("Mapping supprim\xE9 avec succ\xE8s")},error:i=>{console.error("Erreur lors de la suppression du mapping",i),this.isLoading=!1,this.showErrorSnackbar("Impossible de supprimer le mapping")}}))}showSuccessSnackbar(e){this.snackBar.open(e,"Fermer",{duration:3e3,panelClass:["success-snackbar"]})}showErrorSnackbar(e){this.snackBar.open(e,"Fermer",{duration:5e3,panelClass:["error-snackbar"]})}static{this.\u0275fac=function(i){return new(i||t)(u(et),u(j),u(Fe),u(We))}}static{this.\u0275cmp=M({type:t,selectors:[["app-mappings"]],viewQuery:function(i,o){if(i&1&&(T(V,5),T(P,5)),i&2){let m;R(m=D())&&(o.paginator=m.first),R(m=D())&&(o.sort=m.first)}},decls:60,vars:11,consts:[["input",""],[1,"mappings-container"],[1,"mappings-header"],["mat-raised-button","","color","primary",3,"click"],[1,"filter-container"],["appearance","outline",1,"filter-field"],["matInput","","placeholder","Ex. ISO 27001",3,"keyup"],["matSuffix",""],[1,"filter-buttons"],["appearance","outline"],[3,"valueChange","selectionChange","value"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["value","COMPLIANT"],["value","NON_COMPLIANT"],["value","PARTIALLY_COMPLIANT"],["value","NOT_APPLICABLE"],["class","loading-error-container",4,"ngIf"],[1,"mat-elevation-z2","data-table-container"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","requirement"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","risk"],["matColumnDef","status"],["matColumnDef","comment"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"pageSizeOptions"],[1,"loading-error-container"],["mode","indeterminate",4,"ngIf"],["class","error-message",4,"ngIf"],["mode","indeterminate"],[1,"error-message"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"requirement-info"],[1,"requirement-code"],[1,"requirement-description"],[1,"framework-name"],[1,"risk-info"],[1,"risk-name"],["class","risk-description",4,"ngIf"],[1,"risk-description"],[3,"ngClass"],["mat-header-cell",""],["mat-icon-button","","color","accent","matTooltip","Modifier",3,"click"],["mat-icon-button","","color","warn","matTooltip","Supprimer",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","5",1,"mat-cell"],[1,"no-data-message"],[4,"ngIf"]],template:function(i,o){if(i&1){let m=S();n(0,"div",1)(1,"div",2)(2,"h2"),a(3,"Mappings Risques-Conformit\xE9"),r(),n(4,"button",3),g("click",function(){return v(m),b(o.openMappingDialog())}),n(5,"mat-icon"),a(6,"add"),r(),a(7," Nouveau Mapping "),r()(),n(8,"div",4)(9,"mat-form-field",5)(10,"mat-label"),a(11,"Rechercher"),r(),n(12,"input",6,0),g("keyup",function(h){return v(m),b(o.applyFilter(h))}),r(),n(14,"mat-icon",7),a(15,"search"),r()(),n(16,"div",8)(17,"mat-form-field",9)(18,"mat-label"),a(19,"R\xE9f\xE9rentiel"),r(),n(20,"mat-select",10),X("valueChange",function(h){return v(m),K(o.selectedFramework,h)||(o.selectedFramework=h),b(h)}),g("selectionChange",function(){return v(m),b(o.filterData())}),n(21,"mat-option",11),a(22,"Tous"),r(),d(23,eo,2,2,"mat-option",12),r()(),n(24,"mat-form-field",9)(25,"mat-label"),a(26,"Statut"),r(),n(27,"mat-select",10),X("valueChange",function(h){return v(m),K(o.selectedStatus,h)||(o.selectedStatus=h),b(h)}),g("selectionChange",function(){return v(m),b(o.filterData())}),n(28,"mat-option",11),a(29,"Tous"),r(),n(30,"mat-option",13),a(31,"Conforme"),r(),n(32,"mat-option",14),a(33,"Non conforme"),r(),n(34,"mat-option",15),a(35,"Partiellement conforme"),r(),n(36,"mat-option",16),a(37,"Non applicable"),r()()()()(),d(38,ro,3,2,"div",17),n(39,"div",18)(40,"table",19),w(41,20),d(42,no,2,0,"th",21)(43,oo,9,8,"td",22),k(),w(44,23),d(45,ao,2,0,"th",21)(46,so,5,2,"td",22),k(),w(47,24),d(48,mo,2,0,"th",21)(49,co,3,2,"td",22),k(),w(50,25),d(51,po,2,0,"th",26)(52,uo,2,1,"td",22),k(),w(53,27),d(54,fo,2,0,"th",26)(55,_o,7,0,"td",22),k(),d(56,go,1,0,"tr",28)(57,ho,1,0,"tr",29)(58,Co,7,2,"tr",30),r(),_(59,"mat-paginator",31),r()()}i&2&&(l(20),Y("value",o.selectedFramework),l(),c("value",""),l(2),c("ngForOf",o.frameworks),l(4),Y("value",o.selectedStatus),l(),c("value",""),l(10),c("ngIf",o.isLoading||o.error),l(2),c("dataSource",o.dataSource),l(16),c("matHeaderRowDef",o.displayedColumns),l(),c("matRowDefColumns",o.displayedColumns),l(2),c("pageSizeOptions",ee(10,Zn)))},dependencies:[Be,te,I,A,$,L,q,Qe,G,z,V,W,fe,J,P,ue,ie,ne,se,oe,re,me,ae,le,ce,de,Ie,Q,gt],styles:[".mappings-container[_ngcontent-%COMP%]{padding:20px}.mappings-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.mappings-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:500;color:#333}.filter-container[_ngcontent-%COMP%]{margin-bottom:20px}.filter-field[_ngcontent-%COMP%]{width:100%;margin-bottom:15px}.filter-buttons[_ngcontent-%COMP%]{display:flex;gap:15px}.filter-buttons[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.loading-error-container[_ngcontent-%COMP%]{margin-bottom:15px}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;color:#f44336;padding:10px;border-radius:4px;background-color:#f443361a}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:10px}.data-table-container[_ngcontent-%COMP%]{overflow-x:auto;border-radius:4px}table[_ngcontent-%COMP%]{width:100%}.mat-column-requirement[_ngcontent-%COMP%], .mat-column-risk[_ngcontent-%COMP%]{min-width:200px}.mat-column-status[_ngcontent-%COMP%]{width:150px}.mat-column-comment[_ngcontent-%COMP%]{min-width:200px}.mat-column-actions[_ngcontent-%COMP%]{width:120px;text-align:center}.requirement-info[_ngcontent-%COMP%], .risk-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.requirement-code[_ngcontent-%COMP%]{font-weight:700;color:#333}.requirement-description[_ngcontent-%COMP%]{font-size:.85em;color:#666;margin-top:2px}.framework-name[_ngcontent-%COMP%]{font-size:.8em;color:#888;font-style:italic;margin-top:2px}.risk-name[_ngcontent-%COMP%]{font-weight:700;color:#333}.risk-description[_ngcontent-%COMP%]{font-size:.85em;color:#666;margin-top:2px}.no-data-message[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:20px;color:#666}.no-data-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:10px;color:#999}.status-compliant[_ngcontent-%COMP%], .status-non-compliant[_ngcontent-%COMP%], .status-partially-compliant[_ngcontent-%COMP%], .status-not-applicable[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;font-size:12px;display:inline-block}.status-compliant[_ngcontent-%COMP%]{background-color:#e8f5e9;color:#2e7d32}.status-non-compliant[_ngcontent-%COMP%]{background-color:#ffebee;color:#c62828}.status-partially-compliant[_ngcontent-%COMP%]{background-color:#fff8e1;color:#ff8f00}.status-not-applicable[_ngcontent-%COMP%]{background-color:#f5f5f5;color:#757575}"]})}}return t})();var wo=()=>[10,25,50,100];function ko(t,s){if(t&1&&(n(0,"mat-option",7),a(1),r()),t&2){let e=s.$implicit;c("value",e.id),l(),H(" ",e.name," (",e.version,") ")}}function xo(t,s){if(t&1&&(n(0,"mat-option",7),a(1),r()),t&2){let e=s.$implicit;c("value",e.id),l(),C(" ",e.name," ")}}function yo(t,s){t&1&&_(0,"mat-progress-bar",13)}function Mo(t,s){if(t&1&&(n(0,"div",14)(1,"mat-icon"),a(2,"error"),r(),n(3,"span"),a(4),r()()),t&2){let e=f(2);l(4),x(e.error)}}function Eo(t,s){if(t&1&&(n(0,"div",10),d(1,yo,1,0,"mat-progress-bar",11)(2,Mo,5,1,"div",12),r()),t&2){let e=f();l(),c("ngIf",e.isLoading),l(),c("ngIf",e.error)}}function So(t,s){t&1&&(n(0,"div",16)(1,"mat-icon"),a(2,"info"),r(),n(3,"p"),a(4,"Veuillez s\xE9lectionner un r\xE9f\xE9rentiel pour afficher l'analyse d'\xE9carts."),r()())}function Oo(t,s){t&1&&(n(0,"th",43),a(1," Code "),r())}function Io(t,s){if(t&1&&(n(0,"td",44),a(1),r()),t&2){let e=s.$implicit;l(),C(" ",e.code," ")}}function Po(t,s){t&1&&(n(0,"th",45),a(1," Description "),r())}function Fo(t,s){if(t&1&&(n(0,"td",44),a(1),r()),t&2){let e=s.$implicit;l(),C(" ",e.description," ")}}function To(t,s){t&1&&(n(0,"th",45),a(1," Actions "),r())}function Ro(t,s){if(t&1){let e=S();n(0,"td",44)(1,"button",46),g("click",function(){let o=v(e).$implicit,m=f(3);return b(m.createActionPlan(o))}),n(2,"mat-icon"),a(3,"assignment"),r()()()}t&2&&(l(),c("matTooltip","Cr\xE9er un plan d'action"))}function Do(t,s){t&1&&_(0,"tr",47)}function Ao(t,s){t&1&&_(0,"tr",48)}function qo(t,s){if(t&1&&(w(0),n(1,"div",17)(2,"mat-card",18)(3,"div",19)(4,"div",20)(5,"mat-icon"),a(6,"check_circle"),r()(),n(7,"div",21)(8,"span",22),a(9),r(),n(10,"span",23),a(11,"Conforme"),r()()()(),n(12,"mat-card",18)(13,"div",19)(14,"div",24)(15,"mat-icon"),a(16,"cancel"),r()(),n(17,"div",21)(18,"span",22),a(19),r(),n(20,"span",23),a(21,"Non conforme"),r()()()(),n(22,"mat-card",18)(23,"div",19)(24,"div",25)(25,"mat-icon"),a(26,"remove_circle"),r()(),n(27,"div",21)(28,"span",22),a(29),r(),n(30,"span",23),a(31,"Partiellement conforme"),r()()()(),n(32,"mat-card",18)(33,"div",19)(34,"div",26)(35,"mat-icon"),a(36,"not_interested"),r()(),n(37,"div",21)(38,"span",22),a(39),r(),n(40,"span",23),a(41,"Non applicable"),r()()()()(),n(42,"mat-card",27)(43,"mat-card-header")(44,"mat-card-title"),a(45,"Progression de la conformit\xE9"),r()(),n(46,"mat-card-content")(47,"div",28)(48,"div",29)(49,"span"),a(50),Ae(51,"number"),r()(),_(52,"mat-progress-bar",30),r()()(),n(53,"mat-card",31)(54,"mat-card-header")(55,"mat-card-title"),a(56),r()(),n(57,"mat-card-content")(58,"div",32)(59,"table",33),w(60,34),d(61,Oo,2,0,"th",35)(62,Io,2,1,"td",36),k(),w(63,37),d(64,Po,2,0,"th",38)(65,Fo,2,1,"td",36),k(),w(66,39),d(67,To,2,0,"th",38)(68,Ro,4,1,"td",36),k(),d(69,Do,1,0,"tr",40)(70,Ao,1,0,"tr",41),r(),_(71,"mat-paginator",42),r()()(),k()),t&2){let e=f(2);l(9),x(e.compliantCount),l(10),x(e.nonCompliantCount),l(10),x(e.partiallyCompliantCount),l(10),x(e.notApplicableCount),l(11),C("",ti(51,11,e.compliancePercentage,"1.0-1"),"%"),l(2),c("value",e.compliancePercentage),l(4),C("Exigences non couvertes (",e.dataSource.data.length,")"),l(3),c("dataSource",e.dataSource),l(10),c("matHeaderRowDef",e.displayedColumns),l(),c("matRowDefColumns",e.displayedColumns),l(),c("pageSizeOptions",ee(14,wo))}}function Lo(t,s){if(t&1&&(w(0),d(1,So,5,0,"div",15)(2,qo,72,15,"ng-container",9),k()),t&2){let e=f();l(),c("ngIf",!e.selectedFramework),l(),c("ngIf",e.selectedFramework&&e.gapAnalysisResult)}}var Ki=(()=>{class t{constructor(e,i,o,m,p){this.frameworkService=e,this.mappingService=i,this.riskService=o,this.router=m,this.snackBar=p,this.displayedColumns=["code","description","actions"],this.dataSource=new pe([]),this.frameworks=[],this.risks=[],this.selectedFramework="",this.selectedRisk="",this.isLoading=!1,this.error=null,this.gapAnalysisResult=null,this.compliantCount=0,this.nonCompliantCount=0,this.partiallyCompliantCount=0,this.notApplicableCount=0,this.compliancePercentage=0}ngOnInit(){this.loadInitialData()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}loadInitialData(){this.isLoading=!0,this.error=null,ut({frameworks:this.frameworkService.getFrameworks(),risks:this.riskService.getRisks()}).subscribe({next:e=>{this.frameworks=e.frameworks,this.risks=e.risks,this.isLoading=!1},error:e=>{console.error("Erreur lors du chargement des donn\xE9es initiales",e),this.error="Impossible de charger les donn\xE9es. Veuillez r\xE9essayer.",this.isLoading=!1,this.showErrorSnackbar("Impossible de charger les donn\xE9es")}})}loadGapAnalysis(){if(!this.selectedFramework){this.resetGapAnalysis();return}this.isLoading=!0,this.error=null,this.mappingService.getGapAnalysis(this.selectedFramework,this.selectedRisk||void 0).subscribe({next:e=>{this.gapAnalysisResult=e,this.compliantCount=e.counts[y.COMPLIANT]||0,this.nonCompliantCount=e.counts[y.NON_COMPLIANT]||0,this.partiallyCompliantCount=e.counts[y.PARTIALLY_COMPLIANT]||0,this.notApplicableCount=e.counts[y.NOT_APPLICABLE]||0,this.compliancePercentage=e.compliancePercentage||0,this.dataSource.data=e.gaps||[],this.isLoading=!1;let i=this.selectedRisk?"Analyse d'\xE9carts charg\xE9e pour le r\xE9f\xE9rentiel et le risque s\xE9lectionn\xE9s":"Analyse d'\xE9carts charg\xE9e pour le r\xE9f\xE9rentiel";this.showSuccessSnackbar(i)},error:e=>{console.error("Erreur lors du chargement de l'analyse d'\xE9carts",e),this.error="Impossible de charger l'analyse d'\xE9carts. Veuillez r\xE9essayer.",this.isLoading=!1,this.showErrorSnackbar("Impossible de charger l'analyse d'\xE9carts")}})}resetGapAnalysis(){this.gapAnalysisResult=null,this.dataSource.data=[],this.compliantCount=0,this.nonCompliantCount=0,this.partiallyCompliantCount=0,this.notApplicableCount=0,this.compliancePercentage=0}getStatusLabel(e){switch(e){case y.COMPLIANT:return"Conforme";case y.NON_COMPLIANT:return"Non conforme";case y.PARTIALLY_COMPLIANT:return"Partiellement conforme";case y.NOT_APPLICABLE:return"Non applicable";default:return e}}getStatusClass(e){switch(e){case y.COMPLIANT:return"status-compliant";case y.NON_COMPLIANT:return"status-non-compliant";case y.PARTIALLY_COMPLIANT:return"status-partially-compliant";case y.NOT_APPLICABLE:return"status-not-applicable";default:return""}}createActionPlan(e){if(!this.selectedRisk){this.showErrorSnackbar("Veuillez s\xE9lectionner un risque avant de cr\xE9er un plan d'action");return}this.isLoading=!0,this.showInfoSnackbar("V\xE9rification du mapping risque-conformit\xE9..."),this.mappingService.getMappingByRiskAndRequirement(this.selectedRisk,e.id).pipe(Kt(i=>{if(i&&i.length>0)return console.debug("GapAnalysis: Mapping existant trouv\xE9:",i[0]),At(i[0]);{console.debug("GapAnalysis: Aucun mapping trouv\xE9, cr\xE9ation d'un nouveau mapping"),this.showInfoSnackbar("Cr\xE9ation d'un nouveau mapping risque-conformit\xE9...");let o={riskId:this.selectedRisk,requirementId:e.id,status:y.NON_COMPLIANT,evidence:""};return this.mappingService.createMapping(o)}}),O(i=>(console.error("GapAnalysis: Erreur lors de la v\xE9rification ou cr\xE9ation du mapping",i),this.isLoading=!1,this.showErrorSnackbar("Impossible de cr\xE9er le mapping. Veuillez r\xE9essayer."),At(null)))).subscribe({next:i=>{if(this.isLoading=!1,i){console.debug("GapAnalysis: Mapping obtenu avec succ\xE8s:",i);let o=["/remediation-plans","new",i.id];console.debug("GapAnalysis: Tentative de navigation vers:",o.join("/")),this.router.navigate(o).then(m=>{console.debug("GapAnalysis: Navigation r\xE9ussie avec navigate:",m),m||(console.debug("GapAnalysis: Tentative avec navigateByUrl"),this.router.navigateByUrl(o.join("/")).then(p=>{console.debug("GapAnalysis: Navigation r\xE9ussie avec navigateByUrl:",p),p||(console.error("GapAnalysis: \xC9chec de la navigation"),this.showErrorSnackbar("Impossible d'acc\xE9der au formulaire de cr\xE9ation de plan"))},p=>{console.error("GapAnalysis: Erreur de navigation avec navigateByUrl:",p),this.showErrorSnackbar("Erreur lors de la navigation vers le formulaire de cr\xE9ation")}))},m=>{console.error("GapAnalysis: Erreur de navigation avec navigate:",m),this.showErrorSnackbar("Erreur lors de la navigation vers le formulaire de cr\xE9ation")})}},error:i=>{this.isLoading=!1,console.error("GapAnalysis: Erreur lors de la cr\xE9ation du plan d'action",i),this.showErrorSnackbar("Impossible de cr\xE9er le plan d'action. Veuillez r\xE9essayer.")}})}showSuccessSnackbar(e){this.snackBar.open(e,"Fermer",{duration:3e3,panelClass:["success-snackbar"]})}showErrorSnackbar(e){this.snackBar.open(e,"Fermer",{duration:5e3,panelClass:["error-snackbar"]})}showInfoSnackbar(e){this.snackBar.open(e,"Fermer",{duration:4e3,panelClass:["info-snackbar"]})}static{this.\u0275fac=function(i){return new(i||t)(u(j),u(et),u(Dt),u(Ce),u(We))}}static{this.\u0275cmp=M({type:t,selectors:[["app-gap-analysis"]],viewQuery:function(i,o){if(i&1&&(T(V,5),T(P,5)),i&2){let m;R(m=D())&&(o.paginator=m.first),R(m=D())&&(o.sort=m.first)}},decls:20,vars:7,consts:[[1,"gap-analysis-container"],[1,"gap-analysis-header"],[1,"filter-container"],[1,"filter-row"],["appearance","outline",1,"filter-field"],[3,"valueChange","selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["class","loading-error-container",4,"ngIf"],[4,"ngIf"],[1,"loading-error-container"],["mode","indeterminate",4,"ngIf"],["class","error-message",4,"ngIf"],["mode","indeterminate"],[1,"error-message"],["class","no-framework-selected",4,"ngIf"],[1,"no-framework-selected"],[1,"dashboard-cards"],[1,"dashboard-card"],[1,"card-content"],[1,"card-icon","compliant"],[1,"card-stats"],[1,"stat-value"],[1,"stat-label"],[1,"card-icon","non-compliant"],[1,"card-icon","partially-compliant"],[1,"card-icon","not-applicable"],[1,"progress-card"],[1,"progress-bar-container"],[1,"progress-label"],["mode","determinate",3,"value"],[1,"gap-table-card"],[1,"gap-table-container"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","color","primary",3,"click","matTooltip"],["mat-header-row",""],["mat-row",""]],template:function(i,o){i&1&&(n(0,"div",0)(1,"div",1)(2,"h2"),a(3,"Analyse d'\xC9carts de Conformit\xE9"),r()(),n(4,"div",2)(5,"div",3)(6,"mat-form-field",4)(7,"mat-label"),a(8,"S\xE9lectionner un r\xE9f\xE9rentiel"),r(),n(9,"mat-select",5),X("valueChange",function(p){return K(o.selectedFramework,p)||(o.selectedFramework=p),p}),g("selectionChange",function(){return o.loadGapAnalysis()}),d(10,ko,2,3,"mat-option",6),r()(),n(11,"mat-form-field",4)(12,"mat-label"),a(13,"S\xE9lectionner un risque (optionnel)"),r(),n(14,"mat-select",5),X("valueChange",function(p){return K(o.selectedRisk,p)||(o.selectedRisk=p),p}),g("selectionChange",function(){return o.loadGapAnalysis()}),n(15,"mat-option",7),a(16,"Tous les risques"),r(),d(17,xo,2,2,"mat-option",6),r()()()(),d(18,Eo,3,2,"div",8)(19,Lo,3,2,"ng-container",9),r()),i&2&&(l(9),Y("value",o.selectedFramework),l(),c("ngForOf",o.frameworks),l(4),Y("value",o.selectedRisk),l(),c("value",""),l(2),c("ngForOf",o.risks),l(),c("ngIf",o.isLoading||o.error),l(),c("ngIf",!o.isLoading&&!o.error))},dependencies:[te,I,$,He,$e,Ct,bt,L,q,G,V,W,fe,J,P,ue,ie,ne,se,oe,re,me,ae,le,ce,de,Q,ri],styles:[".gap-analysis-container[_ngcontent-%COMP%]{padding:20px}.gap-analysis-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.gap-analysis-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:500;color:#333}.filter-container[_ngcontent-%COMP%]{margin-bottom:20px}.filter-row[_ngcontent-%COMP%]{display:flex;gap:16px}.filter-row[_ngcontent-%COMP%]   .filter-field[_ngcontent-%COMP%]{flex:1}.filter-field[_ngcontent-%COMP%]{width:100%}.loading-error-container[_ngcontent-%COMP%]{margin-bottom:15px}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;color:#f44336;padding:10px;border-radius:4px;background-color:#f443361a}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:10px}.no-framework-selected[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:40px;background-color:#f5f5f5;border-radius:4px;margin-bottom:20px}.no-framework-selected[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:28px;margin-right:15px;color:#757575}.no-framework-selected[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:16px;color:#757575}.dashboard-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px;margin-bottom:20px}.dashboard-card[_ngcontent-%COMP%]{padding:0}.card-content[_ngcontent-%COMP%]{display:flex;align-items:center;padding:20px}.card-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:48px;height:48px;border-radius:50%;margin-right:15px}.card-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:28px;width:28px;height:28px}.card-icon.compliant[_ngcontent-%COMP%]{background-color:#e8f5e9}.card-icon.compliant[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#2e7d32}.card-icon.non-compliant[_ngcontent-%COMP%]{background-color:#ffebee}.card-icon.non-compliant[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#c62828}.card-icon.partially-compliant[_ngcontent-%COMP%]{background-color:#fff8e1}.card-icon.partially-compliant[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#ff8f00}.card-icon.not-applicable[_ngcontent-%COMP%]{background-color:#f5f5f5}.card-icon.not-applicable[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#757575}.card-stats[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-value[_ngcontent-%COMP%]{font-size:24px;font-weight:500;margin-bottom:5px}.stat-label[_ngcontent-%COMP%]{font-size:14px;color:#0009}.progress-card[_ngcontent-%COMP%]{margin-bottom:20px}.progress-bar-container[_ngcontent-%COMP%]{padding:15px 0}.progress-label[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-bottom:10px;font-weight:500}.gap-table-card[_ngcontent-%COMP%]{margin-bottom:20px}.gap-table-container[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%}.mat-column-code[_ngcontent-%COMP%]{width:120px}.mat-column-description[_ngcontent-%COMP%]{min-width:300px}.mat-column-status[_ngcontent-%COMP%]{width:150px}.mat-column-gaps[_ngcontent-%COMP%]{min-width:200px}.mat-column-actions[_ngcontent-%COMP%]{width:100px;text-align:center}.status-compliant[_ngcontent-%COMP%], .status-non-compliant[_ngcontent-%COMP%], .status-partially-compliant[_ngcontent-%COMP%], .status-not-applicable[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;font-size:12px;display:inline-block}.status-compliant[_ngcontent-%COMP%]{background-color:#e8f5e9;color:#2e7d32}.status-non-compliant[_ngcontent-%COMP%]{background-color:#ffebee;color:#c62828}.status-partially-compliant[_ngcontent-%COMP%]{background-color:#fff8e1;color:#ff8f00}.status-not-applicable[_ngcontent-%COMP%]{background-color:#f5f5f5;color:#757575}"]})}}return t})();var Vo=[{path:"",component:Ni,children:[{path:"",redirectTo:"frameworks",pathMatch:"full"},{path:"frameworks",component:Bi},{path:"frameworks/:id",component:Gi},{path:"frameworks/edit/:id",component:Hi,canActivate:[Vi]},{path:"requirements",component:$i},{path:"mappings",component:Yi},{path:"gap-analysis",component:Ki}]}],Is=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=Ne({type:t})}static{this.\u0275inj=Ve({providers:[j,De,et],imports:[be,ai.forChild(Vo),fi,xt,Fi,vt,pi,Ai,St,Ei,yt,ki,Et,Si,wi,Pi,wt,qi,Mt,vi,hi,Di,Ci,xi,Oi,Ii,Li,yi]})}}return t})();export{Is as ComplianceModule};
