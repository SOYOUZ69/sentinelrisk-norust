import{a as ye,b as Ne}from"./chunk-SQSNDEOZ.js";import{a as je}from"./chunk-XW7D2PEW.js";import{a as Re}from"./chunk-Y6ZHF7VQ.js";import{a as ke}from"./chunk-T2K4TNNJ.js";import"./chunk-3ZNKIO6H.js";import{a as te,b as ne,c as ie,d as re,e as oe,f as ae,g as le,h as me,i as se,j as ce,l as de,n as Se,o as Ue,p as Oe,q as Pe,r as we,s as De,t as Ie,u as Te,v as Fe}from"./chunk-NPMEEAYW.js";import{a as ue,b as pe,f as fe,g as ge,h as _e,i as Ce,k as xe,l as ve}from"./chunk-ZR4OZC73.js";import{A as X,B as Y,F as Z,H as ee,ha as he,ia as Me,ja as Ee,ka as be,p as J,r as M,t as K,u as Q,y as W}from"./chunk-LQ6MDXSH.js";import{a as G,b as z}from"./chunk-DEA6IKFQ.js";import{$ as v,$a as f,Fa as s,Ha as c,Ka as O,Lb as A,Mb as S,Pb as L,Qa as i,Ra as n,Sa as p,Ta as g,Tb as V,U as y,Ua as _,Wa as P,Za as h,a as F,aa as N,da as E,ea as b,gd as B,hb as o,ib as u,ic as $,jb as x,kb as k,md as U,od as q,pd as H,ta as m,ua as C,vb as R,xb as j}from"./chunk-KODBDAN5.js";function He(e,l){if(e&1&&(i(0,"mat-error"),o(1),n()),e&2){let t=f();m(),u(t.getErrorMessage("username"))}}function Ge(e,l){if(e&1&&(i(0,"mat-error"),o(1),n()),e&2){let t=f();m(),u(t.getErrorMessage("email"))}}function ze(e,l){if(e&1&&(i(0,"mat-error"),o(1),n()),e&2){let t=f();m(),u(t.getErrorMessage("firstName"))}}function Je(e,l){if(e&1&&(i(0,"mat-error"),o(1),n()),e&2){let t=f();m(),u(t.getErrorMessage("lastName"))}}function Ke(e,l){if(e&1&&(i(0,"mat-option",17),o(1),n()),e&2){let t=l.$implicit;c("value",t),m(),x(" ",t," ")}}function Qe(e,l){if(e&1&&(i(0,"mat-error"),o(1),n()),e&2){let t=f();m(),u(t.getErrorMessage("role"))}}var Le=(()=>{class e{constructor(t,a,r){this.fb=t,this.dialogRef=a,this.data=r,this.isEdit=!1,this.roles=["admin","user","risk_manager","compliance_officer","auditor"],this.isEdit=r.isEdit,this.dialogTitle=this.isEdit?"Modifier l'utilisateur":"Ajouter un utilisateur",this.userForm=this.fb.group({username:["",[M.required,M.minLength(3)]],email:["",[M.required,M.email]],firstName:["",M.required],lastName:["",M.required],department:[""],role:["user",M.required],active:[!0]}),this.isEdit&&r.user&&(this.userForm.patchValue({username:r.user.username,email:r.user.email,firstName:r.user.firstName,lastName:r.user.lastName,department:r.user.department||"",role:r.user.role,active:r.user.active}),this.userForm.get("username")?.disable())}ngOnInit(){}onSubmit(){if(this.userForm.valid){let t=F({},this.userForm.getRawValue());this.dialogRef.close(t)}}onCancel(){this.dialogRef.close()}getErrorMessage(t){let a=this.userForm.get(t);return a?a.hasError("required")?"Ce champ est requis":a.hasError("email")?"Email invalide":a.hasError("minlength")?`Minimum ${a.getError("minlength").requiredLength} caract\xE8res`:"":""}static{this.\u0275fac=function(a){return new(a||e)(C(Z),C(Oe),C(Pe))}}static{this.\u0275cmp=v({type:e,selectors:[["app-user-form-dialog"]],decls:45,vars:10,consts:[["mat-dialog-title",""],[3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline"],["matInput","","formControlName","username","placeholder","john.doe"],[4,"ngIf"],["matInput","","formControlName","email","placeholder","john.doe@example.com","type","email"],["matInput","","formControlName","firstName","placeholder","John"],["matInput","","formControlName","lastName","placeholder","Doe"],["matInput","","formControlName","department","placeholder","IT"],["formControlName","role"],[3,"value",4,"ngFor","ngForOf"],[1,"form-row","active-row"],["formControlName","active"],["align","end"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[3,"value"]],template:function(a,r){if(a&1&&(i(0,"h2",0),o(1),n(),i(2,"form",1),h("ngSubmit",function(){return r.onSubmit()}),i(3,"mat-dialog-content")(4,"div",2)(5,"mat-form-field",3)(6,"mat-label"),o(7,"Nom d'utilisateur"),n(),p(8,"input",4),s(9,He,2,1,"mat-error",5),n(),i(10,"mat-form-field",3)(11,"mat-label"),o(12,"Email"),n(),p(13,"input",6),s(14,Ge,2,1,"mat-error",5),n()(),i(15,"div",2)(16,"mat-form-field",3)(17,"mat-label"),o(18,"Pr\xE9nom"),n(),p(19,"input",7),s(20,ze,2,1,"mat-error",5),n(),i(21,"mat-form-field",3)(22,"mat-label"),o(23,"Nom"),n(),p(24,"input",8),s(25,Je,2,1,"mat-error",5),n()(),i(26,"div",2)(27,"mat-form-field",3)(28,"mat-label"),o(29,"D\xE9partement"),n(),p(30,"input",9),n(),i(31,"mat-form-field",3)(32,"mat-label"),o(33,"R\xF4le"),n(),i(34,"mat-select",10),s(35,Ke,2,2,"mat-option",11),n(),s(36,Qe,2,1,"mat-error",5),n()(),i(37,"div",12)(38,"mat-slide-toggle",13),o(39," Utilisateur actif "),n()()(),i(40,"mat-dialog-actions",14)(41,"button",15),h("click",function(){return r.onCancel()}),o(42,"Annuler"),n(),i(43,"button",16),o(44),n()()()),a&2){let d,w,D,I,T;m(),u(r.dialogTitle),m(),c("formGroup",r.userForm),m(7),c("ngIf",(d=r.userForm.get("username"))==null?null:d.invalid),m(5),c("ngIf",(w=r.userForm.get("email"))==null?null:w.invalid),m(6),c("ngIf",(D=r.userForm.get("firstName"))==null?null:D.invalid),m(5),c("ngIf",(I=r.userForm.get("lastName"))==null?null:I.invalid),m(10),c("ngForOf",r.roles),m(),c("ngIf",(T=r.userForm.get("role"))==null?null:T.invalid),m(7),c("disabled",r.userForm.invalid),m(),x(" ",r.isEdit?"Mettre \xE0 jour":"Cr\xE9er"," ")}},dependencies:[A,S,W,J,K,Q,X,Y,U,De,Te,Ie,fe,ue,pe,xe,_e,B,ye],styles:["mat-dialog-content[_ngcontent-%COMP%]{min-width:450px}.form-row[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:8px}.form-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.active-row[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:16px;display:flex;align-items:center}@media (max-width: 600px){.form-row[_ngcontent-%COMP%]{flex-direction:column;gap:0}mat-dialog-content[_ngcontent-%COMP%]{min-width:320px}}"]})}}return e})();function We(e,l){e&1&&(i(0,"div",19),p(1,"mat-progress-spinner",20),n())}function Xe(e,l){e&1&&(i(0,"th",21),o(1,"Nom d'utilisateur"),n())}function Ye(e,l){if(e&1&&(i(0,"td",22),o(1),n()),e&2){let t=l.$implicit;m(),u(t.username)}}function Ze(e,l){e&1&&(i(0,"th",21),o(1,"Email"),n())}function et(e,l){if(e&1&&(i(0,"td",22),o(1),n()),e&2){let t=l.$implicit;m(),u(t.email)}}function tt(e,l){e&1&&(i(0,"th",21),o(1,"Nom complet"),n())}function nt(e,l){if(e&1&&(i(0,"td",22),o(1),n()),e&2){let t=l.$implicit;m(),k("",t.firstName," ",t.lastName,"")}}function it(e,l){e&1&&(i(0,"th",21),o(1,"D\xE9partement"),n())}function rt(e,l){if(e&1&&(i(0,"td",22),o(1),n()),e&2){let t=l.$implicit;m(),u(t.department)}}function ot(e,l){e&1&&(i(0,"th",21),o(1,"R\xF4le"),n())}function at(e,l){if(e&1&&(i(0,"td",22)(1,"span",23),o(2),n()()),e&2){let t=l.$implicit;m(),O(t.role.toLowerCase()),m(),x(" ",t.role," ")}}function lt(e,l){e&1&&(i(0,"th",21),o(1,"Statut"),n())}function mt(e,l){if(e&1&&(i(0,"td",22)(1,"span",24),o(2),n()()),e&2){let t=l.$implicit;m(),O(t.active?"active":"inactive"),m(),x(" ",t.active?"Actif":"Inactif"," ")}}function st(e,l){e&1&&(i(0,"th",21),o(1,"Date de cr\xE9ation"),n())}function ct(e,l){if(e&1&&(i(0,"td",22),o(1),R(2,"date"),n()),e&2){let t=l.$implicit;m(),u(j(2,1,t.createdAt,"dd/MM/yyyy"))}}function dt(e,l){e&1&&(i(0,"th",21),o(1,"Actions"),n())}function ut(e,l){if(e&1){let t=P();i(0,"td",22)(1,"button",25),h("click",function(){let r=E(t).$implicit,d=f();return b(d.openUserForm(r))}),i(2,"mat-icon"),o(3,"edit"),n()(),i(4,"button",26),h("click",function(){let r=E(t).$implicit,d=f();return b(d.deleteUser(r))}),i(5,"mat-icon"),o(6,"delete"),n()()()}}function pt(e,l){e&1&&p(0,"tr",27)}function ft(e,l){e&1&&p(0,"tr",28)}function gt(e,l){if(e&1){let t=P();i(0,"div",29)(1,"p"),o(2,"Aucun utilisateur trouv\xE9"),n(),i(3,"button",2),h("click",function(){E(t);let r=f();return b(r.openUserForm())}),o(4," Ajouter un utilisateur "),n()()}}var Ve=(()=>{class e{constructor(t,a,r){this.userService=t,this.dialog=a,this.snackBar=r,this.users=[],this.displayedColumns=["username","email","fullName","department","role","active","createdAt","actions"],this.isLoading=!1}ngOnInit(){this.loadUsers()}loadUsers(){this.isLoading=!0,this.userService.getUsers().subscribe({next:t=>{console.log("Utilisateurs r\xE9cup\xE9r\xE9s:",t),this.users=t,this.isLoading=!1},error:t=>{console.error("Erreur lors du chargement des utilisateurs:",t),this.showError("Erreur lors du chargement des utilisateurs"),this.isLoading=!1}})}openUserForm(t){let a={user:t,isEdit:!!t};this.dialog.open(Le,{width:"500px",data:a}).afterClosed().subscribe(d=>{d&&(a.isEdit?this.updateUser(t.id,d):this.createUser(d))})}deleteUser(t){let a={title:"Confirmation de suppression",message:`\xCAtes-vous s\xFBr de vouloir supprimer l'utilisateur ${t.username} ?`,confirmText:"Supprimer",cancelText:"Annuler",color:"warn"};this.dialog.open(ke,{width:"400px",data:a}).afterClosed().subscribe(d=>{d&&this.performDeleteUser(t.id)})}performDeleteUser(t){this.isLoading=!0,this.userService.deleteUser(t).subscribe({next:()=>{this.loadUsers(),this.showSuccess("Utilisateur supprim\xE9 avec succ\xE8s")},error:a=>{console.error("Erreur lors de la suppression de l'utilisateur:",a),this.showError("Erreur lors de la suppression de l'utilisateur"),this.isLoading=!1}})}createUser(t){this.isLoading=!0,this.userService.createUser(t).subscribe({next:()=>{this.loadUsers(),this.showSuccess("Utilisateur cr\xE9\xE9 avec succ\xE8s")},error:a=>{console.error("Erreur lors de la cr\xE9ation de l'utilisateur:",a),this.showError("Erreur lors de la cr\xE9ation de l'utilisateur"),this.isLoading=!1}})}updateUser(t,a){this.isLoading=!0,this.userService.updateUser(t,a).subscribe({next:()=>{this.loadUsers(),this.showSuccess("Utilisateur mis \xE0 jour avec succ\xE8s")},error:r=>{console.error("Erreur lors de la mise \xE0 jour de l'utilisateur:",r),this.showError("Erreur lors de la mise \xE0 jour de l'utilisateur"),this.isLoading=!1}})}showSuccess(t){this.snackBar.open(t,"Fermer",{duration:3e3})}showError(t){this.snackBar.open(t,"Fermer",{duration:3e3,panelClass:["error-snackbar"]})}static{this.\u0275fac=function(a){return new(a||e)(C(Re),C(we),C(Se))}}static{this.\u0275cmp=v({type:e,selectors:[["app-users"]],decls:38,vars:5,consts:[[1,"users-container"],[1,"header"],["mat-raised-button","","color","primary",3,"click"],[1,"table-container"],["class","loading-shade",4,"ngIf"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","username"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","email"],["matColumnDef","fullName"],["matColumnDef","department"],["matColumnDef","role"],["matColumnDef","active"],["matColumnDef","createdAt"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","no-data",4,"ngIf"],[1,"loading-shade"],["mode","indeterminate","diameter","50"],["mat-header-cell",""],["mat-cell",""],[1,"role-badge"],[1,"status-badge"],["mat-icon-button","","color","primary","matTooltip","Modifier",3,"click"],["mat-icon-button","","color","warn","matTooltip","Supprimer",3,"click"],["mat-header-row",""],["mat-row",""],[1,"no-data"]],template:function(a,r){a&1&&(i(0,"div",0)(1,"div",1)(2,"h1"),o(3,"Gestion des utilisateurs"),n(),i(4,"button",2),h("click",function(){return r.openUserForm()}),i(5,"mat-icon"),o(6,"add"),n(),o(7," Nouvel utilisateur "),n()(),i(8,"div",3),s(9,We,2,0,"div",4),i(10,"table",5),g(11,6),s(12,Xe,2,0,"th",7)(13,Ye,2,1,"td",8),_(),g(14,9),s(15,Ze,2,0,"th",7)(16,et,2,1,"td",8),_(),g(17,10),s(18,tt,2,0,"th",7)(19,nt,2,2,"td",8),_(),g(20,11),s(21,it,2,0,"th",7)(22,rt,2,1,"td",8),_(),g(23,12),s(24,ot,2,0,"th",7)(25,at,3,3,"td",8),_(),g(26,13),s(27,lt,2,0,"th",7)(28,mt,3,3,"td",8),_(),g(29,14),s(30,st,2,0,"th",7)(31,ct,3,4,"td",8),_(),g(32,15),s(33,dt,2,0,"th",7)(34,ut,7,0,"td",8),_(),s(35,pt,1,0,"tr",16)(36,ft,1,0,"tr",17),n(),s(37,gt,5,0,"div",18),n()()),a&2&&(m(9),c("ngIf",r.isLoading),m(),c("dataSource",r.users),m(25),c("matHeaderRowDef",r.displayedColumns),m(),c("matRowDefColumns",r.displayedColumns),m(),c("ngIf",!r.isLoading&&r.users.length===0))},dependencies:[S,te,ie,le,re,ne,me,oe,ae,se,ce,U,q,Ee,G,he,L],styles:[".users-container[_ngcontent-%COMP%]{padding:24px;max-width:1200px;margin:0 auto}.users-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.users-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:500}.users-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]{overflow-x:auto;position:relative;min-height:200px}.users-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .loading-shade[_ngcontent-%COMP%]{position:absolute;inset:0;background:#0000000d;z-index:1;display:flex;align-items:center;justify-content:center;border-radius:4px}.users-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%}.users-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:500;color:#000000de}.users-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:#000000de}.users-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .mat-column-actions[_ngcontent-%COMP%]{width:120px;text-align:center}.users-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .no-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;text-align:center}.users-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .no-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:20px;font-size:16px;color:#0000008a}.users-container[_ngcontent-%COMP%]   .role-badge[_ngcontent-%COMP%], .users-container[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500;text-transform:uppercase}.users-container[_ngcontent-%COMP%]   .role-badge.admin[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2}.users-container[_ngcontent-%COMP%]   .role-badge.risk_manager[_ngcontent-%COMP%]{background-color:#e8f5e9;color:#2e7d32}.users-container[_ngcontent-%COMP%]   .role-badge.compliance_officer[_ngcontent-%COMP%]{background-color:#fff3e0;color:#f57c00}.users-container[_ngcontent-%COMP%]   .role-badge.auditor[_ngcontent-%COMP%]{background-color:#f3e5f5;color:#7b1fa2}.users-container[_ngcontent-%COMP%]   .role-badge.user[_ngcontent-%COMP%]{background-color:#f5f5f5;color:#616161}.users-container[_ngcontent-%COMP%]   .status-badge.active[_ngcontent-%COMP%]{background-color:#e8f5e9;color:#2e7d32}.users-container[_ngcontent-%COMP%]   .status-badge.inactive[_ngcontent-%COMP%]{background-color:#ffebee;color:#c62828}"]})}}return e})();var _t=[{path:"",component:Ve}],en=(()=>{class e{static{this.\u0275fac=function(a){return new(a||e)}}static{this.\u0275mod=N({type:e})}static{this.\u0275inj=y({imports:[V,$.forChild(_t),ee,je,de,H,be,Ue,Fe,ge,ve,Ce,Ne,z,Me]})}}return e})();export{en as UsersModule};
