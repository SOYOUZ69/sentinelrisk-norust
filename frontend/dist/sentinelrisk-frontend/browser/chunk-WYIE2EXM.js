import{a as Ee}from"./chunk-FTLFMD6S.js";import{a as R}from"./chunk-2VYJHZDV.js";import"./chunk-5VACTLNG.js";import{a as de,b as ce,c as ue}from"./chunk-UXRNQJZH.js";import{a as fe,b as ge,c as _e,d as he}from"./chunk-YGNCV335.js";import{a as it,b as xe,c as nt,d as ve,e as Ce}from"./chunk-YRTFBRGB.js";import{a as N,b as yt,c as V,e as W,f as wt,h as Ot}from"./chunk-Y6CVK3JV.js";import{B as tt,C as le,E as et,F as se,G as me,H as pe,a as zt,b as Gt,c as Ht,d as Qt,e as Jt,f as Kt,g as Wt,h as Xt,i as Yt,j as Zt,k as te,l as ee,m as ie,n as U,o as ne,r as re,v as ae,w as Y,x as oe,z as Z}from"./chunk-VEQFYUJL.js";import{A as $,B as kt,Q as Tt,R as Ft,T as Rt,V as B,X as Lt,Y as Nt,Z as Vt,aa as jt,ca as $t,da as Bt,ga as Ut,ha as At,ja as qt}from"./chunk-SJ23VTXR.js";import{a as j,b as Dt}from"./chunk-YKJTYXXW.js";import{a as L,b as It,c as bt,d as X}from"./chunk-YNDG7QUW.js";import{$ as Q,$a as rt,$b as F,$c as Pt,Ba as d,C as P,Ca as ft,Da as m,Gb as vt,Hb as Ct,Ib as k,Lb as J,Ma as r,Na as i,Oa as x,Pa as I,Pb as Et,Qa as b,Rb as lt,S as z,Sa as y,Sb as K,Sc as St,T as G,V as H,Va as v,Xa as c,Zb as T,_ as w,ab as at,ac as Mt,bb as ot,ca as C,cb as gt,cc as st,da as E,db as a,eb as M,fb as h,gb as _t,nb as ht,p as ct,pa as o,q as S,qa as g,qb as xt,rb as O,tb as D,w as ut}from"./chunk-Z6XCGGPI.js";var u=function(e){return e.TODO="TODO",e.IN_PROGRESS="IN_PROGRESS",e.DONE="DONE",e}(u||{});var q=(()=>{class e{constructor(t){this.http=t,this.apiUrl=`${X.apiUrl}/api/remediation-plans`}getPlans(){return this.http.get(this.apiUrl).pipe(P(t=>(console.error("Erreur lors de la r\xE9cup\xE9ration des plans de rem\xE9diation",t),S(()=>new Error("Impossible de r\xE9cup\xE9rer la liste des plans. Veuillez r\xE9essayer.")))))}getPlansByMapping(t){let n=new lt().set("mappingId",t);return this.http.get(this.apiUrl,{params:n}).pipe(P(l=>(console.error(`Erreur lors de la r\xE9cup\xE9ration des plans pour le mapping ${t}`,l),S(()=>new Error("Impossible de r\xE9cup\xE9rer les plans pour ce mapping. Veuillez r\xE9essayer.")))))}getPlansByOwner(t){let n=new lt().set("ownerId",t);return this.http.get(this.apiUrl,{params:n}).pipe(P(l=>(console.error(`Erreur lors de la r\xE9cup\xE9ration des plans pour l'utilisateur ${t}`,l),S(()=>new Error("Impossible de r\xE9cup\xE9rer les plans pour cet utilisateur. Veuillez r\xE9essayer.")))))}getPlan(t){return this.http.get(`${this.apiUrl}/${t}`).pipe(P(n=>(console.error(`Erreur lors de la r\xE9cup\xE9ration du plan ${t}`,n),S(()=>new Error("Impossible de r\xE9cup\xE9rer les d\xE9tails du plan. Veuillez r\xE9essayer.")))))}createPlan(t){return this.http.post(this.apiUrl,t).pipe(P(n=>(console.error("Erreur lors de la cr\xE9ation du plan",n),S(()=>new Error("Impossible de cr\xE9er le plan. Veuillez r\xE9essayer.")))))}updatePlan(t,n){return this.http.put(`${this.apiUrl}/${t}`,n).pipe(P(l=>(console.error(`Erreur lors de la mise \xE0 jour du plan ${t}`,l),S(()=>new Error("Impossible de mettre \xE0 jour le plan. Veuillez r\xE9essayer.")))))}deletePlan(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(P(n=>(console.error(`Erreur lors de la suppression du plan ${t}`,n),S(()=>new Error("Impossible de supprimer le plan. Veuillez r\xE9essayer.")))))}static{this.\u0275fac=function(n){return new(n||e)(H(K))}}static{this.\u0275prov=z({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var Ne=()=>[5,10,25,100],Ve=(e,s,t)=>({"status-todo":e,"status-in-progress":s,"status-done":t});function je(e,s){e&1&&x(0,"mat-progress-spinner",13)}function $e(e,s){if(e&1&&(r(0,"div",14)(1,"mat-icon"),a(2,"error"),i(),r(3,"span"),a(4),i()()),e&2){let t=c(2);o(4),M(t.error)}}function Be(e,s){if(e&1&&(r(0,"div",10),d(1,je,1,0,"mat-progress-spinner",11)(2,$e,5,1,"div",12),i()),e&2){let t=c();o(),m("ngIf",t.isLoading),o(),m("ngIf",t.error)}}function Ue(e,s){e&1&&(r(0,"th",31),a(1," Titre "),i())}function Ae(e,s){if(e&1&&(r(0,"td",32),a(1),i()),e&2){let t=s.$implicit;o(),h(" ",t.title," ")}}function qe(e,s){e&1&&(r(0,"th",33),a(1," \xC9cart "),i())}function ze(e,s){if(e&1&&(r(0,"td",32),a(1),i()),e&2){let t=s.$implicit;o(),h(" ",t.mappingSummary||"Non sp\xE9cifi\xE9"," ")}}function Ge(e,s){e&1&&(r(0,"th",31),a(1," Responsable "),i())}function He(e,s){if(e&1&&(r(0,"td",32),a(1),i()),e&2){let t=s.$implicit;o(),h(" ",t.ownerName||"Non assign\xE9"," ")}}function Qe(e,s){e&1&&(r(0,"th",31),a(1," \xC9ch\xE9ance "),i())}function Je(e,s){if(e&1&&(r(0,"td",32),a(1),O(2,"date"),i()),e&2){let t=s.$implicit;o(),h(" ",D(2,1,t.dueDate,"dd/MM/yyyy")," ")}}function Ke(e,s){e&1&&(r(0,"th",31),a(1," Statut "),i())}function We(e,s){if(e&1&&(r(0,"td",32)(1,"span",34),a(2),i()()),e&2){let t=s.$implicit;o(),m("ngClass",xt(2,Ve,t.status==="TODO",t.status==="IN_PROGRESS",t.status==="DONE")),o(),h(" ",t.status==="TODO"?"\xC0 faire":t.status==="IN_PROGRESS"?"En cours":"Termin\xE9"," ")}}function Xe(e,s){e&1&&(r(0,"th",33),a(1," Actions "),i())}function Ye(e,s){if(e&1){let t=y();r(0,"td",32)(1,"button",35),v("click",function(){let l=C(t).$implicit,p=c(2);return E(p.viewPlanDetails(l))}),r(2,"mat-icon"),a(3,"visibility"),i()(),r(4,"button",36),v("click",function(){let l=C(t).$implicit,p=c(2);return E(p.editPlan(l))}),r(5,"mat-icon"),a(6,"edit"),i()(),r(7,"button",37),v("click",function(){let l=C(t).$implicit,p=c(2);return E(p.deletePlan(l))}),r(8,"mat-icon"),a(9,"delete"),i()()()}}function Ze(e,s){e&1&&x(0,"tr",38)}function ti(e,s){e&1&&x(0,"tr",39)}function ei(e,s){if(e&1&&(r(0,"tr",40)(1,"td",41)(2,"div",42)(3,"mat-icon"),a(4,"info"),i(),r(5,"span"),a(6,"Aucun plan d'action trouv\xE9"),i()()()()),e&2){let t=c(2);o(),ft("colspan",t.displayedColumns.length)}}function ii(e,s){if(e&1&&(r(0,"div")(1,"mat-card",15)(2,"mat-card-content")(3,"div",16)(4,"table",17),I(5,18),d(6,Ue,2,0,"th",19)(7,Ae,2,1,"td",20),b(),I(8,21),d(9,qe,2,0,"th",22)(10,ze,2,1,"td",20),b(),I(11,23),d(12,Ge,2,0,"th",19)(13,He,2,1,"td",20),b(),I(14,24),d(15,Qe,2,0,"th",19)(16,Je,3,4,"td",20),b(),I(17,25),d(18,Ke,2,0,"th",19)(19,We,3,6,"td",20),b(),I(20,26),d(21,Xe,2,0,"th",22)(22,Ye,10,0,"td",20),b(),d(23,Ze,1,0,"tr",27)(24,ti,1,0,"tr",28)(25,ei,7,1,"tr",29),i(),x(26,"mat-paginator",30),i()()()()),e&2){let t=c();o(4),m("dataSource",t.dataSource),o(19),m("matHeaderRowDef",t.displayedColumns),o(),m("matRowDefColumns",t.displayedColumns),o(2),m("pageSizeOptions",ht(4,Ne))}}var pt=(()=>{class e{constructor(t,n,l,p,f){this.planService=t,this.route=n,this.router=l,this.snackBar=p,this.dialog=f,this.displayedColumns=["title","mappingSummary","ownerName","dueDate","status","actions"],this.dataSource=new ie([]),this.isLoading=!1,this.error=null,this.mappingId=null}ngOnInit(){this.route.paramMap.subscribe(t=>{this.mappingId=t.get("mappingId"),this.loadPlans()})}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}loadPlans(){this.isLoading=!0,this.error=null,(this.mappingId?this.planService.getPlansByMapping(this.mappingId):this.planService.getPlans()).subscribe({next:n=>{this.dataSource.data=n,this.isLoading=!1},error:n=>{console.error("Erreur lors du chargement des plans",n),this.error="Impossible de charger les plans de rem\xE9diation. Veuillez r\xE9essayer.",this.isLoading=!1,this.showErrorSnackbar(this.error)}})}createPlan(){this.mappingId?this.router.navigate(["/remediation-plans/new",this.mappingId]):this.showErrorSnackbar("Veuillez d'abord s\xE9lectionner un mapping")}editPlan(t){this.router.navigate(["/remediation-plans/edit",t.id])}viewPlanDetails(t){this.router.navigate(["/remediation-plans/detail",t.id])}deletePlan(t){confirm(`\xCAtes-vous s\xFBr de vouloir supprimer le plan "${t.title}" ?`)&&this.planService.deletePlan(t.id).subscribe({next:()=>{this.loadPlans(),this.showSuccessSnackbar("Plan supprim\xE9 avec succ\xE8s")},error:n=>{console.error(`Erreur lors de la suppression du plan ${t.id}`,n),this.showErrorSnackbar("Impossible de supprimer le plan. Veuillez r\xE9essayer.")}})}getStatusClass(t){switch(t){case u.TODO:return"status-todo";case u.IN_PROGRESS:return"status-in-progress";case u.DONE:return"status-done";default:return""}}getStatusLabel(t){switch(t){case u.TODO:return"\xC0 faire";case u.IN_PROGRESS:return"En cours";case u.DONE:return"Termin\xE9";default:return t}}applyFilter(t){let n=t.target.value;this.dataSource.filter=n.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}showSuccessSnackbar(t){this.snackBar.open(t,"Fermer",{duration:3e3,panelClass:["success-snackbar"]})}showErrorSnackbar(t){this.snackBar.open(t,"Fermer",{duration:5e3,panelClass:["error-snackbar"]})}static{this.\u0275fac=function(n){return new(n||e)(g(q),g(T),g(F),g(U),g(re))}}static{this.\u0275cmp=w({type:e,selectors:[["app-plan-list"]],viewQuery:function(n,l){if(n&1&&(rt(it,5),rt(nt,5)),n&2){let p;at(p=ot())&&(l.paginator=p.first),at(p=ot())&&(l.sort=p.first)}},decls:18,vars:2,consts:[[1,"plan-list-container"],[1,"plan-list-header"],[1,"actions"],["mat-raised-button","","color","primary",3,"click"],[1,"filter-card"],["appearance","outline",1,"filter-field"],["matInput","","placeholder","Titre, responsable...",3,"keyup"],["matSuffix",""],["class","loading-error-container",4,"ngIf"],[4,"ngIf"],[1,"loading-error-container"],["mode","indeterminate","diameter","40",4,"ngIf"],["class","error-message",4,"ngIf"],["mode","indeterminate","diameter","40"],[1,"error-message"],[1,"table-card"],[1,"table-container"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","title"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","mappingSummary"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","ownerName"],["matColumnDef","dueDate"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],[1,"status-chip",3,"ngClass"],["mat-icon-button","","color","primary","matTooltip","Voir les d\xE9tails",3,"click"],["mat-icon-button","","color","accent","matTooltip","Modifier",3,"click"],["mat-icon-button","","color","warn","matTooltip","Supprimer",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],[1,"no-data-cell"],[1,"no-data-message"]],template:function(n,l){n&1&&(r(0,"div",0)(1,"div",1)(2,"h2"),a(3,"Plans d'Action de Rem\xE9diation"),i(),r(4,"div",2)(5,"button",3),v("click",function(){return l.createPlan()}),r(6,"mat-icon"),a(7,"add"),i(),a(8," Nouveau Plan "),i()()(),r(9,"mat-card",4)(10,"mat-form-field",5)(11,"mat-label"),a(12,"Rechercher"),i(),r(13,"input",6),v("keyup",function(f){return l.applyFilter(f)}),i(),r(14,"mat-icon",7),a(15,"search"),i()()(),d(16,Be,3,2,"div",8)(17,ii,27,5,"div",9),i()),n&2&&(o(16),m("ngIf",l.isLoading||l.error),o(),m("ngIf",!l.isLoading&&!l.error))},dependencies:[vt,k,zt,Ht,Wt,Qt,Gt,Xt,Jt,Kt,Yt,Zt,te,nt,ve,it,N,V,tt,Y,Z,et,L,It,$,j,Tt,J],styles:[".plan-list-container[_ngcontent-%COMP%]{padding:20px;max-width:100%}.plan-list-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.plan-list-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:500;color:#3f51b5}.filter-card[_ngcontent-%COMP%]{margin-bottom:20px;padding:10px 20px}.filter-field[_ngcontent-%COMP%]{width:100%}.loading-error-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:30px}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;color:#f44336}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.table-card[_ngcontent-%COMP%]{box-shadow:0 2px 10px #0000001a}.table-container[_ngcontent-%COMP%]{overflow-x:auto;width:100%}table[_ngcontent-%COMP%]{width:100%}.mat-header-cell[_ngcontent-%COMP%]{font-weight:700;color:#3f51b5}.status-chip[_ngcontent-%COMP%]{padding:4px 8px;border-radius:16px;font-size:12px;font-weight:500;display:inline-block;text-align:center;min-width:80px}.status-todo[_ngcontent-%COMP%]{background-color:#ffe0b2;color:#e65100}.status-in-progress[_ngcontent-%COMP%]{background-color:#b3e5fc;color:#01579b}.status-done[_ngcontent-%COMP%]{background-color:#c8e6c9;color:#1b5e20}.no-data-cell[_ngcontent-%COMP%]{text-align:center;padding:30px;font-style:italic}.no-data-message[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;color:#0000008a}.no-data-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}@media screen and (max-width: 960px){.plan-list-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.plan-list-header[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:15px}.mat-cell[_ngcontent-%COMP%]{padding:8px}.mat-header-row[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{padding:0}}"]})}}return e})();var Oe=(()=>{class e{constructor(t){this.http=t,this.apiUrl=`${X.apiUrl}/api/users`}getAllUsers(){return this.http.get(this.apiUrl)}getUserById(t){return this.http.get(`${this.apiUrl}/${t}`)}createUser(t){return this.http.post(this.apiUrl,t)}updateUser(t,n){return this.http.put(`${this.apiUrl}/${t}`,n)}deleteUser(t){return this.http.delete(`${this.apiUrl}/${t}`)}static{this.\u0275fac=function(n){return new(n||e)(H(K))}}static{this.\u0275prov=z({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function ri(e,s){e&1&&x(0,"mat-progress-spinner",8)}function ai(e,s){if(e&1&&(r(0,"div",9)(1,"mat-icon"),a(2,"error"),i(),r(3,"span"),a(4),i()()),e&2){let t=c(2);o(4),M(t.error)}}function oi(e,s){if(e&1&&(r(0,"div",5),d(1,ri,1,0,"mat-progress-spinner",6)(2,ai,5,1,"div",7),i()),e&2){let t=c();o(),m("ngIf",t.isLoading),o(),m("ngIf",t.error)}}function li(e,s){e&1&&(r(0,"mat-error"),a(1," Le titre est obligatoire "),i())}function si(e,s){e&1&&(r(0,"mat-error"),a(1," Le titre ne doit pas d\xE9passer 100 caract\xE8res "),i())}function mi(e,s){e&1&&(r(0,"mat-error"),a(1," La description ne doit pas d\xE9passer 2000 caract\xE8res "),i())}function pi(e,s){if(e&1&&(r(0,"mat-option",19),a(1),i()),e&2){let t=s.$implicit;m("value",t.id),o(),_t(" ",t.firstName," ",t.lastName," ")}}function di(e,s){e&1&&(r(0,"mat-error"),a(1," L'ID du mapping est obligatoire "),i())}function ci(e,s){if(e&1&&(r(0,"mat-form-field",17)(1,"mat-label"),a(2,"ID du mapping"),i(),x(3,"input",29),d(4,di,2,0,"mat-error",14),i()),e&2){let t,n=c(2);o(4),m("ngIf",(t=n.planForm.get("mappingId"))==null?null:t.hasError("required"))}}function ui(e,s){if(e&1&&(r(0,"mat-option",19),a(1),i()),e&2){let t=s.$implicit,n=c(2);m("value",t),o(),h(" ",n.getStatusLabel(t)," ")}}function fi(e,s){e&1&&(r(0,"mat-error"),a(1," Le statut est obligatoire "),i())}function gi(e,s){e&1&&x(0,"mat-spinner",30)}function _i(e,s){if(e&1&&(r(0,"span"),a(1),i()),e&2){let t=c(2);o(),M(t.isEditMode?"Mettre \xE0 jour":"Cr\xE9er")}}function hi(e,s){if(e&1){let t=y();r(0,"form",10),v("ngSubmit",function(){C(t);let l=c();return E(l.onSubmit())}),r(1,"mat-card",11)(2,"mat-card-content")(3,"mat-form-field",12)(4,"mat-label"),a(5,"Titre du plan"),i(),x(6,"input",13),d(7,li,2,0,"mat-error",14)(8,si,2,0,"mat-error",14),i(),r(9,"mat-form-field",12)(10,"mat-label"),a(11,"Description"),i(),x(12,"textarea",15),d(13,mi,2,0,"mat-error",14),i(),r(14,"div",16)(15,"mat-form-field",17)(16,"mat-label"),a(17,"Responsable"),i(),r(18,"mat-select",18)(19,"mat-option",19),a(20,"Non assign\xE9"),i(),d(21,pi,2,3,"mat-option",20),i()(),r(22,"mat-form-field",17)(23,"mat-label"),a(24,"Date d'\xE9ch\xE9ance"),i(),x(25,"input",21)(26,"mat-datepicker-toggle",22)(27,"mat-datepicker",null,0),i()(),r(29,"div",16),d(30,ci,5,1,"mat-form-field",23),r(31,"mat-form-field",17)(32,"mat-label"),a(33,"Statut"),i(),r(34,"mat-select",24),d(35,ui,2,2,"mat-option",20),i(),d(36,fi,2,0,"mat-error",14),i()()(),r(37,"mat-card-actions",25)(38,"button",26),v("click",function(){C(t);let l=c();return E(l.cancel())}),a(39,"Annuler"),i(),r(40,"button",27),d(41,gi,1,0,"mat-spinner",28)(42,_i,2,1,"span",14),i()()()()}if(e&2){let t,n,l,p,f=gt(28),_=c();m("formGroup",_.planForm),o(7),m("ngIf",(t=_.planForm.get("title"))==null?null:t.hasError("required")),o(),m("ngIf",(n=_.planForm.get("title"))==null?null:n.hasError("maxlength")),o(5),m("ngIf",(l=_.planForm.get("description"))==null?null:l.hasError("maxlength")),o(6),m("value",null),o(2),m("ngForOf",_.users),o(4),m("matDatepicker",f),o(),m("for",f),o(4),m("ngIf",!_.mappingId),o(5),m("ngForOf",_.statuses),o(),m("ngIf",(p=_.planForm.get("status"))==null?null:p.hasError("required")),o(4),m("disabled",_.submitting),o(),m("ngIf",_.submitting),o(),m("ngIf",!_.submitting)}}var dt=(()=>{class e{constructor(t,n,l,p,f,_,Te){this.fb=t,this.planService=n,this.userService=l,this.mappingService=p,this.route=f,this.router=_,this.snackBar=Te,this.isEditMode=!1,this.planId=null,this.mappingId=null,this.users=[],this.isLoading=!1,this.error=null,this.submitting=!1,this.statuses=Object.values(u)}ngOnInit(){this.initForm(),this.loadFormData()}initForm(){this.planForm=this.fb.group({title:["",[B.required,B.maxLength(100)]],description:["",B.maxLength(2e3)],ownerId:[null],dueDate:[null],status:[u.TODO,B.required],mappingId:["",B.required]})}loadFormData(){this.isLoading=!0,this.error=null,this.route.paramMap.subscribe(t=>{this.planId=t.get("id");let n=t.get("mappingId");console.debug("Param\xE8tres URL:",{id:this.planId,mappingId:n}),this.mappingId=n?+n:null,this.isEditMode=!!this.planId;let l=this.userService.getAllUsers(),p=ct(null);this.isEditMode&&this.planId&&(p=this.planService.getPlan(this.planId)),this.mappingId?(console.debug("MappingId extrait de l'URL:",this.mappingId),this.planForm.patchValue({mappingId:this.mappingId}),this.mappingService.getMapping(this.mappingId.toString()).subscribe({next:f=>{console.debug("Mapping trouv\xE9:",f)},error:f=>{console.error("Erreur lors de la v\xE9rification du mapping:",f),this.showErrorSnackbar(`Le mapping #${this.mappingId} n'existe pas. Assurez-vous de venir d'une analyse d'\xE9carts valide.`)}})):console.debug("Aucun mappingId trouv\xE9 dans l'URL"),ut({users:l,plan:p}).subscribe({next:f=>{if(this.users=f.users,f.plan&&this.isEditMode){let _=f.plan;_.dueDate&&(_.dueDate=new Date(_.dueDate)),this.planForm.patchValue(_)}this.isLoading=!1},error:f=>{console.error("Erreur lors du chargement des donn\xE9es",f),this.error="Impossible de charger les donn\xE9es. Veuillez r\xE9essayer.",this.isLoading=!1,this.showErrorSnackbar(this.error)}})})}onSubmit(){if(this.planForm.invalid){this.markFormGroupTouched(this.planForm);return}let t=this.planForm.value;if(t.dueDate&&(t.dueDate=t.dueDate.toISOString().split("T")[0]),t.mappingId&&typeof t.mappingId=="string"?t.mappingId=parseInt(t.mappingId,10):this.mappingId&&(t.mappingId=this.mappingId),!t.mappingId){this.showErrorSnackbar("ID de mapping manquant. Veuillez vous assurer de venir d'une analyse d'\xE9carts valide.");return}let n=t;console.debug("Envoi DTO RemediationPlan",n),this.submitting=!0,(this.isEditMode&&this.planId?this.planService.updatePlan(this.planId,n):this.planService.createPlan(n)).subscribe({next:p=>{this.submitting=!1;let f=this.isEditMode?"Plan mis \xE0 jour avec succ\xE8s":"Plan cr\xE9\xE9 avec succ\xE8s";this.showSuccessSnackbar(f),this.router.navigate(["/remediation-plans",n.mappingId])},error:p=>{console.error("Erreur lors de la soumission du formulaire",p),this.submitting=!1,p.status===404&&p.error&&p.error.message&&p.error.message.includes("Mapping non trouv\xE9")?this.showErrorSnackbar("Mapping non trouv\xE9. V\xE9rifiez que vous venez bien d'une analyse d'\xE9carts valide."):this.showErrorSnackbar("Impossible de sauvegarder le plan. Veuillez r\xE9essayer.")}})}cancel(){this.mappingId?this.router.navigate(["/remediation-plans",this.mappingId]):this.router.navigate(["/remediation-plans"])}markFormGroupTouched(t){Object.values(t.controls).forEach(n=>{n.markAsTouched(),n instanceof Vt&&this.markFormGroupTouched(n)})}getStatusLabel(t){switch(t){case u.TODO:return"\xC0 faire";case u.IN_PROGRESS:return"En cours";case u.DONE:return"Termin\xE9";default:return t}}showSuccessSnackbar(t){this.snackBar.open(t,"Fermer",{duration:3e3,panelClass:["success-snackbar"]})}showErrorSnackbar(t){this.snackBar.open(t,"Fermer",{duration:5e3,panelClass:["error-snackbar"]})}static{this.\u0275fac=function(n){return new(n||e)(g(At),g(q),g(Oe),g(Ee),g(T),g(F),g(U))}}static{this.\u0275cmp=w({type:e,selectors:[["app-plan-form"]],decls:6,vars:3,consts:[["picker",""],[1,"plan-form-container"],[1,"plan-form-header"],["class","loading-error-container",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"loading-error-container"],["mode","indeterminate","diameter","40",4,"ngIf"],["class","error-message",4,"ngIf"],["mode","indeterminate","diameter","40"],[1,"error-message"],[3,"ngSubmit","formGroup"],[1,"form-card"],["appearance","outline",1,"full-width"],["matInput","","formControlName","title","placeholder","Ex: Mise \xE0 jour de la politique de s\xE9curit\xE9","required",""],[4,"ngIf"],["matInput","","formControlName","description","rows","4","placeholder","D\xE9crivez les actions \xE0 entreprendre..."],[1,"form-row"],["appearance","outline",1,"form-field"],["formControlName","ownerId"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","dueDate",3,"matDatepicker"],["matSuffix","",3,"for"],["appearance","outline","class","form-field",4,"ngIf"],["formControlName","status","required",""],[1,"form-actions"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",4,"ngIf"],["matInput","","formControlName","mappingId","required",""],["diameter","20"]],template:function(n,l){n&1&&(r(0,"div",1)(1,"div",2)(2,"h2"),a(3),i()(),d(4,oi,3,2,"div",3)(5,hi,43,14,"form",4),i()),n&2&&(o(3),M(l.isEditMode?"Modifier le Plan de Rem\xE9diation":"Nouveau Plan de Rem\xE9diation"),o(),m("ngIf",l.isLoading||l.error),o(),m("ngIf",!l.isLoading&&!l.error))},dependencies:[Ct,k,jt,Rt,Lt,Nt,Ut,$t,Bt,N,W,V,tt,Y,oe,Z,et,me,Pt,fe,ge,_e,L,$,j],styles:[".plan-form-container[_ngcontent-%COMP%]{max-width:100%}.plan-form-header[_ngcontent-%COMP%]{margin-bottom:20px}.plan-form-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:500;color:#3f51b5}.loading-error-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:30px}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;color:#f44336}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.form-card[_ngcontent-%COMP%]{margin-bottom:20px;padding:20px}.full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}.form-row[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:16px}.form-field[_ngcontent-%COMP%]{flex:1}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px}button[type=submit][_ngcontent-%COMP%]{min-width:120px;display:flex;justify-content:center;align-items:center}mat-spinner[_ngcontent-%COMP%]{margin-right:5px}@media screen and (max-width: 768px){.form-row[_ngcontent-%COMP%]{flex-direction:column;gap:0}.form-field[_ngcontent-%COMP%]{width:100%}}"]})}}return e})();function xi(e,s){if(e&1&&(r(0,"div",9)(1,"h3"),a(2,"Description d\xE9taill\xE9e"),i(),r(3,"p"),a(4),i()()),e&2){let t=c(2);o(4),M(t.plan.description)}}function vi(e,s){if(e&1){let t=y();r(0,"div")(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title"),a(4),i(),r(5,"mat-chip-set")(6,"mat-chip",3),a(7),i()()(),r(8,"mat-card-content")(9,"div",4)(10,"div")(11,"strong"),a(12,"Titre :"),i(),a(13),i(),r(14,"div")(15,"strong"),a(16,"Description :"),i(),a(17),i(),r(18,"div")(19,"strong"),a(20,"\xC9ch\xE9ance :"),i(),a(21),O(22,"date"),i(),r(23,"div")(24,"strong"),a(25,"Responsable :"),i(),a(26),i(),r(27,"div")(28,"strong"),a(29,"Cr\xE9\xE9 le :"),i(),a(30),O(31,"date"),i(),r(32,"div")(33,"strong"),a(34,"Mis \xE0 jour :"),i(),a(35),O(36,"date"),i(),r(37,"div")(38,"strong"),a(39,"Lien au mapping :"),i(),a(40),i(),r(41,"div")(42,"strong"),a(43,"R\xE9sum\xE9 du mapping :"),i(),a(44),i()(),d(45,xi,5,1,"div",5),i(),r(46,"mat-card-actions",6)(47,"button",7),a(48,"Retour"),i(),r(49,"button",8),v("click",function(){C(t);let l=c();return E(l.editPlan())}),a(50,"Modifier"),i()()()()}if(e&2){let t=c();o(4),h("Plan #",t.plan.id,""),o(2),m("color",t.getChipColor(t.plan.status)),o(),M(t.getStatusLabel(t.plan.status)),o(6),h(" ",t.plan.title,""),o(4),h(" ",t.plan.description||"Non sp\xE9cifi\xE9e",""),o(4),h(" ",D(22,12,t.plan.dueDate,"dd/MM/yyyy"),""),o(5),h(" ",t.plan.ownerName||"Non assign\xE9",""),o(4),h(" ",D(31,15,t.plan.createdAt,"dd/MM/yyyy"),""),o(5),h(" ",D(36,18,t.plan.updatedAt,"dd/MM/yyyy"),""),o(5),h(" ",t.plan.mappingId,""),o(4),h(" ",t.plan.mappingSummary||"Non sp\xE9cifi\xE9",""),o(),m("ngIf",t.plan.description)}}function Ci(e,s){e&1&&(r(0,"div",10),x(1,"mat-spinner",11),r(2,"p"),a(3,"Chargement du plan d'action..."),i()()),e&2&&(o(),m("diameter",40))}function Ei(e,s){if(e&1){let t=y();r(0,"mat-card",12)(1,"mat-card-content")(2,"div",13)(3,"mat-icon"),a(4,"error"),i(),r(5,"span"),a(6,"Impossible de charger les d\xE9tails du plan d'action. Veuillez r\xE9essayer plus tard."),i()()(),r(7,"mat-card-actions",6)(8,"button",14),v("click",function(){C(t);let l=c();return E(l.goBack())}),a(9,"Retour"),i()()()}}var De=(()=>{class e{constructor(t,n,l,p){this.route=t,this.router=n,this.planService=l,this.snackBar=p,this.plan=null,this.loading=!0,this.error=!1}ngOnInit(){let t=this.route.snapshot.paramMap.get("id");t?this.loadPlan(t):(this.error=!0,this.loading=!1,this.snackBar.open("ID du plan non sp\xE9cifi\xE9","Fermer",{duration:3e3}))}loadPlan(t){this.planService.getPlan(t).subscribe({next:n=>{this.plan=n,this.loading=!1},error:n=>{console.error("Erreur lors du chargement du plan:",n),this.error=!0,this.loading=!1,this.snackBar.open("Erreur lors du chargement du plan","Fermer",{duration:3e3})}})}getStatusLabel(t){switch(t){case u.TODO:return"\xC0 faire";case u.IN_PROGRESS:return"En cours";case u.DONE:return"Termin\xE9";default:return t}}getChipColor(t){switch(t){case u.TODO:return"warn";case u.IN_PROGRESS:return"primary";case u.DONE:return"accent";default:return}}goBack(){this.router.navigate(["/remediation-plans"])}editPlan(){this.plan&&this.router.navigate(["/remediation-plans/edit",this.plan.id])}static{this.\u0275fac=function(n){return new(n||e)(g(T),g(F),g(q),g(U))}}static{this.\u0275cmp=w({type:e,selectors:[["app-plan-detail"]],decls:3,vars:3,consts:[[4,"ngIf"],["class","loading-container",4,"ngIf"],["class","error-card",4,"ngIf"],["selected","",3,"color"],[1,"grid"],["class","description-section",4,"ngIf"],["align","end"],["mat-button","","routerLink","/remediation-plans"],["mat-raised-button","","color","accent",3,"click"],[1,"description-section"],[1,"loading-container"],[3,"diameter"],[1,"error-card"],[1,"error-message"],["mat-button","",3,"click"]],template:function(n,l){n&1&&d(0,vi,51,21,"div",0)(1,Ci,4,1,"div",1)(2,Ei,10,0,"mat-card",2),n&2&&(m("ngIf",!l.loading&&!l.error&&l.plan),o(),m("ngIf",l.loading),o(),m("ngIf",!l.loading&&l.error))},dependencies:[k,Mt,N,W,V,wt,yt,L,$,de,ce,j,J],styles:[".status-todo[_ngcontent-%COMP%]{background-color:#f8d7da!important;color:#721c24!important}.status-in-progress[_ngcontent-%COMP%]{background-color:#fff3cd!important;color:#856404!important}.status-done[_ngcontent-%COMP%]{background-color:#d4edda!important;color:#155724!important}.mat-card[_ngcontent-%COMP%], .mat-card-header[_ngcontent-%COMP%]{margin-bottom:20px}mat-spinner[_ngcontent-%COMP%]{margin:0 auto}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:16px;margin-bottom:24px}.description-section[_ngcontent-%COMP%]{margin-top:24px;border-top:1px solid rgba(0,0,0,.12);padding-top:16px}.description-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;color:#3f51b5;font-weight:500}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:#0000008a}.error-card[_ngcontent-%COMP%]{margin-top:16px}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;color:#f44336}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}"]})}}return e})();var Mi=[{path:"",children:[{path:"",component:pt,canActivate:[R]},{path:"new/:mappingId",component:dt,canActivate:[R]},{path:":mappingId",component:pt,canActivate:[R]},{path:"edit/:id",component:dt,canActivate:[R]},{path:"detail/:id",component:De,canActivate:[R]}]}],ke=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=Q({type:e})}static{this.\u0275inj=G({imports:[st.forChild(Mi),st]})}}return e})();var On=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=Q({type:e})}static{this.\u0275inj=G({imports:[Et,qt,ke,ee,Ce,xe,Ot,le,se,pe,he,St,bt,kt,ue,ne,Dt,Ft,ae]})}}return e})();export{On as RemediationPlanModule};
