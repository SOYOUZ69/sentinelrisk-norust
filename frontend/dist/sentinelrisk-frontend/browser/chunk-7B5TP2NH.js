import{I as d}from"./chunk-QKUORI4T.js";import{C as i,S as u,V as c,a as p,b as l,q as s,s as n}from"./chunk-VIZ3R537.js";var E=(()=>{class a{constructor(e){this.apiService=e,this.basePath="/controls"}getControls(){return this.apiService.get(this.basePath).pipe(n(e=>e.map(r=>this.mapControlResponse(r))),i(e=>(console.error("Erreur lors de la r\xE9cup\xE9ration des contr\xF4les",e),s(()=>new Error("Impossible de r\xE9cup\xE9rer la liste des contr\xF4les. Veuillez r\xE9essayer.")))))}getControl(e){return this.apiService.get(`${this.basePath}/${e}`).pipe(n(r=>this.mapControlResponse(r)),i(r=>(console.error(`Erreur lors de la r\xE9cup\xE9ration du contr\xF4le ${e}`,r),s(()=>new Error("Impossible de r\xE9cup\xE9rer les d\xE9tails du contr\xF4le. Veuillez r\xE9essayer.")))))}createControl(e){let r=this.formatControlRequest(e);return this.apiService.post(this.basePath,r).pipe(n(t=>this.mapControlResponse(t)),i(t=>{console.error("Erreur lors de la cr\xE9ation du contr\xF4le",t);let o=this.getErrorMessage(t)||"Impossible de cr\xE9er le contr\xF4le. Veuillez r\xE9essayer.";return s(()=>new Error(o))}))}updateControl(e,r){let t=this.formatControlRequest(r);return this.apiService.put(`${this.basePath}/${e}`,t).pipe(n(o=>this.mapControlResponse(o)),i(o=>{console.error(`Erreur lors de la mise \xE0 jour du contr\xF4le ${e}`,o);let m=this.getErrorMessage(o)||"Impossible de mettre \xE0 jour le contr\xF4le. Veuillez r\xE9essayer.";return s(()=>new Error(m))}))}deleteControl(e){return this.apiService.delete(`${this.basePath}/${e}`).pipe(i(r=>(console.error(`Erreur lors de la suppression du contr\xF4le ${e}`,r),s(()=>new Error("Impossible de supprimer le contr\xF4le. Veuillez r\xE9essayer.")))))}getControlsByType(e){return this.apiService.get(`${this.basePath}/type/${e}`).pipe(n(r=>r.map(t=>this.mapControlResponse(t))),i(r=>(console.error(`Erreur lors de la r\xE9cup\xE9ration des contr\xF4les de type ${e}`,r),s(()=>new Error("Impossible de r\xE9cup\xE9rer les contr\xF4les de ce type. Veuillez r\xE9essayer.")))))}getControlsByStatus(e){return this.apiService.get(`${this.basePath}/status/${e}`).pipe(n(r=>r.map(t=>this.mapControlResponse(t))),i(r=>(console.error(`Erreur lors de la r\xE9cup\xE9ration des contr\xF4les avec le statut ${e}`,r),s(()=>new Error("Impossible de r\xE9cup\xE9rer les contr\xF4les avec ce statut. Veuillez r\xE9essayer.")))))}getControlsByFrequency(e){return this.apiService.get(`${this.basePath}/frequency/${e}`)}getControlsByRisk(e){return this.apiService.get(`${this.basePath}/risk/${e}`).pipe(n(r=>r.map(t=>this.mapControlResponse(t))),i(r=>(console.error(`Erreur lors de la r\xE9cup\xE9ration des contr\xF4les associ\xE9s au risque ${e}`,r),s(()=>new Error("Impossible de r\xE9cup\xE9rer les contr\xF4les associ\xE9s \xE0 ce risque. Veuillez r\xE9essayer.")))))}mapControlResponse(e){return l(p({},e),{id:e.id?.toString(),implementationDate:e.implementationDate?new Date(e.implementationDate):void 0,lastTestedDate:e.lastTestedDate?new Date(e.lastTestedDate):void 0,createdAt:e.createdAt?new Date(e.createdAt):void 0,updatedAt:e.updatedAt?new Date(e.updatedAt):void 0,riskIds:e.risks?e.risks.map(r=>r.id.toString()):[]})}formatControlRequest(e){return{name:e.name,description:e.description,type:e.type,status:e.status,frequency:e.frequency,owner:e.owner,implementationDate:e.implementationDate,lastTestedDate:e.lastTestedDate,effectivenessScore:e.effectivenessScore,documentation:e.documentation,riskIds:e.riskIds}}getErrorMessage(e){if(e.error){if(typeof e.error=="string")return e.error;if(e.error.message)return e.error.message;if(typeof e.error=="object"){let r=Object.entries(e.error).map(([t,o])=>`${t}: ${o}`).join(", ");if(r)return`Erreurs de validation: ${r}`}}return e.statusText||"Une erreur est survenue"}static{this.\u0275fac=function(r){return new(r||a)(c(d))}}static{this.\u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{E as a};
