import{a as be}from"./chunk-RWLWNASV.js";import{a as lt,b as Me,c as $,d as Ee}from"./chunk-DECP24M2.js";import"./chunk-Q63SNJNY.js";import{a as T}from"./chunk-7JVSQN77.js";import"./chunk-6BR4RKUN.js";import"./chunk-4OHCZ47J.js";import{a as he,e as xe}from"./chunk-R3ERDSFW.js";import{a as ce,b as ue,c as fe,d as ge}from"./chunk-BM6JOVDS.js";import{a as tt,b as ie,c as re,d as at,e as pe}from"./chunk-4PQ7QBTL.js";import{a as L,b as wt,c as F,d as Dt,e as Y,f as kt,h as Tt}from"./chunk-MPB4WSS5.js";import"./chunk-3ZNKIO6H.js";import{a as qt,b as Gt,c as Ht,d as Qt,e as Jt,f as Kt,g as Wt,h as Xt,i as Yt,j as Zt,k as te,l as ee,m as ne,n as j,o as Ce,r as ve,v as Pe}from"./chunk-NPMEEAYW.js";import{a as et,b as ae,d as nt,f as it,g as oe,h as le,i as se,k as ot,l as de}from"./chunk-ZR4OZC73.js";import{A as $t,B as Bt,E as Ut,F as zt,H as At,ha as rt,ia as me,ja as V,ka as _e,p as Ft,r as N,t as Rt,u as Nt,v as Vt,y as jt}from"./chunk-LQ6MDXSH.js";import{a as R,b as Lt}from"./chunk-DEA6IKFQ.js";import{$ as O,$a as c,D as E,Fa as d,Ga as xt,Ha as m,Kb as bt,Lb as Et,Mb as w,Pb as J,Qa as i,Ra as r,Sa as _,T as q,Ta as S,Tb as St,U as G,Ua as I,W as H,Wa as y,Xb as dt,Yb as K,Yc as It,Za as x,aa as Q,da as v,db as st,dc as D,ea as P,eb as mt,fb as pt,fc as k,gb as Ct,gd as yt,hb as a,ib as C,ic as ct,jb as M,kb as vt,md as W,od as X,pd as Ot,q as _t,qd as Z,r as b,rb as Pt,ta as l,ua as g,ub as Mt,vb as z,x as ht,xb as A}from"./chunk-KODBDAN5.js";var u=function(e){return e.TODO="TODO",e.IN_PROGRESS="IN_PROGRESS",e.DONE="DONE",e}(u||{});var U=(()=>{class e{constructor(t){this.http=t,this.apiUrl=`${Z.apiUrl}/api/remediation-plans`}getPlans(){return this.http.get(this.apiUrl).pipe(E(t=>(console.error("Erreur lors de la r\xE9cup\xE9ration des plans de rem\xE9diation",t),b(()=>new Error("Impossible de r\xE9cup\xE9rer la liste des plans. Veuillez r\xE9essayer.")))))}getPlansByMapping(t){let n=new dt().set("mappingId",t);return this.http.get(this.apiUrl,{params:n}).pipe(E(o=>(console.error(`Erreur lors de la r\xE9cup\xE9ration des plans pour le mapping ${t}`,o),b(()=>new Error("Impossible de r\xE9cup\xE9rer les plans pour ce mapping. Veuillez r\xE9essayer.")))))}getPlansByOwner(t){let n=new dt().set("ownerId",t);return this.http.get(this.apiUrl,{params:n}).pipe(E(o=>(console.error(`Erreur lors de la r\xE9cup\xE9ration des plans pour l'utilisateur ${t}`,o),b(()=>new Error("Impossible de r\xE9cup\xE9rer les plans pour cet utilisateur. Veuillez r\xE9essayer.")))))}getPlan(t){return this.http.get(`${this.apiUrl}/${t}`).pipe(E(n=>(console.error(`Erreur lors de la r\xE9cup\xE9ration du plan ${t}`,n),b(()=>new Error("Impossible de r\xE9cup\xE9rer les d\xE9tails du plan. Veuillez r\xE9essayer.")))))}createPlan(t){return this.http.post(this.apiUrl,t).pipe(E(n=>(console.error("Erreur lors de la cr\xE9ation du plan",n),b(()=>new Error("Impossible de cr\xE9er le plan. Veuillez r\xE9essayer.")))))}updatePlan(t,n){return this.http.put(`${this.apiUrl}/${t}`,n).pipe(E(o=>(console.error(`Erreur lors de la mise \xE0 jour du plan ${t}`,o),b(()=>new Error("Impossible de mettre \xE0 jour le plan. Veuillez r\xE9essayer.")))))}deletePlan(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(E(n=>(console.error(`Erreur lors de la suppression du plan ${t}`,n),b(()=>new Error("Impossible de supprimer le plan. Veuillez r\xE9essayer.")))))}static{this.\u0275fac=function(n){return new(n||e)(H(K))}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var ze=()=>[5,10,25,100],Ae=(e,s,t)=>({"status-todo":e,"status-in-progress":s,"status-done":t});function qe(e,s){e&1&&_(0,"mat-progress-spinner",16)}function Ge(e,s){if(e&1&&(i(0,"div",17)(1,"mat-icon"),a(2,"error"),r(),i(3,"span"),a(4),r()()),e&2){let t=c(2);l(4),C(t.error)}}function He(e,s){if(e&1&&(i(0,"div",13),d(1,qe,1,0,"mat-progress-spinner",14)(2,Ge,5,1,"div",15),r()),e&2){let t=c();l(),m("ngIf",t.isLoading),l(),m("ngIf",t.error)}}function Qe(e,s){e&1&&(i(0,"th",34),a(1," Titre "),r())}function Je(e,s){if(e&1&&(i(0,"td",35),a(1),r()),e&2){let t=s.$implicit;l(),M(" ",t.title," ")}}function Ke(e,s){e&1&&(i(0,"th",36),a(1," \xC9cart "),r())}function We(e,s){if(e&1&&(i(0,"td",35),a(1),r()),e&2){let t=s.$implicit;l(),M(" ",t.mappingSummary||"Non sp\xE9cifi\xE9"," ")}}function Xe(e,s){e&1&&(i(0,"th",34),a(1," Responsable "),r())}function Ye(e,s){if(e&1&&(i(0,"td",35),a(1),r()),e&2){let t=s.$implicit;l(),M(" ",t.ownerName||"Non assign\xE9"," ")}}function Ze(e,s){e&1&&(i(0,"th",34),a(1," \xC9ch\xE9ance "),r())}function tn(e,s){if(e&1&&(i(0,"td",35),a(1),z(2,"date"),r()),e&2){let t=s.$implicit;l(),M(" ",A(2,1,t.dueDate,"dd/MM/yyyy")," ")}}function en(e,s){e&1&&(i(0,"th",34),a(1," Statut "),r())}function nn(e,s){if(e&1&&(i(0,"td",35)(1,"span",37),a(2),r()()),e&2){let t=s.$implicit;l(),m("ngClass",Mt(2,Ae,t.status==="TODO",t.status==="IN_PROGRESS",t.status==="DONE")),l(),M(" ",t.status==="TODO"?"\xC0 faire":t.status==="IN_PROGRESS"?"En cours":"Termin\xE9"," ")}}function rn(e,s){e&1&&(i(0,"th",36),a(1," Actions "),r())}function an(e,s){if(e&1){let t=y();i(0,"td",35)(1,"button",38),x("click",function(){let o=v(t).$implicit,p=c(2);return P(p.viewPlanDetails(o))}),i(2,"mat-icon"),a(3,"visibility"),r()(),i(4,"button",39),x("click",function(){let o=v(t).$implicit,p=c(2);return P(p.editPlan(o))}),i(5,"mat-icon"),a(6,"edit"),r()(),i(7,"button",40),x("click",function(){let o=v(t).$implicit,p=c(2);return P(p.deletePlan(o))}),i(8,"mat-icon"),a(9,"delete"),r()()()}}function on(e,s){e&1&&_(0,"tr",41)}function ln(e,s){e&1&&_(0,"tr",42)}function sn(e,s){if(e&1&&(i(0,"tr",43)(1,"td",44)(2,"div",45)(3,"mat-icon"),a(4,"info"),r(),i(5,"span"),a(6,"Aucun plan d'action trouv\xE9"),r()()()()),e&2){let t=c(2);l(),xt("colspan",t.displayedColumns.length)}}function mn(e,s){if(e&1&&(i(0,"div")(1,"mat-card",18)(2,"mat-card-content")(3,"div",19)(4,"table",20),S(5,21),d(6,Qe,2,0,"th",22)(7,Je,2,1,"td",23),I(),S(8,24),d(9,Ke,2,0,"th",25)(10,We,2,1,"td",23),I(),S(11,26),d(12,Xe,2,0,"th",22)(13,Ye,2,1,"td",23),I(),S(14,27),d(15,Ze,2,0,"th",22)(16,tn,3,4,"td",23),I(),S(17,28),d(18,en,2,0,"th",22)(19,nn,3,6,"td",23),I(),S(20,29),d(21,rn,2,0,"th",25)(22,an,10,0,"td",23),I(),d(23,on,1,0,"tr",30)(24,ln,1,0,"tr",31)(25,sn,7,1,"tr",32),r(),_(26,"mat-paginator",33),r()()()()),e&2){let t=c();l(4),m("dataSource",t.dataSource),l(19),m("matHeaderRowDef",t.displayedColumns),l(),m("matRowDefColumns",t.displayedColumns),l(2),m("pageSizeOptions",Pt(4,ze))}}var ft=(()=>{class e{constructor(t,n,o,p,f){this.planService=t,this.route=n,this.router=o,this.snackBar=p,this.dialog=f,this.displayedColumns=["title","mappingSummary","ownerName","dueDate","status","actions"],this.dataSource=new ne([]),this.isLoading=!1,this.error=null,this.mappingId=null}ngOnInit(){console.debug("PlanList: Initialisation du composant"),console.debug("PlanList: URL actuelle:",window.location.href),this.route.paramMap.subscribe(t=>{console.debug("PlanList: Param\xE8tres re\xE7us:",t),this.mappingId=t.get("mappingId"),console.debug("PlanList: MappingId extrait:",this.mappingId),this.loadPlans()}),this.router.events.subscribe(t=>{console.debug("PlanList: \xC9v\xE9nement de routage:",t)})}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}loadPlans(){console.debug("PlanList: Chargement des plans, mappingId:",this.mappingId),this.isLoading=!0,this.error=null,(this.mappingId?this.planService.getPlansByMapping(this.mappingId):this.planService.getPlans()).subscribe({next:n=>{console.debug("PlanList: Plans r\xE9cup\xE9r\xE9s:",n.length),console.debug("PlanList: Donn\xE9es des plans:",n),this.dataSource.data=n,this.isLoading=!1},error:n=>{console.error("PlanList: Erreur lors du chargement des plans",n),this.error="Impossible de charger les plans de rem\xE9diation. Veuillez r\xE9essayer.",this.isLoading=!1,this.showErrorSnackbar(this.error)}})}createPlan(){if(console.debug("PlanList: Cr\xE9ation d'un nouveau plan pour mappingId:",this.mappingId),this.mappingId){let t=["/remediation-plans/new",this.mappingId];console.debug("PlanList: Navigation vers",t.join("/")),this.router.navigate(t).then(n=>console.debug("PlanList: Navigation r\xE9ussie:",n),n=>console.error("PlanList: Erreur de navigation:",n))}else this.showErrorSnackbar("Veuillez d'abord s\xE9lectionner un mapping")}editPlan(t){console.debug("PlanList: \xC9dition du plan:",t.id);let n=["/remediation-plans/edit",t.id];console.debug("PlanList: Navigation vers",n.join("/")),this.router.navigate(n).then(o=>console.debug("PlanList: Navigation r\xE9ussie:",o),o=>console.error("PlanList: Erreur de navigation:",o))}viewPlanDetails(t){console.debug("PlanList: Affichage des d\xE9tails du plan:",t.id);let n=["/remediation-plans/detail",t.id];console.debug("PlanList: Navigation vers",n.join("/")),this.router.navigate(n).then(o=>console.debug("PlanList: Navigation r\xE9ussie:",o),o=>console.error("PlanList: Erreur de navigation:",o))}deletePlan(t){confirm(`\xCAtes-vous s\xFBr de vouloir supprimer le plan "${t.title}" ?`)&&this.planService.deletePlan(t.id).subscribe({next:()=>{this.loadPlans(),this.showSuccessSnackbar("Plan supprim\xE9 avec succ\xE8s")},error:n=>{console.error(`Erreur lors de la suppression du plan ${t.id}`,n),this.showErrorSnackbar("Impossible de supprimer le plan. Veuillez r\xE9essayer.")}})}getStatusClass(t){switch(t){case u.TODO:return"status-todo";case u.IN_PROGRESS:return"status-in-progress";case u.DONE:return"status-done";default:return""}}getStatusLabel(t){switch(t){case u.TODO:return"\xC0 faire";case u.IN_PROGRESS:return"En cours";case u.DONE:return"Termin\xE9";default:return t}}applyFilter(t){let n=t.target.value;this.dataSource.filter=n.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}showSuccessSnackbar(t){this.snackBar.open(t,"Fermer",{duration:3e3,panelClass:["success-snackbar"]})}showErrorSnackbar(t){this.snackBar.open(t,"Fermer",{duration:5e3,panelClass:["error-snackbar"]})}static{this.\u0275fac=function(n){return new(n||e)(g(U),g(D),g(k),g(j),g(ve))}}static{this.\u0275cmp=O({type:e,selectors:[["app-plan-list"]],viewQuery:function(n,o){if(n&1&&(st(at,5),st(tt,5)),n&2){let p;mt(p=pt())&&(o.paginator=p.first),mt(p=pt())&&(o.sort=p.first)}},decls:20,vars:2,consts:[[1,"layout"],[1,"sidebar"],[1,"content"],["color","primary"],[1,"spacer"],["mat-icon-button","","matTooltip","Cr\xE9er un nouveau plan",3,"click"],[1,"page-content"],[1,"filter-card"],["appearance","outline",1,"filter-field"],["matInput","","placeholder","Titre, responsable...",3,"keyup"],["matSuffix",""],["class","loading-error-container",4,"ngIf"],[4,"ngIf"],[1,"loading-error-container"],["mode","indeterminate","diameter","40",4,"ngIf"],["class","error-message",4,"ngIf"],["mode","indeterminate","diameter","40"],[1,"error-message"],[1,"table-card"],[1,"table-container"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","title"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","mappingSummary"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","ownerName"],["matColumnDef","dueDate"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],[1,"status-chip",3,"ngClass"],["mat-icon-button","","color","primary","matTooltip","Voir les d\xE9tails",3,"click"],["mat-icon-button","","color","accent","matTooltip","Modifier",3,"click"],["mat-icon-button","","color","warn","matTooltip","Supprimer",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],[1,"no-data-cell"],[1,"no-data-message"]],template:function(n,o){n&1&&(i(0,"div",0),_(1,"app-sidebar",1),i(2,"div",2)(3,"mat-toolbar",3)(4,"span"),a(5,"Plans d'Action de Rem\xE9diation"),r(),_(6,"span",4),i(7,"button",5),x("click",function(){return o.createPlan()}),i(8,"mat-icon"),a(9,"add"),r()()(),i(10,"div",6)(11,"mat-card",7)(12,"mat-form-field",8)(13,"mat-label"),a(14,"Rechercher"),r(),i(15,"input",9),x("keyup",function(f){return o.applyFilter(f)}),r(),i(16,"mat-icon",10),a(17,"search"),r()()(),d(18,He,3,2,"div",11)(19,mn,27,5,"div",12),r()()()),n&2&&(l(18),m("ngIf",o.isLoading||o.error),l(),m("ngIf",!o.isLoading&&!o.error))},dependencies:[bt,w,$,qt,Ht,Wt,Qt,Gt,Xt,Jt,Kt,Yt,Zt,te,tt,ie,at,L,F,it,et,nt,ot,X,V,R,rt,lt,J],styles:[".layout[_ngcontent-%COMP%]{display:flex;min-height:100vh}.sidebar[_ngcontent-%COMP%]{width:250px;flex-shrink:0}.content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;background-color:#f5f5f5}.page-content[_ngcontent-%COMP%]{padding:24px;flex:1}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}.filter-card[_ngcontent-%COMP%]{margin-bottom:24px}.filter-field[_ngcontent-%COMP%]{width:100%}.table-card[_ngcontent-%COMP%]{margin-bottom:24px}.table-container[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%}.loading-error-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:200px}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;color:#f44336;gap:8px}.status-chip[_ngcontent-%COMP%]{padding:4px 8px;border-radius:16px;font-size:12px;font-weight:500}.status-todo[_ngcontent-%COMP%]{background-color:#ffd740;color:#000000de}.status-in-progress[_ngcontent-%COMP%]{background-color:#69f0ae;color:#000000de}.status-done[_ngcontent-%COMP%]{background-color:#b2dfdb;color:#000000de}.no-data-cell[_ngcontent-%COMP%]{padding:24px!important}.no-data-message[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;color:#0000008a}.mat-column-actions[_ngcontent-%COMP%]{width:120px;text-align:center}.mat-column-status[_ngcontent-%COMP%], .mat-column-dueDate[_ngcontent-%COMP%]{width:120px}@media (max-width: 768px){.page-content[_ngcontent-%COMP%]{padding:16px}.filter-card[_ngcontent-%COMP%], .table-card[_ngcontent-%COMP%]{margin-bottom:16px}}"]})}}return e})();var Le=(()=>{class e{constructor(t){this.http=t,this.apiUrl=`${Z.apiUrl}/api/users`}getAllUsers(){return this.http.get(this.apiUrl)}getUserById(t){return this.http.get(`${this.apiUrl}/${t}`)}createUser(t){return this.http.post(this.apiUrl,t)}updateUser(t,n){return this.http.put(`${this.apiUrl}/${t}`,n)}deleteUser(t){return this.http.delete(`${this.apiUrl}/${t}`)}static{this.\u0275fac=function(n){return new(n||e)(H(K))}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function dn(e,s){e&1&&_(0,"mat-progress-spinner",13)}function cn(e,s){if(e&1&&(i(0,"div",14)(1,"mat-icon"),a(2,"error"),r(),i(3,"span"),a(4),r()()),e&2){let t=c(2);l(4),C(t.error)}}function un(e,s){if(e&1&&(i(0,"div",10),d(1,dn,1,0,"mat-progress-spinner",11)(2,cn,5,1,"div",12),r()),e&2){let t=c();l(),m("ngIf",t.isLoading),l(),m("ngIf",t.error)}}function fn(e,s){e&1&&(i(0,"mat-error"),a(1," Le titre est obligatoire "),r())}function gn(e,s){e&1&&(i(0,"mat-error"),a(1," Le titre ne doit pas d\xE9passer 100 caract\xE8res "),r())}function _n(e,s){e&1&&(i(0,"mat-error"),a(1," La description ne doit pas d\xE9passer 2000 caract\xE8res "),r())}function hn(e,s){if(e&1&&(i(0,"mat-option",24),a(1),r()),e&2){let t=s.$implicit;m("value",t.id),l(),vt(" ",t.firstName," ",t.lastName," ")}}function xn(e,s){e&1&&(i(0,"mat-error"),a(1," L'ID du mapping est obligatoire "),r())}function Cn(e,s){if(e&1&&(i(0,"mat-form-field",22)(1,"mat-label"),a(2,"ID du mapping"),r(),_(3,"input",34),d(4,xn,2,0,"mat-error",19),r()),e&2){let t,n=c(2);l(4),m("ngIf",(t=n.planForm.get("mappingId"))==null?null:t.hasError("required"))}}function vn(e,s){if(e&1&&(i(0,"mat-option",24),a(1),r()),e&2){let t=s.$implicit,n=c(2);m("value",t),l(),M(" ",n.getStatusLabel(t)," ")}}function Pn(e,s){e&1&&(i(0,"mat-error"),a(1," Le statut est obligatoire "),r())}function Mn(e,s){e&1&&_(0,"mat-spinner",35)}function bn(e,s){if(e&1&&(i(0,"span"),a(1),r()),e&2){let t=c(2);l(),C(t.isEditMode?"Mettre \xE0 jour":"Cr\xE9er")}}function En(e,s){if(e&1){let t=y();i(0,"form",15),x("ngSubmit",function(){v(t);let o=c();return P(o.onSubmit())}),i(1,"mat-card",16)(2,"mat-card-content")(3,"mat-form-field",17)(4,"mat-label"),a(5,"Titre du plan"),r(),_(6,"input",18),d(7,fn,2,0,"mat-error",19)(8,gn,2,0,"mat-error",19),r(),i(9,"mat-form-field",17)(10,"mat-label"),a(11,"Description"),r(),_(12,"textarea",20),d(13,_n,2,0,"mat-error",19),r(),i(14,"div",21)(15,"mat-form-field",22)(16,"mat-label"),a(17,"Responsable"),r(),i(18,"mat-select",23)(19,"mat-option",24),a(20,"Non assign\xE9"),r(),d(21,hn,2,3,"mat-option",25),r()(),i(22,"mat-form-field",22)(23,"mat-label"),a(24,"Date d'\xE9ch\xE9ance"),r(),_(25,"input",26)(26,"mat-datepicker-toggle",27)(27,"mat-datepicker",null,0),r()(),i(29,"div",21),d(30,Cn,5,1,"mat-form-field",28),i(31,"mat-form-field",22)(32,"mat-label"),a(33,"Statut"),r(),i(34,"mat-select",29),d(35,vn,2,2,"mat-option",25),r(),d(36,Pn,2,0,"mat-error",19),r()()(),i(37,"mat-card-actions",30)(38,"button",31),x("click",function(){v(t);let o=c();return P(o.cancel())}),a(39,"Annuler"),r(),i(40,"button",32),d(41,Mn,1,0,"mat-spinner",33)(42,bn,2,1,"span",19),r()()()()}if(e&2){let t,n,o,p,f=Ct(28),h=c();m("formGroup",h.planForm),l(7),m("ngIf",(t=h.planForm.get("title"))==null?null:t.hasError("required")),l(),m("ngIf",(n=h.planForm.get("title"))==null?null:n.hasError("maxlength")),l(5),m("ngIf",(o=h.planForm.get("description"))==null?null:o.hasError("maxlength")),l(6),m("value",null),l(2),m("ngForOf",h.users),l(4),m("matDatepicker",f),l(),m("for",f),l(4),m("ngIf",!h.mappingId),l(5),m("ngForOf",h.statuses),l(),m("ngIf",(p=h.planForm.get("status"))==null?null:p.hasError("required")),l(4),m("disabled",h.submitting),l(),m("ngIf",h.submitting),l(),m("ngIf",!h.submitting)}}var gt=(()=>{class e{constructor(t,n,o,p,f,h,Ne){this.fb=t,this.planService=n,this.userService=o,this.mappingService=p,this.route=f,this.router=h,this.snackBar=Ne,this.isEditMode=!1,this.planId=null,this.mappingId=null,this.users=[],this.isLoading=!1,this.error=null,this.submitting=!1,this.statuses=Object.values(u)}ngOnInit(){console.debug("PlanFormComponent: Initialisation"),this.initForm(),this.loadFormData()}initForm(){this.planForm=this.fb.group({title:["",[N.required,N.maxLength(100)]],description:["",N.maxLength(2e3)],ownerId:[null],dueDate:[null],status:[u.TODO,N.required],mappingId:["",N.required]})}loadFormData(){this.isLoading=!0,this.error=null,console.debug("PlanFormComponent: Initialisation du chargement des donn\xE9es du formulaire"),this.route.paramMap.subscribe(t=>{console.debug("PlanFormComponent: Params re\xE7us:",t),this.planId=t.get("id");let n=t.get("mappingId");console.debug("PlanFormComponent: Param\xE8tres extraits:",{id:this.planId,mappingId:n}),this.mappingId=n?+n:null,console.debug("PlanFormComponent: MappingId converti en nombre:",this.mappingId),this.isEditMode=!!this.planId,console.debug("PlanFormComponent: Mode \xE9dition:",this.isEditMode);let o=this.userService.getAllUsers(),p=_t(null);this.isEditMode&&this.planId&&(console.debug("PlanFormComponent: Chargement du plan existant:",this.planId),p=this.planService.getPlan(this.planId)),this.mappingId?(console.debug("PlanFormComponent: MappingId extrait de l'URL:",this.mappingId),this.planForm.patchValue({mappingId:this.mappingId}),this.mappingService.getMapping(this.mappingId.toString()).subscribe({next:f=>{console.debug("PlanFormComponent: Mapping trouv\xE9:",f)},error:f=>{console.error("PlanFormComponent: Erreur lors de la v\xE9rification du mapping:",f),this.showErrorSnackbar(`Le mapping #${this.mappingId} n'existe pas. Assurez-vous de venir d'une analyse d'\xE9carts valide.`)}})):console.debug("PlanFormComponent: Aucun mappingId trouv\xE9 dans l'URL"),ht({users:o,plan:p}).subscribe({next:f=>{if(this.users=f.users,f.plan&&this.isEditMode){let h=f.plan;h.dueDate&&(h.dueDate=new Date(h.dueDate)),this.planForm.patchValue(h)}this.isLoading=!1},error:f=>{console.error("Erreur lors du chargement des donn\xE9es",f),this.error="Impossible de charger les donn\xE9es. Veuillez r\xE9essayer.",this.isLoading=!1,this.showErrorSnackbar(this.error)}})})}onSubmit(){if(this.planForm.invalid){this.markFormGroupTouched(this.planForm);return}let t=this.planForm.value;if(t.dueDate&&(t.dueDate=t.dueDate.toISOString().split("T")[0]),t.mappingId&&typeof t.mappingId=="string"?t.mappingId=parseInt(t.mappingId,10):this.mappingId&&(t.mappingId=this.mappingId),!t.mappingId){this.showErrorSnackbar("ID de mapping manquant. Veuillez vous assurer de venir d'une analyse d'\xE9carts valide.");return}let n=t;console.debug("Envoi DTO RemediationPlan",n),this.submitting=!0,(this.isEditMode&&this.planId?this.planService.updatePlan(this.planId,n):this.planService.createPlan(n)).subscribe({next:p=>{this.submitting=!1;let f=this.isEditMode?"Plan mis \xE0 jour avec succ\xE8s":"Plan cr\xE9\xE9 avec succ\xE8s";this.showSuccessSnackbar(f),this.router.navigate(["/remediation-plans",n.mappingId])},error:p=>{console.error("Erreur lors de la soumission du formulaire",p),this.submitting=!1,p.status===404&&p.error&&p.error.message&&p.error.message.includes("Mapping non trouv\xE9")?this.showErrorSnackbar("Mapping non trouv\xE9. V\xE9rifiez que vous venez bien d'une analyse d'\xE9carts valide."):this.showErrorSnackbar("Impossible de sauvegarder le plan. Veuillez r\xE9essayer.")}})}cancel(){this.mappingId?this.router.navigate(["/remediation-plans",this.mappingId]):this.router.navigate(["/remediation-plans"])}markFormGroupTouched(t){Object.values(t.controls).forEach(n=>{n.markAsTouched(),n instanceof Vt&&this.markFormGroupTouched(n)})}getStatusLabel(t){switch(t){case u.TODO:return"\xC0 faire";case u.IN_PROGRESS:return"En cours";case u.DONE:return"Termin\xE9";default:return t}}showSuccessSnackbar(t){this.snackBar.open(t,"Fermer",{duration:3e3,panelClass:["success-snackbar"]})}showErrorSnackbar(t){this.snackBar.open(t,"Fermer",{duration:5e3,panelClass:["error-snackbar"]})}static{this.\u0275fac=function(n){return new(n||e)(g(zt),g(U),g(Le),g(be),g(D),g(k),g(j))}}static{this.\u0275cmp=O({type:e,selectors:[["app-plan-form"]],decls:13,vars:3,consts:[["picker",""],[1,"layout"],[1,"sidebar"],[1,"content"],["color","primary"],[1,"spacer"],["mat-icon-button","","matTooltip","Retour",3,"click"],[1,"page-content"],["class","loading-error-container",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"loading-error-container"],["mode","indeterminate","diameter","40",4,"ngIf"],["class","error-message",4,"ngIf"],["mode","indeterminate","diameter","40"],[1,"error-message"],[3,"ngSubmit","formGroup"],[1,"form-card"],["appearance","outline",1,"full-width"],["matInput","","formControlName","title","placeholder","Ex: Mise \xE0 jour de la politique de s\xE9curit\xE9","required",""],[4,"ngIf"],["matInput","","formControlName","description","rows","4","placeholder","D\xE9crivez les actions \xE0 entreprendre..."],[1,"form-row"],["appearance","outline",1,"form-field"],["formControlName","ownerId"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","dueDate",3,"matDatepicker"],["matSuffix","",3,"for"],["appearance","outline","class","form-field",4,"ngIf"],["formControlName","status","required",""],[1,"form-actions"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",4,"ngIf"],["matInput","","formControlName","mappingId","required",""],["diameter","20"]],template:function(n,o){n&1&&(i(0,"div",1),_(1,"app-sidebar",2),i(2,"div",3)(3,"mat-toolbar",4)(4,"span"),a(5),r(),_(6,"span",5),i(7,"button",6),x("click",function(){return o.cancel()}),i(8,"mat-icon"),a(9,"arrow_back"),r()()(),i(10,"div",7),d(11,un,3,2,"div",8)(12,En,43,14,"form",9),r()()()),n&2&&(l(5),C(o.isEditMode?"Modifier le Plan de Rem\xE9diation":"Nouveau Plan de Rem\xE9diation"),l(6),m("ngIf",o.isLoading||o.error),l(),m("ngIf",!o.isLoading&&!o.error))},dependencies:[Et,w,jt,Ft,Rt,Nt,Ut,$t,Bt,$,L,Y,F,it,et,ae,nt,ot,le,yt,ce,ue,fe,W,X,V,R,rt,lt],styles:[".layout[_ngcontent-%COMP%]{display:flex;min-height:100vh}.sidebar[_ngcontent-%COMP%]{width:250px;flex-shrink:0}.content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;background-color:#f5f5f5}.page-content[_ngcontent-%COMP%]{padding:24px;flex:1}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}.form-card[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.full-width[_ngcontent-%COMP%]{width:100%}.form-row[_ngcontent-%COMP%]{display:flex;gap:24px;margin-bottom:16px}.form-field[_ngcontent-%COMP%]{flex:1}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:16px;padding:16px}.loading-error-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:200px}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;color:#f44336;gap:8px}@media (max-width: 768px){.page-content[_ngcontent-%COMP%]{padding:16px}.form-row[_ngcontent-%COMP%]{flex-direction:column;gap:16px}.form-field[_ngcontent-%COMP%]{width:100%}}"]})}}return e})();function Sn(e,s){if(e&1&&(i(0,"div",18)(1,"h3"),a(2,"Description d\xE9taill\xE9e"),r(),i(3,"p"),a(4),r()()),e&2){let t=c(2);l(4),C(t.plan.description)}}function In(e,s){if(e&1){let t=y();i(0,"div")(1,"div",3),_(2,"app-sidebar",4),i(3,"div",5)(4,"mat-card",6)(5,"mat-card-header")(6,"mat-card-title")(7,"h1"),a(8,"D\xE9tails du Plan d'Action"),r()(),i(9,"mat-card-subtitle")(10,"mat-chip",7),a(11),r()()(),i(12,"mat-card-content")(13,"div",8)(14,"div",9)(15,"h2"),a(16,"Informations g\xE9n\xE9rales"),r(),i(17,"div",10)(18,"mat-icon"),a(19,"title"),r(),i(20,"div",11)(21,"span",12),a(22,"Titre"),r(),i(23,"span",13),a(24),r()()(),i(25,"div",10)(26,"mat-icon"),a(27,"description"),r(),i(28,"div",11)(29,"span",12),a(30,"Description"),r(),i(31,"span",13),a(32),r()()()(),i(33,"div",9)(34,"h2"),a(35,"M\xE9tadonn\xE9es"),r(),i(36,"div",10)(37,"mat-icon"),a(38,"person"),r(),i(39,"div",11)(40,"span",12),a(41,"Responsable"),r(),i(42,"span",13),a(43),r()()(),i(44,"div",10)(45,"mat-icon"),a(46,"event"),r(),i(47,"div",11)(48,"span",12),a(49,"Date d'\xE9ch\xE9ance"),r(),i(50,"span",13),a(51),z(52,"date"),r()()(),i(53,"div",10)(54,"mat-icon"),a(55,"update"),r(),i(56,"div",11)(57,"span",12),a(58,"Derni\xE8re mise \xE0 jour"),r(),i(59,"span",13),a(60),z(61,"date"),r()()()()(),d(62,Sn,5,1,"div",14),r(),i(63,"mat-card-actions",15)(64,"button",16),x("click",function(){v(t);let o=c();return P(o.goBack())}),i(65,"mat-icon"),a(66,"arrow_back"),r(),a(67," Retour \xE0 la liste "),r(),i(68,"button",17),x("click",function(){v(t);let o=c();return P(o.editPlan())}),i(69,"mat-icon"),a(70,"edit"),r(),a(71," Modifier "),r()()()()()()}if(e&2){let t=c();l(10),m("color",t.getStatusColor(t.plan.status)),l(),M(" ",t.getStatusLabel(t.plan.status)," "),l(13),C(t.plan.title),l(8),C(t.plan.description||"Non sp\xE9cifi\xE9e"),l(11),C(t.plan.ownerName||"Non assign\xE9"),l(8),C(A(52,8,t.plan.dueDate,"longDate")),l(9),C(A(61,11,t.plan.updatedAt,"medium")),l(2),m("ngIf",t.plan.description)}}function yn(e,s){e&1&&(i(0,"div",19),_(1,"mat-spinner",20),i(2,"p"),a(3,"Chargement du plan d'action..."),r()()),e&2&&(l(),m("diameter",40))}function On(e,s){if(e&1){let t=y();i(0,"mat-card",21)(1,"mat-card-content")(2,"div",22)(3,"mat-icon"),a(4,"error"),r(),i(5,"span"),a(6,"Impossible de charger les d\xE9tails du plan d'action. Veuillez r\xE9essayer plus tard."),r()()(),i(7,"mat-card-actions",15)(8,"button",23),x("click",function(){v(t);let o=c();return P(o.goBack())}),a(9,"Retour"),r()()()}}var Fe=(()=>{class e{constructor(t,n,o,p){this.route=t,this.router=n,this.planService=o,this.snackBar=p,this.plan=null,this.loading=!0,this.error=null}ngOnInit(){this.loadPlan()}loadPlan(){let t=this.route.snapshot.paramMap.get("id");if(!t){this.error="ID du plan non sp\xE9cifi\xE9",this.loading=!1;return}this.planService.getPlan(t).subscribe({next:n=>{this.plan=n,this.loading=!1},error:n=>{console.error("Erreur lors du chargement du plan",n),this.error="Impossible de charger les d\xE9tails du plan",this.loading=!1,this.showErrorSnackbar(this.error)}})}getStatusLabel(t){if(!t)return"Inconnu";switch(t){case u.TODO:return"\xC0 faire";case u.IN_PROGRESS:return"En cours";case u.DONE:return"Termin\xE9";default:return t}}getStatusColor(t){if(!t)return"default";switch(t){case u.TODO:return"warn";case u.IN_PROGRESS:return"accent";case u.DONE:return"primary";default:return"default"}}editPlan(){this.plan?.id&&this.router.navigate(["/remediation-plans/edit",this.plan.id])}goBack(){this.plan?.mappingId?this.router.navigate(["/remediation-plans",this.plan.mappingId]):this.router.navigate(["/remediation-plans"])}showErrorSnackbar(t){this.snackBar.open(t,"Fermer",{duration:5e3,panelClass:["error-snackbar"]})}static{this.\u0275fac=function(n){return new(n||e)(g(D),g(k),g(U),g(j))}}static{this.\u0275cmp=O({type:e,selectors:[["app-plan-detail"]],decls:3,vars:3,consts:[[4,"ngIf"],["class","loading-container",4,"ngIf"],["class","error-card",4,"ngIf"],[1,"layout"],[1,"sidebar"],[1,"content"],[1,"plan-detail-card"],["selected","",3,"color"],[1,"plan-info-grid"],[1,"info-section"],[1,"info-row"],[1,"info-content"],[1,"label"],[1,"value"],["class","description-section",4,"ngIf"],["align","end"],["mat-button","","color","primary",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"description-section"],[1,"loading-container"],[3,"diameter"],[1,"error-card"],[1,"error-message"],["mat-button","",3,"click"]],template:function(n,o){n&1&&d(0,In,72,14,"div",0)(1,yn,4,1,"div",1)(2,On,10,0,"mat-card",2),n&2&&(m("ngIf",!o.loading&&!o.error&&o.plan),l(),m("ngIf",o.loading),l(),m("ngIf",!o.loading&&o.error))},dependencies:[w,$,L,Y,F,kt,Dt,wt,W,V,he,R,J],styles:[".status-todo[_ngcontent-%COMP%]{background-color:#f8d7da!important;color:#721c24!important}.status-in-progress[_ngcontent-%COMP%]{background-color:#fff3cd!important;color:#856404!important}.status-done[_ngcontent-%COMP%]{background-color:#d4edda!important;color:#155724!important}.mat-card[_ngcontent-%COMP%], .mat-card-header[_ngcontent-%COMP%]{margin-bottom:20px}mat-spinner[_ngcontent-%COMP%]{margin:0 auto}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:16px;margin-bottom:24px}.description-section[_ngcontent-%COMP%]{margin-top:24px;border-top:1px solid rgba(0,0,0,.12);padding-top:16px}.description-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;color:#3f51b5;font-weight:500}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:#0000008a}.error-card[_ngcontent-%COMP%]{margin-top:16px}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;color:#f44336}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.layout[_ngcontent-%COMP%]{display:flex;min-height:100vh}.sidebar[_ngcontent-%COMP%]{width:250px;flex-shrink:0}.content[_ngcontent-%COMP%]{flex:1;padding:24px;background-color:#f5f5f5}.plan-detail-card[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.plan-info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:24px;margin-top:16px}.info-section[_ngcontent-%COMP%]{background:#fff;padding:16px;border-radius:8px;box-shadow:0 2px 4px #0000000d}.info-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 16px;color:#333;font-size:1.2em;font-weight:500}.info-row[_ngcontent-%COMP%]{display:flex;align-items:flex-start;margin-bottom:16px;padding:8px;border-radius:4px;transition:background-color .2s}.info-row[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.info-row[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:16px;color:#666}.info-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.info-content[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.9em;color:#666;margin-bottom:4px}.info-content[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1.1em;color:#333;word-break:break-word}mat-card-header[_ngcontent-%COMP%]{margin-bottom:24px}mat-card-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.8em;font-weight:500}mat-card-subtitle[_ngcontent-%COMP%]{margin-top:8px}mat-card-actions[_ngcontent-%COMP%]{padding:16px;border-top:1px solid #eee;margin-top:24px}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}@media (max-width: 768px){.plan-info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.content[_ngcontent-%COMP%]{padding:16px}.plan-detail-card[_ngcontent-%COMP%]{margin:0}}"]})}}return e})();var wn=[{path:"",component:ft,canActivate:[T],data:{title:"Liste des plans"}},{path:"new/:mappingId",component:gt,canActivate:[T],data:{title:"Nouveau plan"}},{path:"edit/:id",component:gt,canActivate:[T],data:{title:"Modifier le plan"}},{path:"detail/:id",component:Fe,canActivate:[T],data:{title:"D\xE9tails du plan"}},{path:":mappingId",component:ft,canActivate:[T],data:{title:"Plans par mapping"}}],Re=(()=>{class e{constructor(){console.debug("RemediationPlanRoutingModule: Module de routage initialis\xE9")}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=Q({type:e})}static{this.\u0275inj=G({imports:[ct.forChild(wn),ct]})}}return e})();var Ni=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=Q({type:e})}static{this.\u0275inj=G({imports:[St,At,Re,Ee,ee,re,pe,Tt,oe,de,se,ge,It,Ot,_e,xe,Ce,Lt,me,Pe,Me]})}}return e})();export{Ni as RemediationPlanModule};
