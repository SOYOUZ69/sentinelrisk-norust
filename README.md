# SentinelRisk - Syst√®me de Gestion des Risques et de Conformit√©

## Description
SentinelRisk est une plateforme compl√®te de gestion des risques et de conformit√©, con√ßue pour aider les organisations √† identifier, √©valuer et g√©rer efficacement leurs risques tout en assurant la conformit√© r√©glementaire.

## Architecture Technique

- **Backend** : Spring Boot
- **Frontend** : Angular
- **Base de donn√©es** : PostgreSQL
- **Authentification** : Keycloak
- **D√©ploiement** : Docker & Kubernetes

## Structure du Projet

```
sentinelrisk/
‚îú‚îÄ‚îÄ backend/           # Application Spring Boot
‚îú‚îÄ‚îÄ frontend/         # Application Angular
‚îú‚îÄ‚îÄ docker/           # Configurations Docker
‚îú‚îÄ‚îÄ k8s/              # Configurations Kubernetes
‚îî‚îÄ‚îÄ docs/            # Documentation technique
```

## Pr√©requis

- Java 17+
- Node.js 18+
- Docker
- Docker Compose
- PostgreSQL
- Maven
- Angular CLI (version 17.2.0+) : `npm install -g @angular/cli`

## Installation

1. **Cloner le projet**
```bash
git clone [URL_DU_REPO]
cd sentinelrisk-norust
```

2. **D√©marrer les services avec Docker Compose**
```bash
docker compose -f docker/docker-compose.yml up -d
```

3. **V√©rifier que les services sont en cours d'ex√©cution**
```bash
docker ps
```

Les services suivants devraient √™tre op√©rationnels :
- PostgreSQL (port 5432)
- Keycloak (port 8081)

4. **Acc√©der √† Keycloak**
- URL d'administration : http://localhost:8081/admin
- Identifiants par d√©faut :
  - Utilisateur : admin
  - Mot de passe : admin

## Configuration actuelle

### Base de donn√©es
- PostgreSQL est configur√© avec deux bases de donn√©es :
  - `sentinelrisk` : pour l'application principale
  - `keycloak` : pour la gestion de l'authentification

### Keycloak
- Version : 21.1
- Configuration en mode d√©veloppement
- Accessible sur http://localhost:8081
- Proxy configur√© en mode passthrough

#### Configuration du Realm
1. **Realm Name**: sentinelrisk
2. **R√¥les configur√©s**:
   - `admin` : Administrateur syst√®me
   - `risk_manager` : Gestionnaire des risques
   - `compliance_officer` : Responsable de la conformit√©
   - `auditor` : Auditeur
   - `user` : Utilisateur standard
3. **Param√®tres de s√©curit√©**:
   - SSL Mode: none (d√©veloppement uniquement)
   - Brute Force Detection: activ√©
   - Protection contre les attaques XSS et clickjacking

#### Configuration des Clients
1. **Client Frontend (Angular)**
   - Client ID : `sentinelrisk-frontend`
   - Type : Public (no client authentication)
   - Root URL : `http://localhost:4200`
   - Redirect URIs : `http://localhost:4200/*`
   - Web Origins : `http://localhost:4200`
   - Flows activ√©s : Standard flow, Direct access grants

2. **Client Backend (Spring Boot)**
   - Client ID : `sentinelrisk-backend`
   - Type : Confidential (client authentication required)
   - Root URL : `http://localhost:8080`
   - Redirect URIs : `http://localhost:8080/*`
   - Web Origins : `http://localhost:8080`
   - Flows activ√©s : Service accounts

#### Informations de Configuration
1. **Endpoints OIDC**
   - URL de base : `http://localhost:8081`
   - Realm : `sentinelrisk`
   - Discovery endpoint : `http://localhost:8081/realms/sentinelrisk/.well-known/openid-configuration`
   - Token endpoint : `http://localhost:8081/realms/sentinelrisk/protocol/openid-connect/token`
   - Authorization endpoint : `http://localhost:8081/realms/sentinelrisk/protocol/openid-connect/auth`

2. **Informations pour le Backend**
   - Client ID : `sentinelrisk-backend`
   - Client Secret : `[√Ä CONFIGURER DANS application.yml]`
   - Grant Type : `client_credentials`

3. **Informations pour le Frontend**
   - Client ID : `sentinelrisk-frontend`
   - Grant Types : `authorization_code`, `refresh_token`
   - Response Type : `code`
   - Scope : `openid profile email`

## Prochaines √©tapes

1. [x] Configuration du realm Keycloak
2. [x] Mise en place des clients Keycloak
3. [x] D√©veloppement du backend Spring Boot
   - [ ] Ajout du module Conformit√© : entit√©s ComplianceFramework, ComplianceRequirement, RiskComplianceMapping et endpoints CRUD
   - [x] Configuration de Spring Security avec Keycloak
   - [x] Mise en place des entit√©s de base
   - [x] D√©veloppement des APIs REST
   - [x] **Endpoints Dashboard** : Impl√©mentation des endpoints `/api/dashboard/summary/*` (risks, compliance, snmp, plans, global)
4. [ ] D√©veloppement du frontend Angular
   - [x] Initialisation du projet Angular
     - [x] Cr√©ation avec routing activ√© et SCSS
     - [x] Structure initiale (`pages`, `components`, `services`, etc.)
   - [x] Installation des d√©pendances
     - [x] Angular Material
     - [ ] ngx-translate (traduction)
     - [x] keycloak-js (authentification)
     - [ ] Autres utilitaires (lodash, date-fns...)
   - [x] Setup du th√®me et layout
     - [x] Configuration Angular Material (couleurs, typographie)
     - [x] Mise en place d'un layout de base : Header / Sidebar / Footer
     - [x] Responsive design
   - [x] Int√©gration de Keycloak
     - [x] Configuration du service d'authentification
     - [x] AuthGuard pour les routes s√©curis√©es
     - [x] Login / Logout / Refresh token
   - [x] Mise en place de la navigation
     - [x] Configuration des routes et modules
     - [x] Routes publiques vs priv√©es
     - [x] Redirections et fallback
   - [x] D√©finition des mod√®les TypeScript
     - [x] User, Risk, Control, Category, Assessment
   - [x] Services pour communication API
     - [x] ApiService g√©n√©rique
     - [x] Services sp√©cifiques : UserService, RiskService, etc.
     - [x] Gestion automatique des tokens
   - [ ] D√©veloppement des pages
     - [x] **Dashboard** : Interface compl√®te avec graphiques ngx-charts (actuellement en mode statique temporaire)
     - [x] Utilisateurs (liste, cr√©ation, √©dition, suppression)
     - [x] Risques (liste, cr√©ation, √©dition, suppression)
     - [ ] Contr√¥les
     - [ ] Cat√©gories
     - [ ] √âvaluations
     - [ ] Conformit√© : module de mappings pr√©d√©finis (ISO 27001, NIST, SOC 2, GDPR)
   - [ ] Gestion des r√¥les c√¥t√© UI
     - [ ] Lecture des r√¥les depuis le token JWT
     - [ ] Affichage conditionnel selon r√¥le
   - [ ] Am√©liorations UX/UI
     - [ ] Notifications (snackbar)
     - [ ] Spinners de chargement
     - [ ] Gestion des erreurs serveur
   - [ ] Tests et v√©rifications
     - [ ] Tests unitaires des services
     - [ ] V√©rification de la navigation et des acc√®s prot√©g√©s
5. [ ] Configuration des r√¥les et permissions
6. [ ] Mise en place des tests
7. [ ] Configuration du d√©ploiement Kubernetes

## üöß Mode Statique Temporaire du Dashboard

**Statut actuel** : Le Dashboard frontend fonctionne en mode statique avec des donn√©es fictives.

### Contexte
Les endpoints backend `/api/dashboard/summary/*` sont impl√©ment√©s mais n√©cessitent une authentification JWT. Pour permettre le d√©veloppement de l'interface utilisateur sans d√©pendre du backend, le Dashboard a √©t√© temporairement bascul√© en mode statique.

### Fonctionnalit√©s en Mode Statique
- ‚úÖ **Affichage imm√©diat** : Toutes les cartes KPI et graphiques s'affichent instantan√©ment
- ‚úÖ **Donn√©es r√©alistes** : 4 sections avec des m√©triques coh√©rentes (Risques, Conformit√©, SNMP, Plans d'action)
- ‚úÖ **Graphiques interactifs** : Utilisation compl√®te de ngx-charts avec animations
- ‚úÖ **Graphiques optimis√©s** : Rendu et redimensionnement corrig√©s (pas de re-rendering en boucle)
- ‚úÖ **Indicateur visuel** : Chip "MODE D√âMO" avec animation pour clarifier le statut
- ‚úÖ **Filtres d√©sactiv√©s** : Interface compl√®te mais non fonctionnelle (mode d√©mo)
- ‚úÖ **Aucune erreur r√©seau** : Pas d'appels HTTP, pas d'erreurs dans la console

### Donn√©es Statiques Utilis√©es
- **Risques** : 36 total (30 ouverts, 6 ferm√©s) r√©partis par niveau et cat√©gorie
- **Conformit√©** : 60 contr√¥les (66.7% de conformit√©) sur ISO 27001, NIST, SOC 2
- **SNMP** : 55 actifs (88% de taux de succ√®s) par type (serveurs, commutateurs, etc.)
- **Plans d'Action** : 23 plans (52.2% de compl√©tion) avec statuts d√©taill√©s

### Test du Mode Statique
```bash
# Lancer le frontend
cd frontend
npm start

# Acc√©der au Dashboard
# http://localhost:4200/dashboard
```

Voir le fichier `frontend/test-dashboard-static.md` pour les d√©tails complets des tests.

### Retour au Mode Dynamique
Une fois les endpoints backend op√©rationnels avec l'authentification :
1. D√©commenter les appels HTTP dans `dashboard.component.ts`
2. R√©activer la r√©activit√© des filtres
3. Supprimer l'indicateur "MODE D√âMO"
4. Remettre les champs de filtres en mode actif

## üéØ Optimisations des Graphiques Dashboard

**Statut** : Probl√®mes de rendu et redimensionnement r√©solus.

### Probl√®mes Corrig√©s
- ‚ùå **Graphiques trop petits** au chargement initial
- ‚ùå **Re-rendering en boucle** lors du redimensionnement de la fen√™tre
- ‚ùå **Performance d√©grad√©e** avec cycles de d√©tection excessifs
- ‚ùå **Redimensionnement instable** avec clignotements

### Solutions Impl√©ment√©es

#### 1. **Syst√®me de Dimensions Fixes**
- **ViewChild** : R√©f√©rences directes aux containers de graphiques
- **Calcul dynamique** : Dimensions calcul√©es via `getBoundingClientRect()`
- **Propri√©t√©s [view]** : Dimensions fixes pass√©es √† chaque graphique ngx-charts
- **Dimensions minimales** : 300x250px garanties sur mobile

#### 2. **Optimisations de Performance**
- **ChangeDetectionStrategy.OnPush** : R√©duction des cycles de d√©tection
- **ResizeObserver** : Gestion intelligente du redimensionnement
- **Throttling** : Maximum 1 recalcul toutes les 300ms
- **ChangeDetectorRef** : Contr√¥le manuel des mises √† jour

#### 3. **Structure Optimis√©e**
```typescript
// Dimensions calcul√©es une seule fois
riskLevelChartView: [number, number] = [400, 300];

// Calcul apr√®s initialisation de la vue
ngAfterViewInit(): void {
  setTimeout(() => {
    this.calculateChartDimensions();
    this.setupResizeObserver();
  }, 100);
}
```

#### 4. **Template Structur√©**
```html
<div class="chart-container" #riskLevelChartContainer>
  <h3 class="chart-title">Distribution par niveau de risque</h3>
  <div class="chart-wrapper">
    <ngx-charts-pie-chart
      [view]="riskLevelChartView"
      [results]="riskLevelChart">
    </ngx-charts-pie-chart>
  </div>
</div>
```

### R√©sultats Obtenus
- ‚úÖ **Affichage optimal** : Graphiques de taille appropri√©e d√®s le chargement
- ‚úÖ **Redimensionnement stable** : Une seule fois par changement de taille
- ‚úÖ **Performance am√©lior√©e** : Pas de re-rendering continu
- ‚úÖ **Responsive fluide** : Adaptation aux breakpoints sans saccades
- ‚úÖ **Budget CSS respect√©** : R√©duction de 8.05 kB √† 6.60 kB

### Tests de Validation
Voir le fichier `frontend/test-charts-optimization.md` pour les proc√©dures de test compl√®tes.

```bash
# Test rapide
cd frontend
npm run build  # ‚úÖ Compilation sans erreurs
npm start      # ‚úÖ Serveur op√©rationnel
# Ouvrir http://localhost:4200/dashboard
# Redimensionner la fen√™tre ‚Üí Pas de clignotement
```

---

## Structure des Entit√©s

### Category (Cat√©gorie de risque)
- Identifiant unique
- Nom (unique)
- Description
- Dates de cr√©ation et mise √† jour

### Risk (Risque)
- Identifiant unique
- Nom
- Description
- Cat√©gorie
- Niveau d'impact (NEGLIGIBLE √† SEVERE)
- Niveau de probabilit√© (RARE √† ALMOST_CERTAIN)
- Score de risque (calcul√©)
- Statut (IDENTIFIED, IN_ASSESSMENT, MITIGATED, ACCEPTED, CLOSED)
- Plan de mitigation
- Contr√¥les associ√©s
- Dates de cr√©ation et mise √† jour

### Control (Contr√¥le)
- Identifiant unique
- Nom
- Description
- Type (PREVENTIVE, DETECTIVE, CORRECTIVE, COMPENSATING)
- Fr√©quence (CONTINUOUS, DAILY, WEEKLY, etc.)
- Statut (PLANNED, IN_PROGRESS, IMPLEMENTED, etc.)
- D√©tails d'impl√©mentation
- Risques associ√©s
- Dates de cr√©ation et mise √† jour

### Assessment (√âvaluation)
- Identifiant unique
- Risque associ√©
- Statut (PLANNED, IN_PROGRESS, COMPLETED, CANCELLED)
- Date d'√©valuation
- Conclusions
- Recommandations
- Date de prochaine revue
- Dates de cr√©ation et mise √† jour

### User (Utilisateur)
- Identifiant Keycloak
- Nom d'utilisateur (unique)
- Nom complet
- Email (unique)
- Num√©ro de t√©l√©phone
- D√©partement
- R√¥les
- Statut actif/inactif
- Derni√®re connexion
- √âvaluations assign√©es
- Dates de cr√©ation et mise √† jour

## Repositories JPA

### CategoryRepository
- Recherche par nom
- V√©rification d'existence par nom

### RiskRepository
- Recherche par cat√©gorie et statut
- Recherche des risques √©lev√©s (score minimum)
- Recherche par niveau d'impact et probabilit√©
- Recherche par cat√©gorie

### ControlRepository
- Recherche par type, statut et fr√©quence
- Recherche par risque associ√©
- Recherche des contr√¥les inefficaces pour les risques actifs

### AssessmentRepository
- Recherche par statut et utilisateur assign√©
- Recherche des √©valuations en attente de revue
- Recherche des √©valuations actives par utilisateur
- Recherche des derni√®res √©valuations par risque

### UserRepository
- Recherche par username et email
- Recherche par d√©partement
- Recherche par r√¥le
- Recherche des utilisateurs actifs avec √©valuations en cours
- V√©rification d'existence par username/email

## Services M√©tier

Les services suivants ont √©t√© impl√©ment√©s pour g√©rer la logique m√©tier de l'application :

### UserService
- Gestion compl√®te des utilisateurs (CRUD)
- Recherche par username, email, d√©partement et r√¥le
- Gestion des r√¥les utilisateur
- Suivi des connexions utilisateur
- V√©rification des utilisateurs avec des √©valuations en attente

### RiskService
- Gestion des risques (CRUD)
- Cat√©gorisation des risques
- √âvaluation des niveaux d'impact et de probabilit√©
- Gestion des contr√¥les associ√©s aux risques
- Suivi des risques par statut et cat√©gorie
- Identification des risques √† score √©lev√©

### CategoryService
- Gestion des cat√©gories de risque (CRUD)
- Validation des noms uniques de cat√©gories
- Organisation hi√©rarchique des risques

### ControlService
- Gestion des contr√¥les de risque (CRUD)
- Classification par type (pr√©ventif, d√©tectif, correctif, compensatoire)
- Suivi de la fr√©quence d'application
- √âvaluation de l'efficacit√© des contr√¥les
- Association avec les risques correspondants

### AssessmentService
- Gestion des √©valuations de risque (CRUD)
- Attribution des √©valuations aux utilisateurs
- Suivi du statut des √©valuations
- Planification des revues
- Gestion des conclusions et recommandations
- Historique des √©valuations par risque

Chaque service impl√©mente les principes suivants :
- Validation des donn√©es entrantes
- Gestion des erreurs avec des exceptions appropri√©es
- Transactions atomiques pour garantir l'int√©grit√© des donn√©es
- S√©paration claire des responsabilit√©s

## Contrat des APIs REST

Les contr√¥leurs REST suivants doivent √™tre impl√©ment√©s pour exposer les services m√©tier. Chaque contr√¥leur suit une structure RESTful classique avec endpoints `GET`, `POST`, `PUT`, `DELETE`.

### UserController ‚Äì `/api/users`
- GET `/` : Lister tous les utilisateurs
- GET `/{id}` : Obtenir un utilisateur par ID
- POST `/` : Cr√©er un utilisateur
- PUT `/{id}` : Mettre √† jour un utilisateur
- DELETE `/{id}` : Supprimer un utilisateur
- GET `/active` : Lister les utilisateurs actifs

### RiskController ‚Äì `/api/risks`
- GET `/` : Lister tous les risques
- GET `/{id}` : Obtenir un risque par ID
- POST `/` : Cr√©er un risque
- PUT `/{id}` : Modifier un risque
- DELETE `/{id}` : Supprimer un risque
- GET `/high-score` : Lister les risques √† score √©lev√©
- GET `/category/{id}` : Risques d'une cat√©gorie donn√©e

### ControlController ‚Äì `/api/controls`
- GET `/` : Lister tous les contr√¥les
- GET `/{id}` : D√©tails d'un contr√¥le
- POST `/` : Cr√©er un contr√¥le
- PUT `/{id}` : Modifier un contr√¥le
- DELETE `/{id}` : Supprimer un contr√¥le
- GET `/by-risk/{id}` : Contr√¥les li√©s √† un risque

### CategoryController ‚Äì `/api/categories`
- GET `/` : Lister les cat√©gories
- GET `/{id}` : D√©tails d'une cat√©gorie
- POST `/` : Cr√©er une cat√©gorie
- PUT `/{id}` : Modifier une cat√©gorie
- DELETE `/{id}` : Supprimer une cat√©gorie

### AssessmentController ‚Äì `/api/assessments`
- GET `/` : Lister toutes les √©valuations
- GET `/{id}` : D√©tails d'une √©valuation
- POST `/` : Cr√©er une √©valuation
- PUT `/{id}` : Modifier une √©valuation
- DELETE `/{id}` : Supprimer une √©valuation
- GET `/user/{userId}` : √âvaluations assign√©es √† un utilisateur

## D√©veloppement

Instructions d√©taill√©es pour le d√©veloppement seront ajout√©es au fur et √† mesure de l'avancement du projet.

## D√©ploiement

Instructions de d√©ploiement seront ajout√©es une fois l'application pr√™te pour la production.

## Licence

Propri√©taire - Tous droits r√©serv√©s

## Structure du Frontend Angular

### Structure des Dossiers 

```
frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/                   # Services et fonctionnalit√©s essentiels
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/               # Services d'authentification Keycloak
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guards/             # Protection des routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ http/               # Intercepteurs HTTP
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/             # Interfaces et classes de base
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ services/           # Services de base (connexion API, etc.)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ shared/                 # Composants, directives et pipes partag√©s
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/         # Composants r√©utilisables
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ directives/         # Directives personnalis√©es
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pipes/              # Pipes personnalis√©s
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/              # Fonctions utilitaires
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ features/               # Modules de fonctionnalit√©s
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users/          # Module de gestion des utilisateurs
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/               # Module pour login/logout
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ risks/              # Module de gestion des risques
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controls/           # Module de gestion des contr√¥les
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assessments/        # Module d'√©valuations
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ categories/         # Module de cat√©gories
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout/                 # Composants de mise en page
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ header/             # En-t√™te de l'application
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sidebar/            # Barre lat√©rale de navigation
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ footer/             # Pied de page
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layouts/            # Layouts r√©utilisables
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dashboard/          # Module de tableau de bord
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.component.*         # Composant racine de l'application 
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.module.ts           # Module principal de l'application
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app.routes.ts           # Configuration des routes
‚îÇ   ‚îú‚îÄ‚îÄ assets/                     # Ressources statiques (images, logos, etc.)
‚îÇ   ‚îú‚îÄ‚îÄ environments/               # Configurations d'environnement
‚îÇ   ‚îú‚îÄ‚îÄ styles/                     # Fichiers de styles globaux
‚îÇ   ‚îú‚îÄ‚îÄ index.html                  # Point d'entr√©e HTML
‚îÇ   ‚îî‚îÄ‚îÄ main.ts                     # Point d'entr√©e TypeScript
‚îú‚îÄ‚îÄ angular.json                    # Configuration du projet Angular
‚îú‚îÄ‚îÄ package.json                    # D√©pendances et scripts npm
‚îî‚îÄ‚îÄ tsconfig.json                   # Configuration TypeScript
```

## Frontend - Structure et Lancement

### D√©pendances Principales
- **Angular 17.2.0** : Framework frontend moderne avec support des derni√®res fonctionnalit√©s
- **Angular Material 17.2.0** : Biblioth√®que de composants Material Design
- **Keycloak Angular 15.0.0** : Int√©gration avec Keycloak pour l'authentification
- **RxJS 7.8.0** : Biblioth√®que de programmation r√©active

### Technologies Utilis√©es
- **TypeScript** : Langage de programmation typ√©
- **HTML/CSS** : Standards web pour la structure et le style
- **Angular Material** : Design system complet pour l'interface utilisateur
- **JWT** : Jetons d'authentification s√©curis√©s via Keycloak

### Installation et Lancement

1. **Installer les d√©pendances**
```bash
cd frontend
npm install
```

2. **Lancer le serveur de d√©veloppement**
```bash
npm start
# ou
ng serve
```

L'application sera accessible √† l'adresse : http://localhost:4200

### Ordre de d√©marrage recommand√©

Pour assurer un d√©marrage correct de l'ensemble de l'application, suivez l'ordre de lancement suivant :

1. **D√©marrer les services Docker (Keycloak et PostgreSQL)**
```bash
cd /chemin/vers/sentinelrisk-norust
docker compose -f docker/docker-compose.yml up -d
```
V√©rification : 
- PostgreSQL doit √™tre accessible sur le port 5432
- Keycloak doit √™tre accessible sur http://localhost:8081
- Vous pouvez vous connecter √† l'interface d'administration Keycloak : http://localhost:8081/admin (admin/admin)

2. **Lancer le backend Spring Boot**
```bash
cd backend
./mvnw spring-boot:run
```
V√©rification :
- Le backend doit √™tre accessible sur http://localhost:8080
- Swagger UI doit √™tre accessible sur http://localhost:8080/swagger-ui.html
- Note : Si Swagger renvoie une erreur 401 Unauthorized, vous devez d'abord obtenir un token JWT et l'inclure dans les requ√™tes (voir section "Donn√©es de test initiales")

3. **Lancer le frontend Angular**
```bash
cd frontend
npm start
```
V√©rification :
- Le frontend doit √™tre accessible sur http://localhost:4200
- Vous devriez pouvoir vous connecter avec l'utilisateur cr√©√© dans Keycloak

### Notes sur le D√©veloppement

- **Mode d√©veloppement** : L'application est configur√©e pour communiquer avec le backend sur http://localhost:8080
- **Int√©gration Keycloak** : L'authentification est g√©r√©e via Keycloak (http://localhost:8081)
- **Acc√®s aux API** : Les tokens d'authentification sont automatiquement inclus dans les requ√™tes HTTP
- **Styles** : L'application utilise le th√®me indigo-pink de Material Design avec des personnalisations
- **Responsive** : L'interface s'adapte aux diff√©rentes tailles d'√©cran (desktop, tablette, mobile)

### Commandes Utiles

```bash
# Lancer les tests unitaires
npm test

# Cr√©er une version de production
npm run build

# Linting du code
npm run lint
```

### Donn√©es de test initiales

Pour faciliter les tests initiaux, suivez ces √©tapes pour cr√©er des donn√©es de base :

#### Cr√©ation d'un utilisateur Keycloak

1. Connectez-vous √† l'interface admin de Keycloak (http://localhost:8081/admin) avec admin/admin
2. S√©lectionnez le realm "sentinelrisk"
3. Dans le menu de gauche, cliquez sur "Users" puis "Add user"
4. Remplissez les champs :
   - Username: testuser
   - Email: testuser@example.com
   - First name: Test
   - Last name: User
   - Activez "Email verified"
5. Cliquez sur "Create"
6. Dans l'onglet "Credentials", cliquez sur "Set password"
7. D√©finissez un mot de passe (ex: password123)
8. D√©sactivez "Temporary" et cliquez sur "Save"
9. Dans l'onglet "Role mappings", ajoutez les r√¥les souhait√©s (ex: user, risk_manager)

#### G√©n√©ration d'un token d'acc√®s

**Via Postman/curl :**
```bash
curl -X POST \
  http://localhost:8081/realms/sentinelrisk/protocol/openid-connect/token \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  -d 'grant_type=password&client_id=sentinelrisk-frontend&username=testuser&password=password123'
```

**Via Swagger UI :**
1. Acc√©dez √† http://localhost:8080/swagger-ui.html
2. Cliquez sur "Authorize" en haut √† droite
3. Entrez les informations d'identification de l'utilisateur cr√©√©
4. Une fois authentifi√©, le token sera automatiquement inclus dans toutes les requ√™tes

#### Exemples de Request Body (JSON)

**Cr√©er un utilisateur :**
```json
{
  "username": "jdupont",
  "email": "jean.dupont@example.com",
  "fullName": "Jean Dupont",
  "phoneNumber": "+33612345678",
  "department": "IT",
  "active": true
}
```

**Cr√©er une cat√©gorie :**
```json
{
  "name": "S√©curit√© des donn√©es",
  "description": "Risques li√©s √† la s√©curit√© et √† la confidentialit√© des donn√©es"
}
```

**Cr√©er un risque :**
```json
{
  "name": "Fuite de donn√©es personnelles",
  "description": "Risque de divulgation non autoris√©e de donn√©es personnelles",
  "categoryId": 1,
  "impactLevel": "HIGH",
  "probabilityLevel": "MEDIUM",
  "status": "IDENTIFIED",
  "mitigationPlan": "Mettre en place un chiffrement de bout en bout"
}
```

**Cr√©er un contr√¥le :**
```json
{
  "name": "Chiffrement des donn√©es sensibles",
  "description": "Mise en place d'un chiffrement AES-256 pour toutes les donn√©es sensibles",
  "type": "PREVENTIVE",
  "frequency": "CONTINUOUS",
  "status": "IMPLEMENTED",
  "implementationDetails": "Utilisation de l'API de chiffrement native",
  "riskIds": [1]
}
```

## Modules impl√©ment√©s

### Module de gestion des utilisateurs
Ce module permet la gestion compl√®te des utilisateurs du syst√®me avec les fonctionnalit√©s suivantes :
- Affichage de la liste des utilisateurs
- Cr√©ation d'un nouvel utilisateur
- Modification des informations d'un utilisateur existant
- Suppression d'un utilisateur
- Gestion du statut actif/inactif

Le module utilise :
- `UserService` pour interagir avec le backend
- `MatDialog` pour les formulaires modaux
- Composants Angular Material (tables, formulaires, badges)
- Styles responsifs pour diff√©rentes tailles d'√©cran

### Module de gestion des risques
Ce module permet la gestion compl√®te des risques avec les fonctionnalit√©s suivantes :
- Affichage de la liste des risques avec indication visuelle des scores et statuts
- Cr√©ation d'un nouveau risque avec s√©lection de la cat√©gorie, du niveau d'impact et de probabilit√©
- Modification des informations d'un risque existant
- Suppression d'un risque
- Visualisation du score de risque calcul√©

Le module utilise :
- `RiskService` pour interagir avec le backend
- `CategoryService` pour obtenir les cat√©gories disponibles
- Syst√®me de badges color√©s pour repr√©senter visuellement les niveaux d'impact, de probabilit√© et le score
- Formulaire complet avec validation des champs obligatoires

## Mapping des r√¥les

Le syst√®me utilise diff√©rents r√¥les pour g√©rer les acc√®s et les permissions. Voici le mapping d√©taill√© des r√¥les :

| Nom du r√¥le          | R√¥le dans Keycloak    | Droits dans l'application                                                             |
|----------------------|-----------------------|--------------------------------------------------------------------------------------|
| admin                | admin                 | Acc√®s complet √† toutes les fonctionnalit√©s, gestion des utilisateurs et des param√®tres syst√®me |
| risk_manager         | risk_manager          | Cr√©ation/modification/suppression des risques et contr√¥les, acc√®s au tableau de bord  |
| compliance_officer   | compliance_officer    | Cr√©ation/modification des √©valuations, suivi de la conformit√©, rapports              |
| auditor              | auditor               | Lecture seule sur tous les modules, g√©n√©ration de rapports d'audit                    |
| user                 | user                  | Acc√®s en lecture aux risques, participation aux √©valuations assign√©es                 |

### D√©tails des permissions par module

#### Dashboard
- **admin**: Acc√®s complet (m√©triques administratives)
- **risk_manager**: Acc√®s complet (m√©triques des risques)
- **compliance_officer**: Acc√®s complet (m√©triques de conformit√©)
- **auditor**: Acc√®s en lecture seule
- **user**: Acc√®s limit√© (uniquement m√©triques personnelles)

#### Gestion des utilisateurs
- **admin**: CRUD complet
- **Autres r√¥les**: Lecture seule de leur profil

#### Gestion des risques
- **admin**, **risk_manager**: CRUD complet
- **compliance_officer**: Lecture et mise √† jour
- **auditor**, **user**: Lecture seule

#### Gestion des contr√¥les
- **admin**, **risk_manager**: CRUD complet
- **compliance_officer**: Lecture et mise √† jour
- **auditor**, **user**: Lecture seule

#### Gestion des √©valuations
- **admin**, **compliance_officer**: CRUD complet
- **risk_manager**: Cr√©ation et lecture
- **auditor**: Lecture seule
- **user**: Lecture des √©valuations assign√©es

## Guide rapide de contribution Angular

Ce guide pr√©sente les conventions et pratiques √† suivre pour contribuer au d√©veloppement du frontend Angular.

### Commandes de g√©n√©ration

```bash
# G√©n√©rer un nouveau composant
ng generate component features/module-name/component-name

# G√©n√©rer un nouveau module
ng generate module features/module-name --routing

# G√©n√©rer un nouveau service
ng generate service core/services/service-name

# G√©n√©rer un nouveau mod√®le
ng generate interface core/models/model-name
```

### Conventions de nommage

- **Dossiers et fichiers**: kebab-case (ex: `user-profile`, `risk-assessment`)
- **Classes**: PascalCase (ex: `UserService`, `RiskComponent`)
- **Interfaces**: PascalCase avec pr√©fixe "I" pour clart√© (ex: `IUser`, `IRisk`)
- **M√©thodes et variables**: camelCase (ex: `getUserById()`, `currentUser`)
- **Constantes**: SNAKE_CASE_MAJUSCULE (ex: `API_BASE_URL`)

### Structure des nouveaux modules

Tous les nouveaux modules de fonctionnalit√© doivent √™tre cr√©√©s dans le dossier `src/app/features/` avec la structure suivante :

```
features/
‚îî‚îÄ‚îÄ nom-module/
    ‚îú‚îÄ‚îÄ components/         # Composants sp√©cifiques au module
    ‚îú‚îÄ‚îÄ services/           # Services sp√©cifiques au module 
    ‚îú‚îÄ‚îÄ models/             # Interfaces/types sp√©cifiques au module
    ‚îú‚îÄ‚îÄ pages/              # Pages principales du module
    ‚îú‚îÄ‚îÄ nom-module.module.ts
    ‚îî‚îÄ‚îÄ nom-module-routing.module.ts
```

### Bonnes pratiques √† respecter

1. **State Management**:
   - Utilisez les services Angular pour la gestion d'√©tat simple
   - Pour une gestion d'√©tat plus complexe, utilisez RxJS BehaviorSubject/Observable

2. **Performance**:
   - Utilisez OnPush ChangeDetectionStrategy quand c'est possible
   - Impl√©mentez ngOnDestroy pour nettoyer les subscriptions RxJS
   - Utilisez trackBy dans les ngFor pour optimiser les rendus de listes

3. **S√©curit√©**:
   - Utilisez les pipes Angular pour sanitizer le contenu (ex: | async, | safe)
   - N'utilisez jamais innerHTML sans sanitizer
   - Validez toutes les entr√©es utilisateur c√¥t√© client ET c√¥t√© serveur

4. **UX/Accessibilit√©**:
   - Suivez les directives WCAG pour l'accessibilit√©
   - Utilisez les composants Material avec aria-labels appropri√©s
   - Assurez-vous que l'application est utilisable au clavier

5. **Tests**:
   - √âcrivez des tests unitaires pour tous les services
   - Testez les sc√©narios critiques dans les composants
   - Maintenez une couverture de test minimale de 70%

6. **Commits**:
   - Suivez le format: `type(scope): description` (ex: `feat(auth): add login component`)
   - Types communs: feat, fix, docs, style, refactor, test, chore

Pour plus de d√©tails, consultez le fichier CONTRIBUTING.md √† la racine du projet.

## Structure du Backend Spring Boot

### Arborescence des packages

```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ java/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ com/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ sentinelrisk/
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ config/               # Configuration Spring Boot
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ SecurityConfig.java    # Configuration de Spring Security
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ OpenApiConfig.java     # Configuration de Swagger/OpenAPI
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ controller/           # Contr√¥leurs REST
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ RiskController.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ CategoryController.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ ControlController.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ AssessmentController.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ UserController.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ model/                # Entit√©s JPA
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ Risk.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ Category.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ Control.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ Assessment.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ User.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ repository/           # Repositories JPA
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ RiskRepository.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ CategoryRepository.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ ControlRepository.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ AssessmentRepository.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ UserRepository.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ service/              # Services m√©tier
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ RiskService.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ CategoryService.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ ControlService.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ AssessmentService.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ UserService.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ exception/            # Gestion des exceptions
‚îÇ   ‚îÇ   ‚îÇ               ‚îî‚îÄ‚îÄ GlobalExceptionHandler.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ resources/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ application.yml               # Configuration de l'application
‚îÇ   ‚îî‚îÄ‚îÄ test/                                 # Tests unitaires et d'int√©gration
‚îî‚îÄ‚îÄ pom.xml                                   # D√©pendances Maven
```

### Exemples de r√©ponses JSON des APIs

#### GET /api/users - Liste des utilisateurs

```json
[
  {
    "id": "1a2b3c4d-5e6f-7890-abcd-ef1234567890",
    "username": "jdupont",
    "email": "jean.dupont@example.com",
    "firstName": "Jean",
    "lastName": "Dupont",
    "department": "IT",
    "role": "RISK_MANAGER",
    "active": true,
    "lastLogin": "2023-12-15T14:30:45",
    "createdAt": "2023-11-01T09:22:33",
    "updatedAt": "2023-12-15T14:30:45"
  },
  {
    "id": "2b3c4d5e-6f78-90ab-cdef-123456789012",
    "username": "mmartin",
    "email": "marie.martin@example.com",
    "firstName": "Marie",
    "lastName": "Martin",
    "department": "Compliance",
    "role": "COMPLIANCE_OFFICER",
    "active": true,
    "lastLogin": "2023-12-14T10:15:22",
    "createdAt": "2023-11-05T11:08:45",
    "updatedAt": "2023-12-14T10:15:22"
  }
]
```

#### GET /api/risks/{id} - D√©tail d'un risque

```json
{
  "id": 42,
  "name": "Fuite de donn√©es personnelles",
  "description": "Risque de divulgation non autoris√©e de donn√©es personnelles clients",
  "category": {
    "id": 3,
    "name": "S√©curit√© des donn√©es",
    "description": "Risques li√©s √† la s√©curit√© des donn√©es"
  },
  "impactLevel": "HIGH",
  "probabilityLevel": "MEDIUM",
  "status": "MITIGATED",
  "score": 12,
  "mitigationPlan": "Mise en place d'un chiffrement de bout en bout et formation du personnel",
  "controls": [
    {
      "id": 15,
      "name": "Chiffrement des donn√©es sensibles",
      "type": "PREVENTIVE",
      "status": "IMPLEMENTED"
    },
    {
      "id": 16,
      "name": "Formation sensibilisation RGPD",
      "type": "DETECTIVE",
      "status": "IMPLEMENTED"
    }
  ],
  "createdAt": "2023-10-15T09:45:00",
  "updatedAt": "2023-12-10T14:30:22"
}
```

#### GET /api/categories - Liste des cat√©gories

```json
[
  {
    "id": 1,
    "name": "Risques op√©rationnels",
    "description": "Risques li√©s aux op√©rations et processus internes"
  },
  {
    "id": 2,
    "name": "Risques financiers",
    "description": "Risques li√©s aux aspects financiers"
  },
  {
    "id": 3,
    "name": "S√©curit√© des donn√©es",
    "description": "Risques li√©s √† la s√©curit√© des donn√©es"
  }
]
```

### Gestion des erreurs

Le backend utilise un syst√®me centralis√© de gestion des erreurs via la classe `GlobalExceptionHandler`. Les exceptions sont captur√©es et transform√©es en r√©ponses HTTP avec le code d'√©tat appropri√©.

#### Types d'erreurs g√©r√©es :

- **EntityNotFoundException** : Renvoie un code HTTP 404 (Not Found)
- **MethodArgumentNotValidException** : Renvoie un code HTTP 400 (Bad Request) avec les d√©tails des erreurs de validation
- **AccessDeniedException** : Renvoie un code HTTP 403 (Forbidden)
- **Exceptions g√©n√©riques** : Renvoie un code HTTP 500 (Internal Server Error)

#### Format des r√©ponses d'erreur :

```json
// Exemple d'erreur 404 (Not Found)
{
  "status": 404,
  "message": "Risk not found with id: 999",
  "timestamp": "2023-12-15T10:30:45.123"
}

// Exemple d'erreur 400 (Bad Request) - validation
{
  "name": "Le nom ne peut pas √™tre vide",
  "email": "Doit √™tre une adresse email valide",
  "impactLevel": "La valeur doit √™tre l'une des suivantes : LOW, MEDIUM, HIGH, SEVERE"
}

// Exemple d'erreur 403 (Forbidden)
{
  "status": 403,
  "message": "Access is denied",
  "timestamp": "2023-12-15T10:35:12.456"
}
```

### S√©curit√© Backend

Le backend utilise Spring Security int√©gr√© avec Keycloak pour l'authentification et l'autorisation.

#### Configuration de la s√©curit√©

- **SecurityConfig.java** : Configure les r√®gles de s√©curit√© et l'int√©gration avec Keycloak
- **JwtAuthenticationConverter** : Convertit les claims JWT de Keycloak en autorit√©s Spring Security

#### V√©rification des r√¥les

Les contr√¥leurs utilisent l'annotation `@PreAuthorize` pour v√©rifier les autorisations :

```java
// Exemple d'acc√®s restreint aux utilisateurs ayant le r√¥le RISK_MANAGER
@PostMapping
@PreAuthorize("hasRole('RISK_MANAGER')")
public ResponseEntity<Risk> createRisk(@Valid @RequestBody Risk risk) {
    return ResponseEntity.ok(riskService.createRisk(risk));
}

// Exemple d'acc√®s pour plusieurs r√¥les
@GetMapping("/{id}")
@PreAuthorize("hasAnyRole('RISK_MANAGER', 'COMPLIANCE_OFFICER', 'AUDITOR')")
public ResponseEntity<Risk> getRisk(@PathVariable Long id) {
    return ResponseEntity.ok(riskService.getRiskById(id));
}
```

#### Interaction entre Keycloak et Spring Security

1. **Authentification** : L'utilisateur s'authentifie aupr√®s de Keycloak et obtient un JWT
2. **Requ√™te API** : Le client envoie ce JWT dans l'en-t√™te Authorization (Bearer)
3. **Validation** : Spring Security valide le JWT aupr√®s de Keycloak
4. **Extraction des r√¥les** : Les r√¥les sont extraits du claim "realm_access.roles" du JWT
5. **Autorisation** : Spring Security v√©rifie les r√¥les requis pour l'acc√®s √† la ressource
6. **Acc√®s** : Si les r√¥les sont suffisants, l'acc√®s est accord√©, sinon une erreur 403 est renvoy√©e

### Logs et d√©bogage

#### Configuration des logs

Les logs sont configur√©s dans le fichier `application.yml` :

```yaml
logging:
  level:
    root: INFO
    com.sentinelrisk: DEBUG
    org.springframework.security: DEBUG
    org.springdoc: DEBUG
```

#### Emplacement des logs

Par d√©faut, les logs sont affich√©s sur la console. Dans un environnement de production, ils peuvent √™tre configur√©s pour √™tre √©crits dans un fichier.

#### Modification du niveau de log

Pour modifier temporairement le niveau de log (par exemple pour du d√©bogage), utilisez l'API Actuator (si activ√©e) ou modifiez le fichier `application.yml`.

Pour activer des logs plus d√©taill√©s, modifiez les niveaux comme suit :

```yaml
logging:
  level:
    root: DEBUG                         # Logs d√©taill√©s pour toute l'application
    com.sentinelrisk: TRACE             # Logs tr√®s d√©taill√©s pour le package sentinelrisk
    org.springframework.security: DEBUG # Logs d√©taill√©s pour Spring Security
```

## üìÑ Navigation et Routage Angular

### Structure des Routes
- `/auth/login`        => LoginComponent (public)
- `/auth/logout`       => LogoutComponent (public)
- `/auth/home`         => HomeComponent (prot√©g√©)
- `/dashboard`         => DashboardModule (lazy loaded, prot√©g√©)
- `/users`             => UsersModule (lazy loaded, prot√©g√©)
- `/risks`             => RisksModule (lazy loaded, prot√©g√©)
- `/controls`          => ControlsModule (lazy loaded, prot√©g√©)
- `/categories`        => CategoriesModule (lazy loaded, prot√©g√©)
- `/assessments`       => AssessmentsModule (lazy loaded, prot√©g√©)
- `/404`               => PageNotFoundComponent (public, fallback)
- `/**`                => Redirection vers `/404` (public, fallback)

### Organisation des Modules
```
frontend/src/app/
‚îú‚îÄ‚îÄ app-routing.module.ts      # Configuration globale des routes
‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users/             # UsersModule avec ses propres routes
‚îÇ   ‚îú‚îÄ‚îÄ auth/                  # AuthModule pour login/logout
‚îÇ   ‚îú‚îÄ‚îÄ risks/                 # RisksModule
‚îÇ   ‚îú‚îÄ‚îÄ controls/              # ControlsModule
‚îÇ   ‚îú‚îÄ‚îÄ categories/            # CategoriesModule
‚îÇ   ‚îî‚îÄ‚îÄ assessments/           # AssessmentsModule
‚îú‚îÄ‚îÄ layout/
‚îÇ   ‚îú‚îÄ‚îÄ layout.component.ts    # Composant de mise en page principal
‚îÇ   ‚îú‚îÄ‚îÄ layout-routing.module.ts # Routes sous le Layout
‚îÇ   ‚îú‚îÄ‚îÄ header/                # En-t√™te de l'application
‚îÇ   ‚îî‚îÄ‚îÄ sidebar/               # Barre lat√©rale de navigation
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îî‚îÄ‚îÄ dashboard/             # DashboardModule
‚îî‚îÄ‚îÄ core/
    ‚îî‚îÄ‚îÄ guards/auth.guard.ts   # Protection des routes
```

### Bonnes pratiques appliqu√©es
- Lazy Loading pour tous les modules de fonctionnalit√©s
- AuthGuard appliqu√© sur toutes les routes priv√©es
- Route fallback mise en place (PageNotFoundComponent) pour les routes inconnues
- Navigation s√©curis√©e : acc√®s prot√©g√© selon l'authentification
- Conventions de nommage respect√©es (kebab-case pour les chemins de route)

### Notes compl√©mentaires
- Les routes sont d√©clar√©es dans layout-routing.module.ts sous LayoutComponent
- Les modules de fonctionnalit√©s sont autonomes et encapsulent leurs propres sous-routes
- Le RouterOutlet principal est situ√© dans app.component.html
- L'authentification est g√©r√©e via Keycloak

## üì° Services API et Communication avec le Backend

### ApiService G√©n√©rique
L'application utilise un service API central pour toutes les communications HTTP avec le backend.

```typescript
// core/services/api.service.ts
@Injectable({
  providedIn: 'root'
})
export class ApiService {
  private apiUrl = environment.apiUrl;

  constructor(private http: HttpClient) {}

  get<T>(path: string, params: HttpParams = new HttpParams()): Observable<T> {
    return this.http.get<T>(`${this.apiUrl}${path}`, { params });
  }

  post<T>(path: string, body: any): Observable<T> {
    return this.http.post<T>(`${this.apiUrl}${path}`, body);
  }

  // ... autres m√©thodes HTTP
}
```

### Architecture des Services
Le projet organise les services en deux niveaux :
1. **ApiService** : service g√©n√©rique au niveau du core qui encapsule les appels HTTP bruts
2. **Services sp√©cifiques** : services par entit√© qui utilisent l'ApiService pour des op√©rations m√©tier

### Services Sp√©cifiques Impl√©ment√©s

| Service | Chemin | Fonctionnalit√©s |
|---------|--------|-----------------|
| UserService | `features/admin/users/services/user.service.ts` | Gestion des utilisateurs (CRUD, filtres) |
| RiskService | `features/risks/services/risk.service.ts` | Gestion des risques (CRUD, filtres par cat√©gorie/statut) |
| ControlService | `features/controls/services/control.service.ts` | Gestion des contr√¥les (CRUD, filtres par type/statut) |
| CategoryService | `features/categories/services/category.service.ts` | Gestion des cat√©gories de risque (CRUD) |
| AssessmentService | `features/assessments/services/assessment.service.ts` | Gestion des √©valuations (CRUD, filtres) |

### Utilisation des Services dans les Composants

```typescript
// Injection du service
constructor(private userService: UserService) {}

// R√©cup√©ration de donn√©es
ngOnInit() {
  this.userService.getUsers().subscribe({
    next: (users) => {
      this.users = users;
      console.log('Utilisateurs r√©cup√©r√©s:', users);
    },
    error: (error) => {
      console.error('Erreur:', error);
      // Gestion des erreurs appropri√©e
    }
  });
}

// Cr√©ation d'un nouvel √©l√©ment
createUser(userData: Partial<User>) {
  this.userService.createUser(userData).subscribe({
    next: (createdUser) => {
      // Gestion du succ√®s
      this.loadUsers(); // Rafra√Æchir la liste
    },
    error: (error) => {
      // Gestion des erreurs
    }
  });
}
```

### Gestion des Erreurs et Tokens

- L'authentification par token JWT est automatiquement g√©r√©e via un intercepteur HTTP
- Les tokens sont automatiquement ajout√©s aux en-t√™tes de requ√™te
- Les erreurs 401 (non autoris√©) d√©clenchent un refresh du token ou une redirection vers la page de login
- Les erreurs 403 (interdit) sont g√©r√©es au niveau des composants

### Mod√®les de Donn√©es TypeScript

Des interfaces TypeScript compl√®tes ont √©t√© cr√©√©es pour chaque entit√©:

```typescript
// exemple pour les risques
export interface Risk {
  id: string;
  name: string;
  description: string;
  category: Category;
  impactLevel: ImpactLevel;
  probabilityLevel: ProbabilityLevel;
  score: number;
  status: RiskStatus;
  mitigationPlan?: string;
  controls?: Control[];
  createdAt: Date;
  updatedAt: Date;
}
```

Des √©num√©rations sont √©galement d√©finies pour les valeurs fixes :

```typescript
export enum RiskStatus {
  IDENTIFIED = 'IDENTIFIED',
  IN_ASSESSMENT = 'IN_ASSESSMENT',
  MITIGATED = 'MITIGATED',
  ACCEPTED = 'ACCEPTED',
  CLOSED = 'CLOSED'
}
```
